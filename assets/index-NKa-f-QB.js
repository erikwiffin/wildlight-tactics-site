import{j as a,E as as,R as oi,y as li}from"./vendor-codemirror-CU3fVUWC.js";import{b as ci,a as p,c as Kt,g as zt,d as di,e as ui,f as mi,p as hi,h as fi,i as pi,u as gi,j as yi,k as ce,R as Ps,P as bi}from"./vendor-react-redux-DUcPpXqW.js";import{r as xi,a as vi}from"./vendor-ajv-DGv0XOpo.js";import{r as wi,P as St,u as ki,a as ji,b as Ni,i as $i,B as _i,C as Ii,c as Ti,M as Ci,R as Ei}from"./vendor-react-flow-D_EOtGYQ.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();var At={},is;function Si(){if(is)return At;is=1;var e=ci();return At.createRoot=e.createRoot,At.hydrateRoot=e.hydrateRoot,At}var Ai=Si();function Ot(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ot=function(n){return typeof n}:Ot=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ot(e)}function Li(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ui(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function qi(e,t,n){return t&&Ui(e.prototype,t),e}function Pi(e,t){return t&&(Ot(t)==="object"||typeof t=="function")?t:Rt(e)}function kn(e){return kn=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},kn(e)}function Rt(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Mi(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&jn(e,t)}function jn(e,t){return jn=Object.setPrototypeOf||function(s,i){return s.__proto__=i,s},jn(e,t)}function Ft(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ms=(function(e){Mi(t,e);function t(){var n,s;Li(this,t);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return s=Pi(this,(n=kn(t)).call.apply(n,[this].concat(r))),Ft(Rt(s),"state",{bootstrapped:!1}),Ft(Rt(s),"_unsubscribe",void 0),Ft(Rt(s),"handlePersistorState",function(){var l=s.props.persistor,c=l.getState(),d=c.bootstrapped;d&&(s.props.onBeforeLift?Promise.resolve(s.props.onBeforeLift()).finally(function(){return s.setState({bootstrapped:!0})}):s.setState({bootstrapped:!0}),s._unsubscribe&&s._unsubscribe())}),s}return qi(t,[{key:"componentDidMount",value:function(){this._unsubscribe=this.props.persistor.subscribe(this.handlePersistorState),this.handlePersistorState()}},{key:"componentWillUnmount",value:function(){this._unsubscribe&&this._unsubscribe()}},{key:"render",value:function(){return typeof this.props.children=="function"?this.props.children(this.state.bootstrapped):this.state.bootstrapped?this.props.children:this.props.loading}}]),t})(p.PureComponent);Ft(Ms,"defaultProps",{children:null,loading:null});var Jt={meta:{conversation_id:"town/childhood-friend-1",name:"Childhood Friend",description:"Your best friend from childhood who's excited about your journey",location:"town",image:"/src/assets/npcs/childhood-friend.png",backgroundImage:"/src/assets/backgrounds/town.png",conditions:["hasNotVisited_field-1"]},variables:{},nodes:{start:{sequence:[{speaker:"Childhood Friend",text:"Hey! I heard you finally got your first Wildlight! This is so exciting - you're actually going to become a trainer!"}],choices:[{type:"fixed",text:"I can't believe it either!",goto:"excited_response"},{type:"fixed",text:"I'm a bit nervous about it",goto:"nervous_response"},{type:"fixed",text:"Want to see my Wildlight?",goto:"show_wildlight"}]},restart:{sequence:[{speaker:"Childhood Friend",text:"What else do you want to talk about?"}],choices:[{type:"fixed",text:"I can't believe it either!",goto:"excited_response"},{type:"fixed",text:"I'm a bit nervous about it",goto:"nervous_response"},{type:"fixed",text:"Want to see my Wildlight?",goto:"show_wildlight"}]},excited_response:{sequence:[{speaker:"Childhood Friend",text:"You've been talking about this for years! I remember when we were kids and you'd always say 'When I get my first Wildlight, I'm going to explore the whole world!' And now it's actually happening!"}],choices:[{type:"fixed",text:"I remember those days too",goto:"memories"},{type:"fixed",text:"I'm going to make you proud",goto:"make_proud"},{type:"fixed",text:"Want to see my Wildlight?",goto:"show_wildlight"}]},nervous_response:{sequence:[{speaker:"Childhood Friend",text:"Don't be nervous! You've always been great with animals, and Wildlight are just like that - they can sense when someone genuinely cares about them. You'll be an amazing trainer!"}],choices:[{type:"fixed",text:"Thanks for believing in me",goto:"thanks_belief"},{type:"fixed",text:"I hope you're right",goto:"hope_right"},{type:"fixed",text:"Want to see my Wildlight?",goto:"show_wildlight"}]},show_wildlight:{sequence:[{speaker:"Childhood Friend",text:"Of course! I'd love to see your new partner! What kind of Wildlight did you bond with?"}],choices:[{type:"fixed",text:"It's amazing how we connected",goto:"connection_talk"},{type:"fixed",text:"I can't wait to train together",goto:"training_talk"},{type:"fixed",text:"I'm ready for this adventure",goto:"adventure_talk"}]},memories:{sequence:[{speaker:"Childhood Friend",text:"Remember when we used to pretend we were trainers? We'd make up names for our imaginary Wildlight and go on pretend adventures around the village. Now you're going on real ones!"}],choices:[{type:"fixed",text:"Those were the best times",goto:"best_times"},{type:"fixed",text:"I'll tell you all about my real adventures",goto:"tell_adventures"}]},make_proud:{sequence:[{speaker:"Childhood Friend",text:"I'm already proud of you! Just getting this far takes courage. I know you're going to do amazing things out there. Just promise me you'll come back and tell me all about your adventures!"}],choices:[{type:"fixed",text:"I promise!",goto:"promise"},{type:"fixed",text:"You'll be the first to know everything",goto:"first_to_know"}]},thanks_belief:{sequence:[{speaker:"Childhood Friend",text:"Of course! You've always been the kind of person who puts others first. That's exactly what makes a great trainer - caring more about your Wildlight than winning battles."}],end:!0},hope_right:{sequence:[{speaker:"Childhood Friend",text:"I know I'm right! You've got this. And remember, I'll always be here cheering you on from the village. You're not alone in this journey."}],end:!0},connection_talk:{sequence:[{speaker:"Childhood Friend",text:"That's the most beautiful part about being a trainer - that moment when you and your Wildlight just... understand each other. It's like magic, but better because it's real."}],end:!0},training_talk:{sequence:[{speaker:"Childhood Friend",text:"Training together is where the real bond forms. Every battle, every challenge you face together makes you stronger. I can't wait to hear about all the things you'll learn!"}],end:!0},adventure_talk:{sequence:[{speaker:"Childhood Friend",text:"You're going to see so many amazing places! I'm a little jealous, but mostly just excited for you. Go out there and show the world what you're made of!"}],end:!0},best_times:{sequence:[{speaker:"Childhood Friend",text:"They really were! And now you're living the dream we used to talk about. I'm so happy for you, and I know you're going to make even better memories out there in the real world."}],end:!0},tell_adventures:{sequence:[{speaker:"Childhood Friend",text:"I can't wait to hear them! Every time you come back to town, you have to tell me everything. Promise me you won't leave out any details!"}],end:!0},promise:{sequence:[{speaker:"Childhood Friend",text:"That's all I needed to hear! Now go out there and make your mark on the world. I'll be here waiting for your stories!"}],end:!0},first_to_know:{sequence:[{speaker:"Childhood Friend",text:"That means the world to me! I'll be your biggest supporter, cheering you on from here. Now go make some memories worth telling!"}],end:!0}}};Jt.meta;Jt.variables;Jt.nodes;var Qt={meta:{conversation_id:"town/childhood-friend-2",name:"Childhood Friend",description:"Your best friend from childhood who's excited about your journey",location:"town",image:"/src/assets/npcs/childhood-friend.png",backgroundImage:"/src/assets/backgrounds/town.png",conditions:["hasVisited_field-1","hasUnitInArmy_mossfeather"]},variables:{},nodes:{start:{sequence:[{speaker:"Childhood Friend",text:"Wow! I heard you went to the Training Field and came back with a Mossfeather! That's incredible - you already have two Wildlight!"}],choices:[{type:"fixed",text:"I can't believe it either!",goto:"amazed_response"},{type:"fixed",text:"The Mossfeather is amazing!",goto:"mossfeather_talk"},{type:"fixed",text:"I'm getting the hang of this!",goto:"getting_hang"}]},restart:{sequence:[{speaker:"Childhood Friend",text:"What else do you want to talk about?"}],choices:[{type:"fixed",text:"I can't believe it either!",goto:"amazed_response"},{type:"fixed",text:"The Mossfeather is amazing!",goto:"mossfeather_talk"},{type:"fixed",text:"I'm getting the hang of this!",goto:"getting_hang"}]},amazed_response:{sequence:[{speaker:"Childhood Friend",text:"Two Wildlight already! You're becoming a real trainer faster than anyone I know. I remember when we used to dream about this, and now you're actually living it!"}],choices:[{type:"fixed",text:"It's like a dream come true",goto:"dream_come_true"},{type:"fixed",text:"I'm learning so much",goto:"learning_much"},{type:"fixed",text:"Tell me about the Mossfeather",goto:"mossfeather_details"}]},mossfeather_talk:{sequence:[{speaker:"Childhood Friend",text:"Mossfeathers are so cool! They're known for being really loyal once you earn their trust. How did you manage to catch one? They're usually pretty shy around humans."}],choices:[{type:"fixed",text:"It took patience and understanding",goto:"patience_understanding"},{type:"fixed",text:"We just connected somehow",goto:"connection_somehow"},{type:"fixed",text:"I think it saw something in me",goto:"saw_something"}]},getting_hang:{sequence:[{speaker:"Childhood Friend",text:"You really are! I can see the confidence in your eyes now. You're not just playing at being a trainer anymore - you're actually becoming one!"}],choices:[{type:"fixed",text:"It feels different now",goto:"feels_different"},{type:"fixed",text:"I'm ready for bigger challenges",goto:"bigger_challenges"},{type:"fixed",text:"I want to show you my team",goto:"show_team"}]},dream_come_true:{sequence:[{speaker:"Childhood Friend",text:"It really is! And the best part is, this is just the beginning. I can only imagine what amazing Wildlight you'll meet as you explore more places. You're going to have the most incredible team!"}],choices:[{type:"fixed",text:"I hope so!",goto:"hope_so"},{type:"fixed",text:"I'll tell you about every new one",goto:"tell_every_new"}]},learning_much:{sequence:[{speaker:"Childhood Friend",text:"That's what makes a great trainer - never stopping learning! Every Wildlight teaches you something new about yourself and about the world. You're going to grow so much on this journey."}],end:!0},mossfeather_details:{sequence:[{speaker:"Childhood Friend",text:"Mossfeathers are fascinating creatures! They're known for their connection to nature and their ability to sense emotions. Having one on your team means you have a partner who really understands you."}],choices:[{type:"fixed",text:"That's exactly how it feels",goto:"exactly_feels"},{type:"fixed",text:"I'm lucky to have found it",goto:"lucky_found"}]},patience_understanding:{sequence:[{speaker:"Childhood Friend",text:"That's the mark of a true trainer! Wildlight can sense when someone genuinely cares about them. Your patience and understanding are what make you special - that's why they trust you."}],end:!0},connection_somehow:{sequence:[{speaker:"Childhood Friend",text:"That's the magic of the bond between trainer and Wildlight! Sometimes it just clicks, and you know you're meant to be together. That's how you know you're on the right path."}],end:!0},saw_something:{sequence:[{speaker:"Childhood Friend",text:"Of course it did! Wildlight are incredibly perceptive. They can see the kindness and determination in your heart. That's why they choose to be your partner."}],end:!0},feels_different:{sequence:[{speaker:"Childhood Friend",text:"It should! You're not just pretending anymore - you're actually living the life we used to dream about. Every day you're out there, you're becoming more of who you're meant to be."}],end:!0},bigger_challenges:{sequence:[{speaker:"Childhood Friend",text:"I can see that fire in your eyes! You're ready to take on whatever the world throws at you. With two Wildlight by your side, there's nothing you can't handle!"}],end:!0},show_team:{sequence:[{speaker:"Childhood Friend",text:"I'd love to see them! Your first Wildlight and your new Mossfeather - what an amazing team you're building! I'm so proud of how far you've come already."}],end:!0},hope_so:{sequence:[{speaker:"Childhood Friend",text:"I know so! You have everything it takes to be an incredible trainer. Your heart, your determination, and now your growing team - you're unstoppable!"}],end:!0},tell_every_new:{sequence:[{speaker:"Childhood Friend",text:"I can't wait! Every time you come back to town, I want to hear about every new Wildlight you meet, every adventure you have, every challenge you overcome. You're living the dream!"}],end:!0},exactly_feels:{sequence:[{speaker:"Childhood Friend",text:"That's the beautiful thing about the bond between trainer and Wildlight - it's not just about strength or strategy, it's about understanding and trust. You've found something special."}],end:!0},lucky_found:{sequence:[{speaker:"Childhood Friend",text:"You didn't just find it - it found you! Wildlight choose their trainers as much as trainers choose them. You earned that trust, and that's something to be proud of."}],end:!0}}};Qt.meta;Qt.variables;Qt.nodes;var Xt={meta:{conversation_id:"town/childhood-friend-3",name:"Childhood Friend",description:"Your best friend from childhood who's excited about your journey",location:"town",image:"/src/assets/npcs/childhood-friend.png",backgroundImage:"/src/assets/backgrounds/town.png",conditions:["hasVisited_field-1","hasNotUnitInArmy_mossfeather"]},variables:{},nodes:{start:{sequence:[{speaker:"Childhood Friend",text:"Hey! I heard you went to the Training Field! How was it? Did you learn anything new about being a trainer?"}],choices:[{type:"fixed",text:"It was challenging but fun",goto:"challenging_fun"},{type:"fixed",text:"I'm still figuring things out",goto:"figuring_things"},{type:"fixed",text:"I want to catch more Wildlight",goto:"catch_more"}]},restart:{sequence:[{speaker:"Childhood Friend",text:"What else do you want to talk about?"}],choices:[{type:"fixed",text:"It was challenging but fun",goto:"challenging_fun"},{type:"fixed",text:"I'm still figuring things out",goto:"figuring_things"},{type:"fixed",text:"I want to catch more Wildlight",goto:"catch_more"}]},challenging_fun:{sequence:[{speaker:"Childhood Friend",text:"That's exactly what training should be! Every challenge makes you stronger. But I'm curious - did you try to catch any wild Wildlight while you were there?"}],choices:[{type:"fixed",text:"I tried but couldn't figure out how",goto:"couldn_figure_out"},{type:"fixed",text:"I didn't know you could catch them",goto:"didn_know"},{type:"fixed",text:"I saw some but they ran away",goto:"ran_away"}]},figuring_things:{sequence:[{speaker:"Childhood Friend",text:"That's totally normal! Being a trainer is a learning process. Hey, I actually know something that might help you - did you know you can catch wild Wildlight in battles?"}],choices:[{type:"fixed",text:"Really? How do you do that?",goto:"really_how"},{type:"fixed",text:"I had no idea!",goto:"no_idea"},{type:"fixed",text:"Tell me everything!",goto:"tell_everything"}]},catch_more:{sequence:[{speaker:"Childhood Friend",text:"That's the spirit! You know, I learned something interesting about catching Wildlight. It's not just about battling them - there's a special technique to it!"}],choices:[{type:"fixed",text:"What's the technique?",goto:"what_technique"},{type:"fixed",text:"I need to know this!",goto:"need_to_know"},{type:"fixed",text:"Please teach me!",goto:"please_teach"}]},couldn_figure_out:{sequence:[{speaker:"Childhood Friend",text:"Ah, I see! Well, let me tell you the secret - when you're in a battle with wild Wildlight, you need to get close to them first. Then you can use a special capture action!"}],choices:[{type:"fixed",text:"How close do I need to get?",goto:"how_close"},{type:"fixed",text:"What's the capture action?",goto:"capture_action"},{type:"fixed",text:"This sounds complicated",goto:"sounds_complicated"}]},didn_know:{sequence:[{speaker:"Childhood Friend",text:"Most new trainers don't! It's one of those things that experienced trainers know but don't always share. The key is getting right next to a wild Wildlight during battle, then selecting the capture option."}],choices:[{type:"fixed",text:"That makes sense!",goto:"makes_sense"},{type:"fixed",text:"Why didn't anyone tell me?",goto:"why_tell"},{type:"fixed",text:"I want to try this!",goto:"want_try"}]},ran_away:{sequence:[{speaker:"Childhood Friend",text:"They do that when they sense danger! But here's the thing - if you approach them carefully and get close enough, you can actually capture them instead of just battling. It's all about positioning!"}],choices:[{type:"fixed",text:"How do I get close safely?",goto:"close_safely"},{type:"fixed",text:"What if they attack me?",goto:"attack_me"},{type:"fixed",text:"This is really helpful!",goto:"really_helpful"}]},really_how:{sequence:[{speaker:"Childhood Friend",text:"It's actually pretty straightforward once you know the trick! During a battle with wild Wildlight, you need to move your trainer right next to the one you want to catch. Then you'll see a 'Capture' option appear!"}],choices:[{type:"fixed",text:"That sounds easy enough",goto:"sounds_easy"},{type:"fixed",text:"What if I'm fighting other trainers?",goto:"fighting_trainers"},{type:"fixed",text:"I can't wait to try this!",goto:"cant_wait"}]},no_idea:{sequence:[{speaker:"Childhood Friend",text:"I know, right? It's one of those trainer secrets that not everyone knows! The key is that you can only capture wild Wildlight - not ones that belong to other trainers. And you have to be standing right next to them!"}],choices:[{type:"fixed",text:"Only wild ones?",goto:"only_wild"},{type:"fixed",text:"Why next to them?",goto:"why_next"},{type:"fixed",text:"This changes everything!",goto:"changes_everything"}]},tell_everything:{sequence:[{speaker:"Childhood Friend",text:"Of course! So here's how it works: when you're in a battle with wild Wildlight, you need to move your trainer to a hex that's adjacent to the Wildlight you want to catch. Then you'll see a 'Capture' action available!"}],choices:[{type:"fixed",text:"What if there are multiple wild ones?",goto:"multiple_wild"},{type:"fixed",text:"Does it always work?",goto:"always_work"},{type:"fixed",text:"I'm going to try this right away!",goto:"try_right_away"}]},what_technique:{sequence:[{speaker:"Childhood Friend",text:"The technique is all about positioning! You have to get your trainer right next to the wild Wildlight you want to catch. Once you're adjacent to it, you'll see a 'Capture' option in your action menu!"}],choices:[{type:"fixed",text:"That's it? Just get close?",goto:"thats_it"},{type:"fixed",text:"What about the battle?",goto:"what_battle"},{type:"fixed",text:"I need to remember this!",goto:"need_remember"}]},need_to_know:{sequence:[{speaker:"Childhood Friend",text:"I'm happy to help! The secret is that you can only capture wild Wildlight during battles - not ones that belong to other trainers. And you have to be standing right next to the one you want to catch!"}],choices:[{type:"fixed",text:"Why only wild ones?",goto:"why_wild"},{type:"fixed",text:"What if they're too far away?",goto:"too_far"},{type:"fixed",text:"This is amazing!",goto:"amazing"}]},please_teach:{sequence:[{speaker:"Childhood Friend",text:"I'd love to! Here's the step-by-step: First, find a battle with wild Wildlight. Then, move your trainer to a hex that's right next to the one you want to catch. Finally, select the 'Capture' action that appears!"}],choices:[{type:"fixed",text:"What if I can't get close enough?",goto:"cant_close"},{type:"fixed",text:"Does it work every time?",goto:"work_every"},{type:"fixed",text:"Thank you so much!",goto:"thank_so_much"}]},how_close:{sequence:[{speaker:"Childhood Friend",text:"You need to be on an adjacent hex - right next to them! Think of it like you're reaching out to touch them. The capture action only appears when you're close enough to make that connection."}],end:!0},capture_action:{sequence:[{speaker:"Childhood Friend",text:"The capture action will appear in your action menu when you're close enough! It's different from attacking - it's about forming a bond, not dealing damage. That's why you have to be right next to them."}],end:!0},sounds_complicated:{sequence:[{speaker:"Childhood Friend",text:"It's not as complicated as it sounds! Just remember: get close, then capture. The hard part is getting close without getting hurt, but that's what makes it exciting!"}],end:!0},makes_sense:{sequence:[{speaker:"Childhood Friend",text:"Right? It's all about that personal connection! You can't capture something from across the battlefield - you have to be close enough to reach out and make that bond."}],end:!0},why_tell:{sequence:[{speaker:"Childhood Friend",text:"Some trainers like to keep their secrets! But I think knowledge should be shared. Every trainer deserves to know how to build their team the way they want to."}],end:!0},want_try:{sequence:[{speaker:"Childhood Friend",text:"Go for it! Just remember - only with wild Wildlight, and only when you're right next to them. Good luck, and I can't wait to hear about your new team members!"}],end:!0},close_safely:{sequence:[{speaker:"Childhood Friend",text:"That's the tricky part! You have to be strategic about it. Maybe weaken them a bit first, or wait for the right moment. It's all about timing and positioning - just like everything else in training!"}],end:!0},attack_me:{sequence:[{speaker:"Childhood Friend",text:"That's the risk you take! But remember, you're not trying to hurt them - you're trying to befriend them. Sometimes they can sense your intentions and won't attack if you approach with the right mindset."}],end:!0},really_helpful:{sequence:[{speaker:"Childhood Friend",text:"I'm so glad I could help! Now you have all the tools you need to build the team of your dreams. Go out there and show the world what you're made of!"}],end:!0},sounds_easy:{sequence:[{speaker:"Childhood Friend",text:"It is, once you know the trick! The hard part is getting close enough without getting hurt. But that's what makes it exciting - it's not just about strength, it's about strategy and courage!"}],end:!0},fighting_trainers:{sequence:[{speaker:"Childhood Friend",text:"Ah, good question! You can only capture wild Wildlight, not ones that belong to other trainers. In battles against other trainers, you're just trying to win - no capturing allowed!"}],end:!0},cant_wait:{sequence:[{speaker:"Childhood Friend",text:"I'm excited for you! Just remember to be patient and strategic. Not every attempt will work, but when it does, it's the most amazing feeling in the world!"}],end:!0},only_wild:{sequence:[{speaker:"Childhood Friend",text:"Exactly! Wild Wildlight are free to choose their trainer, but ones that already belong to someone else are off-limits. It's about respect for the existing bond between trainer and Wildlight."}],end:!0},why_next:{sequence:[{speaker:"Childhood Friend",text:"Because capturing is about forming a personal connection! You can't just throw a ball from across the field - you have to be close enough to reach out and make that bond. It's about trust and understanding."}],end:!0},changes_everything:{sequence:[{speaker:"Childhood Friend",text:"It really does! Now you can build your team exactly how you want it. Go out there and find the Wildlight that speak to your heart!"}],end:!0},multiple_wild:{sequence:[{speaker:"Childhood Friend",text:"You can only capture one at a time! Pick the one you want most and focus on getting close to that one. Once you've captured it, you can try for another in a different battle."}],end:!0},always_work:{sequence:[{speaker:"Childhood Friend",text:"Not always! Some Wildlight are harder to catch than others, and sometimes they just don't want to be caught. But don't give up - persistence and patience are key to being a great trainer!"}],end:!0},try_right_away:{sequence:[{speaker:"Childhood Friend",text:"That's the spirit! Just remember everything I told you - get close, be patient, and only try with wild Wildlight. Good luck, and I can't wait to hear about your success!"}],end:!0},thats_it:{sequence:[{speaker:"Childhood Friend",text:"Pretty much! The hard part is getting close enough without getting hurt. But once you're there, it's just a matter of choosing the right action. Simple in theory, challenging in practice!"}],end:!0},what_battle:{sequence:[{speaker:"Childhood Friend",text:"You still have to fight the battle! Capturing is just one option you have during the fight. You can weaken them first, or try to capture them right away - it's up to you and your strategy!"}],end:!0},need_remember:{sequence:[{speaker:"Childhood Friend",text:"Write it down if you need to! The key points are: wild Wildlight only, get close, then capture. Everything else is just practice and patience!"}],end:!0},why_wild:{sequence:[{speaker:"Childhood Friend",text:"Because wild Wildlight are free to choose their trainer! Once a Wildlight belongs to someone else, that bond is sacred. You can only capture ones that haven't chosen a trainer yet."}],end:!0},too_far:{sequence:[{speaker:"Childhood Friend",text:"Then you have to move closer! That's part of the strategy - you might need to use your movement to get into position. It's all about planning your approach!"}],end:!0},amazing:{sequence:[{speaker:"Childhood Friend",text:"Isn't it? Now you have the power to build your team exactly how you want it. Go out there and find the Wildlight that call to you!"}],end:!0},cant_close:{sequence:[{speaker:"Childhood Friend",text:"That's the challenge! You might need to weaken them first, or wait for the right moment. Sometimes you have to be patient and wait for them to come to you, or find a way to get closer safely."}],end:!0},work_every:{sequence:[{speaker:"Childhood Friend",text:"Not every time! Some Wildlight are more stubborn than others. But don't get discouraged - every attempt teaches you something, and when it finally works, it's worth all the effort!"}],end:!0},thank_so_much:{sequence:[{speaker:"Childhood Friend",text:"You're so welcome! I'm just happy I could help you on your journey. Now go out there and show the world what an amazing trainer you're becoming!"}],end:!0}}};Xt.meta;Xt.variables;Xt.nodes;var Zt={meta:{conversation_id:"town/village-elder-1",name:"Village Elder",description:"A wise old man who knows the area well",location:"town",image:"/src/assets/npcs/village-elder.png",backgroundImage:"/src/assets/backgrounds/town.png",conditions:["hasNotVisited_field-1"]},variables:{},nodes:{start:{sequence:[{speaker:"Village Elder",text:"Ah, there you are! I've been watching you grow up in this village, and now I see you've bonded with your first Wildlight. How proud I am to witness this moment!"}],choices:[{type:"fixed",text:"Tell me about the area",actions:["unlockLocation_field-1"],goto:"about_area"},{type:"fixed",text:"Any advice for training my team?",goto:"training_advice"},{type:"fixed",text:"Thank you for your wisdom",goto:"thank_you"}]},restart:{sequence:[{speaker:"Village Elder",text:"What else would you like to know, young one?"}],choices:[{type:"fixed",text:"Tell me about the area",actions:["unlockLocation_field-1"],goto:"about_area"},{type:"fixed",text:"Any advice for training my team?",goto:"training_advice"},{type:"fixed",text:"Thank you for your wisdom",goto:"thank_you"}]},about_area:{sequence:[{speaker:"Village Elder",text:"This village has been our home for generations, but the world beyond holds many opportunities for growth. To the south, you'll find the Training Field - a perfect place for you and your Wildlight to practice and grow stronger together."}],choices:[{type:"fixed",text:"What can I expect at the Training Field?",goto:"training_field_info"},{type:"fixed",text:"Are there other areas to explore?",goto:"other_areas"}]},training_field_info:{sequence:[{speaker:"Village Elder",text:"The Training Field is where many young trainers like yourself begin their journey. You'll find gentle challenges there that will help you and your Wildlight learn to work together. It's a safe place to build confidence before facing the greater trials ahead."}],choices:[{type:"fixed",text:"I'd like to know more.",goto:"restart"}]},other_areas:{sequence:[{speaker:"Village Elder",text:"In time, as you and your team grow stronger, you'll discover many other locations. Some hold ancient secrets, others present new challenges. But remember - every great trainer started with a single step, just like you're taking now."}],choices:[{type:"fixed",text:"I'd like to know more.",goto:"restart"}]},training_advice:{sequence:[{speaker:"Village Elder",text:"The bond between trainer and Wildlight is everything! Always be prepared - stock up on potions and make sure your team is well-trained before venturing into new areas. Each battle teaches you something new."}],choices:[{type:"fixed",text:"Where can I get supplies?",goto:"where_supplies"},{type:"fixed",text:"How do I train my team effectively?",goto:"train_team"}]},where_supplies:{sequence:[{speaker:"Village Elder",text:"The general store owner has everything you need. He's been serving trainers for years and knows exactly what works best for Wildlight care and battle preparation."}],choices:[{type:"fixed",text:"I'd like to know more.",goto:"restart"}]},train_team:{sequence:[{speaker:"Village Elder",text:"Practice makes perfect! Start with the Training Field and work your way up. Each victory makes your Wildlight stronger, and each challenge teaches you both something valuable. The key is patience and understanding your team's strengths."}],choices:[{type:"fixed",text:"I'd like to know more.",goto:"restart"}]},thank_you:{sequence:[{speaker:"Village Elder",text:"You're welcome, young one. I have great faith in you - I've watched you grow, and I know you'll become an exceptional trainer. May your path be safe and your victories be many!"}],end:!0}}};Zt.meta;Zt.variables;Zt.nodes;var en={meta:{conversation_id:"town/village-elder-2",name:"Village Elder",description:"A wise old man who knows the area well",location:"town",image:"/src/assets/npcs/village-elder.png",backgroundImage:"/src/assets/backgrounds/town.png",conditions:["hasVisited_field-1","hasNotVisited_forest-1"]},variables:{},nodes:{start:{sequence:[{speaker:"Village Elder",text:"Ah, I see you've been to the Training Field! How did your first real training go? I can see the confidence growing in your eyes."}],choices:[{type:"fixed",text:"Tell me about more challenging areas",actions:["unlockLocation_forest-1"],goto:"about_forest"},{type:"fixed",text:"I'm ready for bigger challenges",actions:["unlockLocation_forest-1"],goto:"ready_challenges"},{type:"fixed",text:"Any other advice?",goto:"general_advice"}]},restart:{sequence:[{speaker:"Village Elder",text:"What else would you like to know, young trainer?"}],choices:[{type:"fixed",text:"Tell me about more challenging areas",goto:"about_forest"},{type:"fixed",text:"I'm ready for bigger challenges",goto:"ready_challenges"},{type:"fixed",text:"Any other advice?",goto:"general_advice"}]},about_forest:{sequence:[{speaker:"Village Elder",text:"To the north lies the Ancient Forest - a place where the trees themselves seem to hold ancient wisdom. It's more challenging than the Training Field, but the Wildlight there are stronger and more diverse. Many trainers find their second or third team members there."}],choices:[{type:"fixed",text:"What should I expect in the forest?",goto:"forest_expectations"},{type:"fixed",text:"Are there any dangers I should know about?",goto:"forest_dangers"}]},ready_challenges:{sequence:[{speaker:"Village Elder",text:"I can see the fire in your eyes! The Ancient Forest to the north will test both you and your Wildlight. The creatures there are wilder, more cunning, but also more rewarding to befriend. Trust in your training and your bond with your team."}],choices:[{type:"fixed",text:"What makes the forest different?",goto:"forest_differences"},{type:"fixed",text:"Any tips for forest training?",goto:"forest_tips"}]},forest_expectations:{sequence:[{speaker:"Village Elder",text:"The forest is alive in ways the Training Field isn't. You'll encounter Wildlight that have adapted to the shadows and sounds of the woods. Some are territorial, others curious. Each encounter teaches you something new about the natural world and your own abilities."}],choices:[{type:"fixed",text:"I'd like to know more.",goto:"restart"}]},forest_dangers:{sequence:[{speaker:"Village Elder",text:"Respect the forest, and it will respect you. The Wildlight there are not malicious, but they are wild. Some may be protective of their territory, others might test your strength. Always approach with patience and understanding - never with fear or aggression."}],choices:[{type:"fixed",text:"I'd like to know more.",goto:"restart"}]},forest_differences:{sequence:[{speaker:"Village Elder",text:"The forest is unpredictable. Weather changes quickly, paths can be confusing, and the Wildlight there have learned to use the environment to their advantage. But that's what makes it such a valuable training ground - it prepares you for anything the wider world might throw at you."}],end:!0},forest_tips:{sequence:[{speaker:"Village Elder",text:"Listen to the forest. Watch how the Wildlight move and interact with their environment. They'll teach you more about strategy than any book ever could. And remember - sometimes the best approach is to wait, observe, and let the forest show you its secrets."}],end:!0},general_advice:{sequence:[{speaker:"Village Elder",text:"You're growing into a fine trainer. Trust your instincts, care for your team, and never stop learning. Each new location you discover will teach you something unique about the world and about yourself. The journey ahead is long, but I have every confidence you'll make us all proud."}],end:!0}}};en.meta;en.variables;en.nodes;var tn={meta:{conversation_id:"welcome/wildlight-guide",name:"Wildlight Guide",description:"Your guide to the world of Wildlight",location:"welcome",image:"/src/assets/trainers/player.png",backgroundImage:"/src/assets/backgrounds/welcome-dialog.png",conditions:["isNewPlayer"]},variables:{},nodes:{start:{sequence:[{speaker:"Wildlight Guide",text:"Welcome to the World of Wildlight! I'll be your guide throughout your journey. But first, what is your name?"}],choices:[{type:"input",prompt:"What is your name?",var:"player_name",actions:["setPlayerName","addPlayerTrainer"],goto:"introduce_stone_monkey"}]},introduce_stone_monkey:{sequence:[{speaker:"Wildlight Guide",text:"Nice to meet you! I'd like to introduce you to Stone Monkey. He will be joining you on your adventure. Would you like to give him a name?"},{speaker:"Wildlight Guide",image:"src/assets/units/stone-monkey/headshot.png"}],choices:[{type:"input",prompt:"What would you like to name Stone Monkey?",var:"stone_monkey_name",actions:["addStoneMonkey"],goto:"journey_start"}]},journey_start:{sequence:[{speaker:"Wildlight Guide",text:"That's a great name! Let's get you started on your journey."}],end:!0}}};tn.meta;tn.variables;tn.nodes;var K=(e=>(e.MENU="menu",e.NARRATIVE="narrative",e.OVERWORLD="overworld",e.ARMY_MANAGEMENT="army_management",e.PLAYING="playing",e.BATTLE_END="battle_end",e.BESTIARY="bestiary",e.CONVERSATION_EDITOR="conversation_editor",e))(K||{}),wt=(e=>(e.NPC_DIALOG="npc_dialog",e.WELCOME_DIALOG="welcome_dialog",e))(wt||{}),Be=(e=>(e.WON="won",e.LOST="lost",e.DRAW="draw",e))(Be||{});const Oi={status:K.MENU,hasStarted:!1,playerName:null,battleHistory:[],seenUnitTypes:{},seenTrainers:{},playerBackpack:[],currentNarrative:null,currentConversationId:null,conversationFlags:{},completedConversations:{},visitedLocations:{}},Ri=Kt({name:"game",initialState:Oi,reducers:{startGame:e=>{e.hasStarted=!0,e.playerName=null,e.battleHistory=[],e.seenUnitTypes={},e.seenTrainers={},e.conversationFlags={},e.completedConversations={},e.visitedLocations={},e.playerBackpack=[{itemId:"potion",quantity:1}],e.status=K.NARRATIVE,e.currentNarrative=wt.WELCOME_DIALOG,e.currentConversationId="welcome/wildlight-guide"},startOverworld:e=>{e.status=K.OVERWORLD},startArmyManagement:e=>{e.status=K.ARMY_MANAGEMENT},startBestiary:e=>{e.status=K.BESTIARY},startConversationEditor:e=>{e.status=K.CONVERSATION_EDITOR},startBattle:(e,t)=>{e.visitedLocations[t.payload]=!0,e.status=K.PLAYING},returnToMenu:e=>{e.status=K.MENU},endBattle:(e,t)=>{e.battleHistory.push(t.payload),e.status=K.BATTLE_END},resetGame:e=>{e.status=K.OVERWORLD},setPlayerName:(e,t)=>{e.playerName=t.payload},startNPCDialog:(e,t)=>{e.currentConversationId=t.payload,e.currentNarrative=wt.NPC_DIALOG,e.status=K.NARRATIVE},endNPCDialog:e=>{if(!e.currentConversationId)throw new Error("Current conversation id is not set");e.completedConversations[e.currentConversationId]=!0,e.currentConversationId=null,e.currentNarrative=null,e.status=K.OVERWORLD},recordSeenUnitTypes:(e,t)=>{const{locationId:n,unitTypeIds:s}=t.payload,i=n||"no-location";e.seenUnitTypes[i]||(e.seenUnitTypes[i]=[]);const r=e.seenUnitTypes[i],o=s.filter(l=>!r.includes(l));e.seenUnitTypes[i]=[...r,...o]},recordSeenTrainer:(e,t)=>{const{locationId:n,trainerId:s}=t.payload;e.seenTrainers[n]||(e.seenTrainers[n]=[]);const i=e.seenTrainers[n];i.includes(s)||(e.seenTrainers[n]=[...i,s])},consumeItem:(e,t)=>{const n=t.payload,s=e.playerBackpack.findIndex(i=>i.itemId===n);if(s!==-1){const i=e.playerBackpack[s];i.quantity>1?e.playerBackpack[s]={...i,quantity:i.quantity-1}:e.playerBackpack.splice(s,1)}},addItemToBackpack:(e,t)=>{const{itemId:n,quantity:s}=t.payload,i=e.playerBackpack.findIndex(r=>r.itemId===n);i!==-1?e.playerBackpack[i].quantity+=s:e.playerBackpack.push({itemId:n,quantity:s})},setConversationFlag:(e,t)=>{const{flagName:n,value:s}=t.payload;e.conversationFlags[n]=s}}}),{actions:J,reducer:Fi}=Ri,Os=(e,t)=>({id:`addItem_${e}_${t}`,execute:(n,s)=>J.addItemToBackpack({itemId:e,quantity:t})}),Di=Os("antidote",1),Bi=Os("potion",1),Wi=Object.freeze(Object.defineProperty({__proto__:null,addItemAntidote:Di,addItemPotion:Bi},Symbol.toStringTag,{value:"Module"})),Gi=(e,t=!0)=>({id:`setFlag_${e}_${t}`,execute:(n,s)=>J.setConversationFlag({flagName:e,value:t})}),Hi=Gi("hasTalkedToVillageElder",!0),Vi=Object.freeze(Object.defineProperty({__proto__:null,setFlagHasTalkedToVillageElder:Hi},Symbol.toStringTag,{value:"Module"})),Yi="ancient-forest",Ki="Ancient Forest",zi="A challenging forest with advanced enemies and mysterious wildlight",Ji="/src/assets/backgrounds/forest.png",Qi=[{id:"forest-trainer-1",name:"Forest Guardian",description:"A skilled trainer who protects the forest",battleConfigId:"ancient-forest/old-man-forest",trainerId:"old-man-forest",isUnlocked:!0},{id:"forest-trainer-2",name:"Wildlight Researcher",description:"A researcher studying wildlight behavior",battleConfigId:"ancient-forest/forest-researcher",unlockRequirements:[{type:"location_activity",locationId:"ancient-forest",activityType:"trainer",activityId:"forest-trainer-1"}],isUnlocked:!1}],Xi=[{id:"forest-hermit",name:"Forest Hermit",description:"A mysterious hermit who lives deep in the forest",conversationId:"forest/hermit-1",image:"/src/assets/npcs/forest-hermit.png",unlockRequirements:[{type:"location_activity",locationId:"ancient-forest",activityType:"wildlight",activityId:"search"}],isUnlocked:!1}],Zi={id:"forest-shop",name:"Forest Trader",description:"A traveling merchant with forest-specific items",items:[{itemId:"potion",price:45,stock:15},{itemId:"super-potion",price:90,stock:8},{itemId:"antidote",price:200,stock:3}],unlockRequirements:[{type:"location_activity",locationId:"ancient-forest",activityType:"npc",activityId:"forest-hermit"}],isUnlocked:!1},er={battleConfigId:"ancient-forest/wildlight"},tr=[{type:"location_activity",locationId:"town",activityType:"trainer",activityId:"town-trainer-1"}],nr={id:Yi,name:Ki,description:zi,backgroundImage:Ji,trainers:Qi,npcs:Xi,shopConfig:Zi,wildlightSearchConfig:er,unlockRequirements:tr},sr="field-1",ar="Ancient Forest",ir="A challenging forest with advanced enemies and mysterious wildlight",rr="/src/assets/backgrounds/forest.png",or=[{id:"forest-trainer-1",name:"Forest Guardian",description:"A skilled trainer who protects the forest",battleConfigId:"ancient-forest/old-man-forest",trainerId:"old-man-forest",isUnlocked:!0},{id:"forest-trainer-2",name:"Wildlight Researcher",description:"A researcher studying wildlight behavior",battleConfigId:"ancient-forest/forest-researcher",unlockRequirements:[{type:"location_activity",locationId:"ancient-forest",activityType:"trainer",activityId:"forest-trainer-1"}],isUnlocked:!1}],lr=[{id:"forest-hermit",name:"Forest Hermit",description:"A mysterious hermit who lives deep in the forest",conversationId:"forest/hermit-1",image:"/src/assets/npcs/forest-hermit.png",unlockRequirements:[{type:"location_activity",locationId:"ancient-forest",activityType:"wildlight",activityId:"search"}],isUnlocked:!1}],cr={id:"forest-shop",name:"Forest Trader",description:"A traveling merchant with forest-specific items",items:[{itemId:"potion",price:45,stock:15},{itemId:"super-potion",price:90,stock:8},{itemId:"antidote",price:200,stock:3}],unlockRequirements:[{type:"location_activity",locationId:"ancient-forest",activityType:"npc",activityId:"forest-hermit"}],isUnlocked:!1},dr={battleConfigId:"field-1/wildlight"},ur=[{type:"location_activity",locationId:"town",activityType:"trainer",activityId:"town-trainer-1"}],mr={id:sr,name:ar,description:ir,backgroundImage:rr,trainers:or,npcs:lr,shopConfig:cr,wildlightSearchConfig:dr,unlockRequirements:ur},hr="lakeside-town",fr="Lakeside Town",pr="A bustling town by the woodland lakes",gr="/src/assets/backgrounds/lakeside-town.png",yr=[{id:"lakeside-trainer-1",name:"Water Specialist",description:"A trainer who specializes in water-type wildlight",battleConfigId:"lakeside-town/woodland-lakes",isUnlocked:!0},{id:"lakeside-trainer-2",name:"Lake Guardian",description:"The guardian of the sacred lake",battleConfigId:"lakeside-town/lake-guardian",trainerId:"lake-guardian",unlockRequirements:[{type:"location_activity",locationId:"lakeside-town",activityType:"trainer",activityId:"lakeside-trainer-1"}],isUnlocked:!1}],br=[{id:"lakeside-merchant",name:"Lakeside Merchant",description:"A wealthy merchant with rare items",conversationId:"lakeside/merchant-1",image:"/src/assets/npcs/lakeside-merchant.png",isUnlocked:!0},{id:"lakeside-scholar",name:"Lake Scholar",description:"A scholar studying the lake's mysteries",conversationId:"lakeside/scholar-1",image:"/src/assets/npcs/lakeside-scholar.png",unlockRequirements:[{type:"location_activity",locationId:"lakeside-town",activityType:"wildlight",activityId:"search"}],isUnlocked:!1}],xr={id:"lakeside-shop",name:"Lakeside Emporium",description:"A high-end shop with rare and powerful items",items:[{itemId:"potion",price:45,stock:15},{itemId:"super-potion",price:90,stock:8},{itemId:"antidote",price:200,stock:3},{itemId:"revive",price:500,stock:2}],isUnlocked:!0},vr={battleConfigId:"lakeside-town/wildlight"},wr=[{type:"location_activity",locationId:"ancient-forest",activityType:"wildlight",activityId:"search"}],kr={id:hr,name:fr,description:pr,backgroundImage:gr,trainers:yr,npcs:br,shopConfig:xr,wildlightSearchConfig:vr,unlockRequirements:wr},jr="town",Nr="Town",$r="A peaceful town where your journey begins",_r="/src/assets/backgrounds/town.png",Ir=[{id:"town-trainer-1",name:"Young Trainer",description:"A beginner trainer looking for practice",battleConfigId:"town/training-field",isUnlocked:!0}],Tr=[{id:"town-elder",name:"Village Elder",description:"A wise elder who knows much about the world",conversationId:"town/village-elder-1",image:"/src/assets/npcs/village-elder.png",isUnlocked:!0},{id:"town-guide",name:"Wildlight Guide",description:"An expert on wildlight creatures",conversationId:"town/wildlight-guide",image:"/src/assets/npcs/wildlight-guide.png",isUnlocked:!0}],Cr={id:"town-shop",name:"Trainer Store",description:"A basic shop with essential items",items:[{itemId:"potion",price:50,stock:10},{itemId:"super-potion",price:100,stock:5}],isUnlocked:!0},Er={battleConfigId:"town/wildlight"},Sr=[],Ar={id:jr,name:Nr,description:$r,backgroundImage:_r,trainers:Ir,npcs:Tr,shopConfig:Cr,wildlightSearchConfig:Er,unlockRequirements:Sr};var Lr=xi();const Ur=zt(Lr);var qr=vi();const Pr=zt(qr),Mr="http://json-schema.org/draft-07/schema#",Or="Attack Configuration Schema",Rr="Schema for validating attack configuration JSON files",Fr="object",Dr={id:{type:"string",description:"Unique identifier for the attack, must match the filename (without .json extension)",pattern:"^[a-z0-9-]+$"},name:{type:"string",description:"Display name for the attack",minLength:1},description:{type:"string",description:"Description of what the attack does",minLength:1},pattern:{$ref:"shared-definitions.schema.json#/$defs/AttackPattern"},power:{type:"string",description:"Damage power in dice notation (e.g., '1d6', '2d4', '0d0')",pattern:"^\\d+d\\d+$"},effects:{type:"array",description:"Optional array of effects applied by this attack",items:{$ref:"shared-definitions.schema.json#/$defs/AttackEffect"},uniqueItems:!0}},Br=["id","name","description","pattern","power"],Wr=!1,Gr={$schema:Mr,title:Or,description:Rr,type:Fr,properties:Dr,required:Br,additionalProperties:Wr},Hr="http://json-schema.org/draft-07/schema#",Vr="Battle Configuration Schema",Yr="Schema for validating battle configuration JSON files",Kr="object",zr={id:{type:"string",description:"Unique identifier for the battle config, must match the filename (without .json extension)",pattern:"^[a-z0-9-/]+$"},name:{type:"string",description:"Display name for the battle location",minLength:1},description:{type:"string",description:"Description of the battle location",minLength:1},radius:{type:"number",description:"Radius of the battle map in hex tiles",minimum:1},pointLimit:{type:"number",description:"Maximum point limit for player army",minimum:1},terrain:{oneOf:[{$ref:"#/$defs/TerrainRatioConfig"},{$ref:"#/$defs/TerrainLayoutConfig"}]},enemyUnits:{oneOf:[{$ref:"#/$defs/UnitRatioConfig"},{$ref:"#/$defs/UnitLayoutConfig"},{$ref:"#/$defs/UnitSquadConfig"}]}},Jr=["id","name","description","radius","pointLimit","terrain","enemyUnits"],Qr=!1,Xr={TerrainRatioConfig:{type:"object",description:"Terrain configuration using ratios",properties:{ratios:{type:"object",description:"Terrain type ratios",properties:{grass:{type:"number",minimum:0},mountain:{type:"number",minimum:0},forest:{type:"number",minimum:0},water:{type:"number",minimum:0}},additionalProperties:!1,minProperties:1}},required:["ratios"],additionalProperties:!1},TerrainLayoutConfig:{type:"object",description:"Terrain configuration using specific tile layout",properties:{tiles:{type:"array",description:"2D array of terrain types",items:{type:"array",items:{oneOf:[{type:"string",enum:["grass","mountain","forest","water"]},{type:"null",description:"No specific tile layout (null value)"}]}}}},required:["tiles"],additionalProperties:!1},UnitRatioConfig:{type:"object",description:"Unit configuration using ratios",properties:{count:{type:"number",description:"Total number of units",minimum:0},ratios:{type:"object",description:"Unit type ratios",patternProperties:{"^[a-z0-9-]+$":{type:"number",minimum:0}},minProperties:0}},required:["count","ratios"],additionalProperties:!1},UnitLayoutConfig:{type:"object",description:"Unit configuration using specific positions",properties:{tiles:{type:"object",description:"Unit type to positions mapping",patternProperties:{"^[a-z0-9-]+$":{type:"array",items:{$ref:"#/$defs/Position"}}}}},required:["tiles"],additionalProperties:!1},UnitSquadConfig:{type:"object",description:"Unit configuration using a single squad",properties:{squad:{type:"array",description:"Array of units in the squad",items:{$ref:"#/$defs/UnitInSquad"},minItems:1}},required:["squad"],additionalProperties:!1},UnitInSquad:{type:"object",description:"A unit within a squad",properties:{unitType:{type:"string",description:"Type of unit",pattern:"^[a-z0-9-]+$"},level:{type:"number",description:"Level of the unit",minimum:1},position:{$ref:"#/$defs/Position"},name:{type:"string",description:"Optional custom name for the unit"},trainerId:{type:"string",description:"Trainer ID for trainer units",pattern:"^[a-z0-9-]+$"}},required:["unitType","level"],additionalProperties:!1},Position:{type:"object",description:"Hex grid position",properties:{q:{type:"number"},r:{type:"number"}},required:["q","r"],additionalProperties:!1}},Zr={$schema:Hr,title:Vr,description:Yr,type:Kr,properties:zr,required:Jr,additionalProperties:Qr,$defs:Xr},eo="http://json-schema.org/draft-07/schema#",to="Conversation Configuration Schema",no="Schema for validating YAML conversation configuration files",so="object",ao=["meta","variables","nodes"],io={meta:{type:"object",title:"Conversation Metadata",description:"Metadata about the conversation",required:["conversation_id","name","description","location","image","backgroundImage","conditions"],properties:{conversation_id:{type:"string",description:"Unique identifier for this conversation"},name:{type:"string",description:"Display name of the NPC"},description:{type:"string",description:"Description of the NPC"},location:{type:"string",description:"Location where this conversation can occur"},image:{type:"string",description:"Path to the NPC's image"},backgroundImage:{type:"string",description:"Path to the background image for the conversation"},conditions:{type:"array",description:"Conditions that must be met for this conversation to be available",items:{type:"string"}}},additionalProperties:!1},variables:{type:"object",title:"Conversation Variables",description:"Variables that can be used throughout the conversation",patternProperties:{"^[a-zA-Z_][a-zA-Z0-9_]*$":{oneOf:[{type:"string"},{type:"number"},{type:"boolean"}],description:"Variable value"}},additionalProperties:!1},nodes:{type:"object",title:"Conversation Nodes",description:"Individual conversation nodes",patternProperties:{"^[a-zA-Z_][a-zA-Z0-9_]*$":{$ref:"#/definitions/node"}},additionalProperties:!1}},ro=!1,oo={node:{type:"object",title:"Conversation Node",description:"A single node in the conversation tree",properties:{sequence:{type:"array",description:"Sequence of dialogue to display",items:{$ref:"#/definitions/sequenceItem"}},choices:{type:"array",description:"Available choices for the player",items:{$ref:"#/definitions/choice"}},end:{type:"boolean",description:"Whether this node ends the conversation",default:!1},actions:{type:"array",description:"Actions to execute when this node is reached",items:{type:"string"}}},additionalProperties:!1,anyOf:[{required:["sequence"]},{required:["choices"]},{required:["end"]}]},sequenceItem:{type:"object",title:"Sequence Item",description:"A single item in a dialogue sequence",required:["speaker"],properties:{speaker:{type:"string",description:"Who is speaking"},text:{type:"string",description:"The dialogue text"},image:{type:"string",description:"Path to an image to display with this sequence item"}},additionalProperties:!1,oneOf:[{required:["text"]},{required:["image"]}]},choice:{type:"object",title:"Player Choice",description:"A choice available to the player",required:["type","goto"],properties:{type:{type:"string",enum:["fixed","input"],description:"Type of choice"},text:{type:"string",description:"Text to display for fixed choices"},prompt:{type:"string",description:"Prompt text for input choices"},var:{type:"string",description:"Variable name to store input value"},goto:{type:"string",description:"Node to go to when this choice is selected"},actions:{type:"array",description:"Actions to execute when this choice is selected",items:{type:"string"}}},additionalProperties:!1,if:{properties:{type:{const:"fixed"}}},then:{required:["text"]},else:{if:{properties:{type:{const:"input"}}},then:{required:["prompt","var"]}}}},lo={$schema:eo,title:to,description:no,type:so,required:ao,properties:io,additionalProperties:ro,definitions:oo},co="http://json-schema.org/draft-07/schema#",uo="object",mo={id:{type:"string",description:"Unique identifier for the item"},name:{type:"string",description:"Display name of the item"},description:{type:"string",description:"Description of what the item does"},consumable:{type:"boolean",description:"Whether the item is consumed when used (true) or permanent (false)"},pattern:{$ref:"shared-definitions.schema.json#/$defs/AttackPattern"},effects:{type:"array",description:"Array of effects that the item applies",items:{$ref:"shared-definitions.schema.json#/$defs/AttackEffect"}}},ho=["id","name","description","consumable","pattern"],fo={$schema:co,type:uo,properties:mo,required:ho},po="http://json-schema.org/draft-07/schema#",go="Location Configuration Schema",yo="Schema for validating location configuration JSON files",bo="object",xo={id:{type:"string",description:"Unique identifier for the location, must match the filename (without .json extension)",pattern:"^[a-z0-9-]+$"},name:{type:"string",description:"Display name for the location",minLength:1},description:{type:"string",description:"Description of the location",minLength:1},backgroundImage:{type:"string",description:"Path to background image for the location",minLength:1},trainers:{type:"array",description:"Array of trainers available at this location",items:{$ref:"#/$defs/TrainerConfig"},default:[]},npcs:{type:"array",description:"Array of NPCs available at this location",items:{$ref:"#/$defs/NPCConfig"},default:[]},shopConfig:{$ref:"#/$defs/ShopConfig",description:"Shop configuration for this location (optional)"},wildlightSearchConfig:{type:"object",description:"Configuration for wildlight search at this location",properties:{battleConfigId:{type:"string",description:"ID of the battle configuration for wildlight search",pattern:"^[a-z0-9-/]+$"}},required:["battleConfigId"],additionalProperties:!1},unlockRequirements:{type:"array",description:"Requirements to unlock this location",items:{$ref:"#/$defs/LocationUnlockRequirement"},default:[]}},vo=["id","name","description","backgroundImage","wildlightSearchConfig"],wo=!1,ko={TrainerConfig:{type:"object",description:"Configuration for a trainer",properties:{id:{type:"string",description:"Unique identifier for the trainer",pattern:"^[a-z0-9-]+$"},name:{type:"string",description:"Display name for the trainer",minLength:1},description:{type:"string",description:"Description of the trainer",minLength:1},battleConfigId:{type:"string",description:"ID of the battle configuration for this trainer",pattern:"^[a-z0-9-/]+$"},trainerId:{type:"string",description:"ID of the trainer for this trainer (optional)",pattern:"^[a-z0-9-]+$"},unlockRequirements:{type:"array",description:"Requirements to unlock this trainer",items:{$ref:"#/$defs/ActivityUnlockRequirement"},default:[]},isUnlocked:{type:"boolean",description:"Whether this trainer is initially unlocked",default:!0}},required:["id","name","description","battleConfigId"],additionalProperties:!1},NPCConfig:{type:"object",description:"Configuration for an NPC",properties:{id:{type:"string",description:"Unique identifier for the NPC",pattern:"^[a-z0-9-]+$"},name:{type:"string",description:"Display name for the NPC",minLength:1},description:{type:"string",description:"Description of the NPC",minLength:1},conversationId:{type:"string",description:"ID of the conversation for this NPC",pattern:"^[a-z0-9-/]+$"},image:{type:"string",description:"Path to image for this NPC",minLength:1},unlockRequirements:{type:"array",description:"Requirements to unlock this NPC",items:{$ref:"#/$defs/ActivityUnlockRequirement"},default:[]},isUnlocked:{type:"boolean",description:"Whether this NPC is initially unlocked",default:!0}},required:["id","name","description","conversationId","image"],additionalProperties:!1},ShopConfig:{type:"object",description:"Configuration for a shop",properties:{id:{type:"string",description:"Unique identifier for the shop",pattern:"^[a-z0-9-]+$"},name:{type:"string",description:"Display name for the shop",minLength:1},description:{type:"string",description:"Description of the shop",minLength:1},items:{type:"array",description:"Items available in this shop",items:{$ref:"#/$defs/ShopItem"},minItems:1},unlockRequirements:{type:"array",description:"Requirements to unlock this shop",items:{$ref:"#/$defs/ActivityUnlockRequirement"},default:[]},isUnlocked:{type:"boolean",description:"Whether this shop is initially unlocked",default:!0}},required:["id","name","description","items"],additionalProperties:!1},ShopItem:{type:"object",description:"An item available in a shop",properties:{itemId:{type:"string",description:"ID of the item",pattern:"^[a-z0-9-]+$"},price:{type:"number",description:"Price of the item",minimum:0},stock:{type:"number",description:"Stock quantity of the item",minimum:0}},required:["itemId","price","stock"],additionalProperties:!1},LocationUnlockRequirement:{type:"object",description:"Requirement to unlock a location",properties:{type:{type:"string",description:"Type of requirement",enum:["location_activity"]},locationId:{type:"string",description:"ID of the location where the activity must be completed",pattern:"^[a-z0-9-]+$"},activityType:{type:"string",description:"Type of activity that must be completed",enum:["trainer","npc","shop","wildlight"]},activityId:{type:"string",description:"ID of the specific activity that must be completed",pattern:"^[a-z0-9-]+$"}},required:["type","locationId","activityType","activityId"],additionalProperties:!1},ActivityUnlockRequirement:{type:"object",description:"Requirement to unlock an activity",properties:{type:{type:"string",description:"Type of requirement",enum:["location_activity","conversation_flag","item_owned"]},locationId:{type:"string",description:"ID of the location (for location_activity type)",pattern:"^[a-z0-9-]+$"},activityType:{type:"string",description:"Type of activity (for location_activity type)",enum:["trainer","npc","shop","wildlight"]},activityId:{type:"string",description:"ID of the activity (for location_activity type)",pattern:"^[a-z0-9-]+$"},conversationId:{type:"string",description:"ID of the conversation (for conversation_flag type)",pattern:"^[a-z0-9-]+$"},flagName:{type:"string",description:"Name of the conversation flag (for conversation_flag type)",minLength:1},itemId:{type:"string",description:"ID of the item (for item_owned type)",pattern:"^[a-z0-9-]+$"}},required:["type"],additionalProperties:!1}},jo={$schema:po,title:go,description:yo,type:bo,properties:xo,required:vo,additionalProperties:wo,$defs:ko},No="http://json-schema.org/draft-07/schema#",$o="shared-definitions.schema.json",_o="Shared Definitions Schema",Io="Common definitions shared across multiple configuration schemas",To="object",Co={},Eo={AttackPattern:{type:"array",description:"Attack pattern configuration",minItems:1,maxItems:4,oneOf:[{description:"Direct attack pattern - no arguments",items:[{const:"direct",description:"Direct attack pattern, adjacent tiles only"}],minItems:1,maxItems:1,additionalItems:!1},{description:"Self attack pattern - no arguments",items:[{const:"self",description:"Self attack pattern, self only"}],minItems:1,maxItems:1,additionalItems:!1},{description:"Ranged attack pattern - minRange, maxRange",items:[{const:"ranged",description:"Ranged attack pattern"},{type:"number",minimum:0,description:"Minimum range"},{type:"number",minimum:0,description:"Maximum range"}],minItems:3,maxItems:3,additionalItems:!1},{description:"AOE attack pattern - minRange, maxRange, areaEffect",items:[{const:"aoe",description:"AOE attack pattern"},{type:"number",minimum:0,description:"Minimum range"},{type:"number",minimum:0,description:"Maximum range"},{type:"number",minimum:0,description:"Area effect"}],minItems:4,maxItems:4,additionalItems:!1},{description:"Line attack pattern - minRange, maxRange, lineLength",items:[{const:"line",description:"Line attack pattern"},{type:"number",minimum:0,description:"Minimum range"},{type:"number",minimum:0,description:"Maximum range"},{type:"number",minimum:0,description:"Line length"}],minItems:4,maxItems:4,additionalItems:!1},{description:"Triple line attack pattern - lineLength",items:[{const:"tripleLine",description:"Triple line attack pattern"},{type:"number",minimum:0,description:"Line length"}],minItems:2,maxItems:2,additionalItems:!1},{description:"Torus attack pattern - innerRadius, outerRadius",items:[{const:"torus",description:"Torus attack pattern"},{type:"number",minimum:0,description:"Inner radius"},{type:"number",minimum:0,description:"Outer radius"}],minItems:3,maxItems:3,additionalItems:!1}]},AttackEffect:{type:"object",description:"An effect applied by an attack or item",properties:{type:{type:"string",enum:["apply_modifier","heal","push","poison","stun","sleep","burn","bleed","shield","reflect","teleport","root","haste","drain","create_terrain","critical_strike","armor_pierce","cure_poison"],description:"Type of effect to apply"},modifierType:{type:"string",enum:["attack_multiplier","defense_multiplier"],description:"Required for apply_modifier effects"},value:{type:"number",description:"Effect value (damage, healing, modifier amount)"},duration:{type:["number","null"],minimum:1,description:"Duration in turns (required for poison, stun, sleep, burn, bleed, shield, reflect, root, haste, drain, create_terrain effects). Can be null for permanent effects."},distance:{type:"number",minimum:1,description:"Distance for push effects"},damage:{type:"number",minimum:1,description:"Damage amount for burn and bleed effects"},percentage:{type:"number",minimum:0,maximum:100,description:"Percentage value for reflect and armor_pierce effects"},bonusRange:{type:"number",minimum:1,description:"Bonus movement range for haste effects"},amount:{type:"number",minimum:1,description:"Amount for shield and drain effects"},position:{type:"object",description:"Target position for teleport effects",properties:{q:{type:"number"},r:{type:"number"}},required:["q","r"],additionalProperties:!1},terrainType:{type:"string",description:"Type of terrain to create for create_terrain effects"},positions:{type:"array",description:"Array of positions for create_terrain effects",items:{type:"object",properties:{q:{type:"number"},r:{type:"number"}},required:["q","r"],additionalProperties:!1}},multiplier:{type:"number",minimum:1,description:"Multiplier for critical_strike effects"}},required:["type"],additionalProperties:!1,allOf:[{if:{properties:{type:{const:"apply_modifier"}}},then:{required:["modifierType","value"]}},{if:{properties:{type:{const:"heal"}}},then:{required:["value"]}},{if:{properties:{type:{const:"push"}}},then:{required:["distance"]}},{if:{properties:{type:{const:"poison"}}},then:{required:["duration"]}},{if:{properties:{type:{const:"stun"}}},then:{required:["duration"]}},{if:{properties:{type:{const:"sleep"}}},then:{required:["duration"]}},{if:{properties:{type:{const:"burn"}}},then:{required:["damage","duration"]}},{if:{properties:{type:{const:"bleed"}}},then:{required:["damage","duration"]}},{if:{properties:{type:{const:"shield"}}},then:{required:["amount","duration"]}},{if:{properties:{type:{const:"reflect"}}},then:{required:["percentage","duration"]}},{if:{properties:{type:{const:"teleport"}}},then:{required:["position"]}},{if:{properties:{type:{const:"root"}}},then:{required:["duration"]}},{if:{properties:{type:{const:"haste"}}},then:{required:["bonusRange","duration"]}},{if:{properties:{type:{const:"drain"}}},then:{required:["amount","duration"]}},{if:{properties:{type:{const:"create_terrain"}}},then:{required:["terrainType","positions","duration"]}},{if:{properties:{type:{const:"critical_strike"}}},then:{required:["multiplier"]}},{if:{properties:{type:{const:"armor_pierce"}}},then:{required:["percentage"]}}]}},So={$schema:No,$id:$o,title:_o,description:Io,type:To,properties:Co,$defs:Eo},Ao="http://json-schema.org/draft-07/schema#",Lo="Trainer Configuration Schema",Uo="Schema for validating trainer configuration JSON files",qo="object",Po={id:{type:"string",description:"Unique identifier for the trainer, must match the filename (without .json extension)",pattern:"^[a-z0-9-]+$"},name:{type:"string",description:"Display name for the trainer",minLength:1},aiStrategy:{type:"string",description:"AI strategy used by this trainer",enum:["none","basic","improved"],minLength:1},battleQuotes:{type:"array",description:"Array of battle quotes the trainer can say",items:{type:"string",minLength:1},minItems:0,uniqueItems:!0},backpack:{type:"array",description:"Array of backpack items the trainer can use",items:{type:"object",properties:{itemId:{type:"string",description:"Item ID",minLength:1},quantity:{type:"number",description:"Quantity",minimum:1}}}}},Mo=["id","name","aiStrategy","battleQuotes","backpack"],Oo=!1,Ro={$schema:Ao,title:Lo,description:Uo,type:qo,properties:Po,required:Mo,additionalProperties:Oo},Fo="http://json-schema.org/draft-07/schema#",Do="Unit Configuration Schema",Bo="Schema for validating unit configuration JSON files",Wo="object",Go={unitType:{type:"string",description:"Unique identifier for the unit type, must match the filename (without .json extension)",pattern:"^[a-z0-9-]+$"},name:{type:"string",description:"Display name for the unit type",minLength:1},affinity:{type:"string",description:"Elemental affinity of the unit",enum:["fire","water","earth","air","lightning","night"]},family:{type:"string",description:"Creature family of the unit",enum:["beast","dragon","fish","bird","plant"]},movement:{$ref:"#/$defs/MovementRestrictions"},levelingConfig:{$ref:"#/$defs/LevelingConfig"}},Ho=["unitType","name","affinity","family","movement","levelingConfig"],Vo=!1,Yo={MovementRestrictions:{type:"object",description:"Movement capabilities and restrictions",properties:{range:{type:"number",description:"Movement range in hex tiles",minimum:0},canSwim:{type:"boolean",description:"Whether the unit can move through water"},canClimb:{type:"boolean",description:"Whether the unit can climb mountains"},canFly:{type:"boolean",description:"Whether the unit can fly over obstacles"},canWalk:{type:"boolean",description:"Whether the unit can walk on normal terrain"}},required:["range","canSwim","canClimb","canFly","canWalk"],additionalProperties:!1},LevelingConfig:{type:"object",description:"Leveling and progression configuration",properties:{maxLevel:{type:"number",description:"Maximum level the unit can reach",minimum:1},experienceCurve:{type:"number",description:"Experience curve multiplier",minimum:1},statGrowth:{$ref:"#/$defs/StatGrowth"},allocationPoints:{type:"number",description:"Number of stat points available for allocation per level",minimum:0},learnableAttacks:{type:"array",description:"Attacks the unit can learn at specific levels",items:{$ref:"#/$defs/LearnableAttack"}}},required:["maxLevel","experienceCurve","statGrowth","allocationPoints","learnableAttacks"],additionalProperties:!1},StatGrowth:{type:"object",description:"Stat growth per level",properties:{health:{type:"number",description:"Health points gained per level",minimum:0},attack:{type:"number",description:"Attack points gained per level",minimum:0},defense:{type:"number",description:"Defense points gained per level",minimum:0}},required:["health","attack","defense"],additionalProperties:!1},LearnableAttack:{type:"object",description:"An attack that can be learned at a specific level",properties:{attackId:{type:"string",description:"ID of the attack to learn",pattern:"^[a-z0-9-]+$"},requiredLevel:{type:"number",description:"Level required to learn this attack",minimum:1}},required:["attackId","requiredLevel"],additionalProperties:!1}},Ko={$schema:Fo,title:Do,description:Bo,type:Wo,properties:Go,required:Ho,additionalProperties:Vo,$defs:Yo},_e=new Ur({allErrors:!0,strict:!1,useDefaults:!0});Pr(_e);_e.addSchema(So);const rs=_e.compile(Gr),os=_e.compile(Zr),ls=_e.compile(Ro),cs=_e.compile(fo),ds=_e.compile(jo),us=_e.compile(Ko),ms=_e.compile(lo),zo=e=>{const t=rs(e);return{isValid:!!t,errors:t?[]:(rs.errors||[]).map(n=>`${n.instancePath||"root"}: ${n.message}`)}},Jo=e=>{const t=os(e);return{isValid:!!t,errors:t?[]:(os.errors||[]).map(n=>`${n.instancePath||"root"}: ${n.message}`)}},Qo=e=>{const t=ls(e);return{isValid:!!t,errors:t?[]:(ls.errors||[]).map(n=>`${n.instancePath||"root"}: ${n.message}`)}},Xo=e=>{const t=us(e);return{isValid:!!t,errors:t?[]:(us.errors||[]).map(n=>`${n.instancePath||"root"}: ${n.message}`)}},Zo=e=>{const t=cs(e);return{isValid:!!t,errors:t?[]:(cs.errors||[]).map(n=>`${n.instancePath||"root"}: ${n.message}`)}},el=e=>{const t=ds(e);return{isValid:!!t,errors:t?[]:(ds.errors||[]).map(n=>`${n.instancePath||"root"}: ${n.message}`)}},tl=e=>{const t=ms(e);return{isValid:!!t,errors:t?[]:(ms.errors||[]).map(n=>`${n.instancePath||"root"}: ${n.message}`)}},Rs={};let Fs=!1;const nl=()=>{Object.entries(Object.assign({"./locationConfigs/ancient-forest.json":nr,"./locationConfigs/field-1.json":mr,"./locationConfigs/lakeside-town.json":kr,"./locationConfigs/town.json":Ar})).forEach(([t,n])=>{try{const s=t.replace("./locationConfigs/","").replace(".json",""),i=n,r=el(i);if(!r.isValid){console.error(`Location config ${s} failed schema validation:`,r.errors);return}if(!i.id){console.warn(`Location config ${s} is missing id field, skipping`);return}Rs[i.id]=i}catch(s){console.error(`Failed to process location config from ${t}:`,s)}}),Fs=!0},sl=()=>(Fs||nl(),Object.values(Rs)),al=sl(),il=["town"],hs={locations:al,initialUnlockedLocations:il},nn="town",En="field-1",Ds="forest-1",rl=()=>({locations:hs.locations,playerLocationId:nn,unlockedLocations:hs.initialUnlockedLocations,completedActivities:{}}),fs=rl(),ol=Kt({name:"overworld",initialState:fs,reducers:{reset:()=>fs,moveToLocation:(e,t)=>{const n=t.payload;e.unlockedLocations.includes(n)&&(e.playerLocationId=n)},unlockLocation:(e,t)=>{const n=t.payload;e.unlockedLocations.includes(n)||e.unlockedLocations.push(n)},completeActivity:(e,t)=>{const{locationId:n,activityType:s,activityId:i}=t.payload,r=`${n}:${s}:${i}`;e.completedActivities[r]=!0},unlockActivity:(e,t)=>{console.log("Unlocking activity:",t.payload)}}}),{actions:Se,reducer:ll}=ol,Sn=e=>({id:`unlockLocation_${e}`,execute:(t,n)=>Se.unlockLocation(e)}),cl=Sn(nn),dl=Sn(En),ul=Sn(Ds),ml=Object.freeze(Object.defineProperty({__proto__:null,unlockField1:dl,unlockForest1:ul,unlockTown:cl},Symbol.toStringTag,{value:"Module"})),hl=""+new URL("bestiary-sMvoG4Ed.png",import.meta.url).href,fl=""+new URL("bestiary-DWGDSaB3.png",import.meta.url).href,pl=""+new URL("bestiary-DIk_RWLx.png",import.meta.url).href,gl=""+new URL("bestiary-BpqYAblO.png",import.meta.url).href,yl=""+new URL("bestiary-DnmaEvFw.png",import.meta.url).href,bl=""+new URL("bestiary-B2TPc0nt.png",import.meta.url).href,xl=""+new URL("bestiary-CRpBm_BR.png",import.meta.url).href,vl=""+new URL("bestiary-ypJsnzqT.png",import.meta.url).href,wl=""+new URL("bestiary-CLaUsBEP.png",import.meta.url).href,kl=""+new URL("bestiary-DXdwZpz-.png",import.meta.url).href,jl=""+new URL("bestiary-Cf0BHUqB.png",import.meta.url).href,Nl=""+new URL("bestiary-O9oJ7oSh.png",import.meta.url).href,$l=""+new URL("headshot-BanPnJID.png",import.meta.url).href,_l=""+new URL("headshot-Bk7yZLfb.png",import.meta.url).href,Il=""+new URL("headshot-BoPkBDpD.png",import.meta.url).href,Tl=""+new URL("headshot-BwLD7mG8.png",import.meta.url).href,Cl=""+new URL("headshot-Dr39Yegn.png",import.meta.url).href,El=""+new URL("headshot-B7UtaseS.png",import.meta.url).href,Sl=""+new URL("headshot-CNBn2YMQ.png",import.meta.url).href,Al=""+new URL("headshot-CmWVhp4R.png",import.meta.url).href,Ll=""+new URL("headshot-D69Dcwk3.png",import.meta.url).href,Ul=""+new URL("headshot-iwY7fvVI.png",import.meta.url).href,ql=""+new URL("headshot-BYeveauq.png",import.meta.url).href,Pl=""+new URL("headshot-Boh3R0M7.png",import.meta.url).href,Ml=""+new URL("battle-icon-DSjCBs_2.png",import.meta.url).href,Ol=""+new URL("battle-icon-BFkiiA-B.png",import.meta.url).href,Rl=""+new URL("battle-icon-CHR--X3N.png",import.meta.url).href,Fl=""+new URL("battle-icon-YKHVX3Uf.png",import.meta.url).href,Dl=""+new URL("battle-icon-J6OaaJJG.png",import.meta.url).href,Bl=""+new URL("battle-icon-Dc8Kk6u8.png",import.meta.url).href,Wl=""+new URL("battle-icon-BK07GLRa.png",import.meta.url).href,Gl=""+new URL("battle-icon-DOsTSbk7.png",import.meta.url).href,Hl=""+new URL("battle-icon-C6xcC1dj.png",import.meta.url).href,Vl=""+new URL("battle-icon-D17BSvSO.png",import.meta.url).href,Yl=""+new URL("battle-icon-CT4KyZ6T.png",import.meta.url).href,Kl=""+new URL("battle-icon-D1d6yU50.png",import.meta.url).href,zl="embermew",Jl="Embermew",Ql="fire",Xl="beast",Zl={range:2,canSwim:!1,canClimb:!1,canFly:!1,canWalk:!0},ec={maxLevel:30,experienceCurve:2,statGrowth:{health:5,attack:3,defense:2},allocationPoints:3,learnableAttacks:[{attackId:"fireball",requiredLevel:1},{attackId:"inner-fire",requiredLevel:3}]},tc={unitType:zl,name:Jl,affinity:Ql,family:Xl,movement:Zl,levelingConfig:ec},nc="trainer",sc="Character",ac="water",ic="dragon",rc={range:1,canSwim:!1,canClimb:!1,canFly:!1,canWalk:!0},oc={maxLevel:30,experienceCurve:2,statGrowth:{health:10,attack:0,defense:3},allocationPoints:3,learnableAttacks:[]},lc={unitType:nc,name:sc,affinity:ac,family:ic,movement:rc,levelingConfig:oc},cc="mireglow-guardian",dc="Mireglow Guardian",uc="water",mc="beast",hc={range:2,canSwim:!0,canClimb:!1,canFly:!1,canWalk:!0},fc={maxLevel:30,experienceCurve:2,statGrowth:{health:4,attack:1,defense:4},allocationPoints:3,learnableAttacks:[{attackId:"tongue-lash",requiredLevel:3},{attackId:"mire-splash",requiredLevel:6},{attackId:"leap-crush",requiredLevel:9},{attackId:"toxic-croak",requiredLevel:12}]},pc={unitType:cc,name:dc,affinity:uc,family:mc,movement:hc,levelingConfig:fc},gc="mossfeather",yc="Mossfeather",bc="air",xc="bird",vc={range:2,canSwim:!1,canClimb:!1,canFly:!0,canWalk:!0},wc={maxLevel:10,experienceCurve:2,statGrowth:{health:3,attack:3,defense:3},allocationPoints:3,learnableAttacks:[{attackId:"peck",requiredLevel:1}]},kc={unitType:gc,name:yc,affinity:bc,family:xc,movement:vc,levelingConfig:wc},jc="mycelin",Nc="Mycelin",$c="earth",_c="plant",Ic={range:0,canSwim:!1,canClimb:!1,canFly:!1,canWalk:!0},Tc={maxLevel:10,experienceCurve:2,statGrowth:{health:5,attack:2,defense:2},allocationPoints:3,learnableAttacks:[{attackId:"spore-bomb",requiredLevel:1}]},Cc={unitType:jc,name:Nc,affinity:$c,family:_c,movement:Ic,levelingConfig:Tc},Ec="ripplemask",Sc="Ripplemask",Ac="water",Lc="beast",Uc={range:2,canSwim:!1,canClimb:!1,canFly:!1,canWalk:!0},qc={maxLevel:30,experienceCurve:2,statGrowth:{health:10,attack:3,defense:2},allocationPoints:3,learnableAttacks:[{attackId:"water-swipe",requiredLevel:1},{attackId:"lily-pad-bounce",requiredLevel:4},{attackId:"ripple-wave",requiredLevel:7},{attackId:"water-bomb",requiredLevel:10},{attackId:"stealth-dive",requiredLevel:13}]},Pc={unitType:Ec,name:Sc,affinity:Ac,family:Lc,movement:Uc,levelingConfig:qc},Mc="shadow-of-the-forest",Oc="Shadow of the Forest",Rc="night",Fc="bird",Dc={range:2,canSwim:!1,canClimb:!1,canFly:!1,canWalk:!0},Bc={maxLevel:20,experienceCurve:2,statGrowth:{health:3,attack:3,defense:4},allocationPoints:3,learnableAttacks:[{attackId:"slash",requiredLevel:1},{attackId:"moonbeam",requiredLevel:1}]},Wc={unitType:Mc,name:Oc,affinity:Rc,family:Fc,movement:Dc,levelingConfig:Bc},Gc="stone-monkey",Hc="Stone Monkey",Vc="earth",Yc="beast",Kc={range:2,canSwim:!1,canClimb:!1,canFly:!1,canWalk:!0},zc={maxLevel:30,experienceCurve:2,statGrowth:{health:3,attack:3,defense:3},allocationPoints:3,learnableAttacks:[{attackId:"scratch",requiredLevel:1},{attackId:"screech",requiredLevel:1},{attackId:"multi-strike",requiredLevel:6}]},Jc={unitType:Gc,name:Hc,affinity:Vc,family:Yc,movement:Kc,levelingConfig:zc},Qc="suntusk",Xc="Suntusk",Zc="earth",ed="beast",td={range:2,canSwim:!1,canClimb:!1,canFly:!1,canWalk:!0},nd={maxLevel:30,experienceCurve:2,statGrowth:{health:3,attack:4,defense:4},allocationPoints:3,learnableAttacks:[{attackId:"headbutt",requiredLevel:1}]},sd={unitType:Qc,name:Xc,affinity:Zc,family:ed,movement:td,levelingConfig:nd},ad="syltharion-the-verdant-warden",id="Syltharion, the Verdant Warden",rd="night",od="beast",ld={range:2,canSwim:!1,canClimb:!1,canFly:!1,canWalk:!0},cd={maxLevel:30,experienceCurve:2,statGrowth:{health:10,attack:3,defense:2},allocationPoints:3,learnableAttacks:[{attackId:"thorn-barrage",requiredLevel:5},{attackId:"warden-embrace",requiredLevel:10},{attackId:"verdant-storm",requiredLevel:15},{attackId:"forest-awakening",requiredLevel:25},{attackId:"armor-shatter",requiredLevel:1},{attackId:"assassinate",requiredLevel:1},{attackId:"barrier",requiredLevel:1},{attackId:"blink",requiredLevel:1},{attackId:"entangle",requiredLevel:1},{attackId:"fire-breath",requiredLevel:1},{attackId:"life-drain",requiredLevel:1},{attackId:"lightning-strike",requiredLevel:1},{attackId:"lullaby",requiredLevel:1},{attackId:"mirror-aura",requiredLevel:1},{attackId:"razor-claws",requiredLevel:1},{attackId:"stone-wall",requiredLevel:1},{attackId:"wind-rush",requiredLevel:1}]},dd={unitType:ad,name:id,affinity:rd,family:od,movement:ld,levelingConfig:cd},ud="umbralis",md="Umbralis",hd="night",fd="bird",pd={range:3,canSwim:!1,canClimb:!1,canFly:!0,canWalk:!0},gd={maxLevel:10,experienceCurve:2,statGrowth:{health:3,attack:5,defense:2},allocationPoints:3,learnableAttacks:[{attackId:"peck",requiredLevel:1}]},yd={unitType:ud,name:md,affinity:hd,family:fd,movement:pd,levelingConfig:gd},bd="verdant-fangfin",xd="Verdant Fangfin",vd="water",wd="fish",kd={range:2,canSwim:!0,canClimb:!1,canFly:!1,canWalk:!1},jd={maxLevel:30,experienceCurve:2,statGrowth:{health:10,attack:3,defense:2},allocationPoints:3,learnableAttacks:[{attackId:"fang-strike",requiredLevel:1},{attackId:"aqua-jet",requiredLevel:4},{attackId:"tail-slap",requiredLevel:7},{attackId:"fin-slash",requiredLevel:10},{attackId:"bubble-burst",requiredLevel:13},{attackId:"whirlpool",requiredLevel:16}]},Nd={unitType:bd,name:xd,affinity:vd,family:wd,movement:kd,levelingConfig:jd},$d="whisperhart",_d="Whisperhart",Id="earth",Td="beast",Cd={range:2,canSwim:!1,canClimb:!1,canFly:!1,canWalk:!0},Ed={maxLevel:30,experienceCurve:2,statGrowth:{health:3,attack:3,defense:3},allocationPoints:3,learnableAttacks:[{attackId:"kick",requiredLevel:1}]},Sd={unitType:$d,name:_d,affinity:Id,family:Td,movement:Cd,levelingConfig:Ed};var V=(e=>(e.FIRE="fire",e.WATER="water",e.EARTH="earth",e.AIR="air",e.LIGHTNING="lightning",e.NIGHT="night",e))(V||{}),Qe=(e=>(e.BEAST="beast",e.DRAGON="dragon",e.FISH="fish",e.BIRD="bird",e.PLANT="plant",e))(Qe||{}),k=(e=>(e.APPLY_MODIFIER="apply_modifier",e.HEAL="heal",e.PUSH="push",e.POISON="poison",e.STUN="stun",e.SLEEP="sleep",e.BURN="burn",e.BLEED="bleed",e.SHIELD="shield",e.REFLECT="reflect",e.TELEPORT="teleport",e.ROOT="root",e.HASTE="haste",e.DRAIN="drain",e.CREATE_TERRAIN="create_terrain",e.CRITICAL_STRIKE="critical_strike",e.ARMOR_PIERCE="armor_pierce",e.CURE_POISON="cure_poison",e))(k||{}),U=(e=>(e.ATTACK_MULTIPLIER="attack_multiplier",e.DEFENSE_MULTIPLIER="defense_multiplier",e.POISON="poison",e.STUN="stun",e.SLEEP="sleep",e.BURN="burn",e.BLEED="bleed",e.SHIELD="shield",e.REFLECT="reflect",e.ROOT="root",e.HASTE="haste",e.DRAIN="drain",e))(U||{});const An=e=>Object.entries(e),Ad=e=>Object.keys(e),Ld=e=>{switch(e.toLowerCase()){case"fire":return V.FIRE;case"water":return V.WATER;case"earth":return V.EARTH;case"air":return V.AIR;case"lightning":return V.LIGHTNING;case"night":return V.NIGHT;default:throw new Error(`Invalid affinity: ${e}`)}},Ud=e=>{switch(e.toLowerCase()){case"beast":return Qe.BEAST;case"dragon":return Qe.DRAGON;case"fish":return Qe.FISH;case"bird":return Qe.BIRD;case"plant":return Qe.PLANT;default:throw new Error(`Invalid family: ${e}`)}},qd=e=>{if(typeof e!="object"||e===null)throw new Error("Movement is not an object");if(!("range"in e))throw new Error("Movement is missing range");return{range:e.range,canSwim:"canSwim"in e&&!!e.canSwim,canClimb:"canClimb"in e&&!!e.canClimb,canFly:"canFly"in e&&!!e.canFly,canWalk:"canWalk"in e&&!!e.canWalk}},Pd=e=>{if(typeof e!="object"||e===null)throw new Error("Leveling config is not an object");return e},Md=e=>{const t=new URL(Object.assign({"../assets/units/embermew/bestiary.png":hl,"../assets/units/mireglow-guardian/bestiary.png":fl,"../assets/units/mossfeather/bestiary.png":pl,"../assets/units/mycelin/bestiary.png":gl,"../assets/units/ripplemask/bestiary.png":yl,"../assets/units/shadow-of-the-forest/bestiary.png":bl,"../assets/units/stone-monkey/bestiary.png":xl,"../assets/units/suntusk/bestiary.png":vl,"../assets/units/syltharion-the-verdant-warden/bestiary.png":wl,"../assets/units/umbralis/bestiary.png":kl,"../assets/units/verdant-fangfin/bestiary.png":jl,"../assets/units/whisperhart/bestiary.png":Nl})[`../assets/units/${e.unitType}/bestiary.png`],import.meta.url).href,n=new URL(Object.assign({"../assets/units/embermew/headshot.png":$l,"../assets/units/mireglow-guardian/headshot.png":_l,"../assets/units/mossfeather/headshot.png":Il,"../assets/units/mycelin/headshot.png":Tl,"../assets/units/ripplemask/headshot.png":Cl,"../assets/units/shadow-of-the-forest/headshot.png":El,"../assets/units/stone-monkey/headshot.png":Sl,"../assets/units/suntusk/headshot.png":Al,"../assets/units/syltharion-the-verdant-warden/headshot.png":Ll,"../assets/units/umbralis/headshot.png":Ul,"../assets/units/verdant-fangfin/headshot.png":ql,"../assets/units/whisperhart/headshot.png":Pl})[`../assets/units/${e.unitType}/headshot.png`],import.meta.url).href,s=new URL(Object.assign({"../assets/units/embermew/battle-icon.png":Ml,"../assets/units/mireglow-guardian/battle-icon.png":Ol,"../assets/units/mossfeather/battle-icon.png":Rl,"../assets/units/mycelin/battle-icon.png":Fl,"../assets/units/ripplemask/battle-icon.png":Dl,"../assets/units/shadow-of-the-forest/battle-icon.png":Bl,"../assets/units/stone-monkey/battle-icon.png":Wl,"../assets/units/suntusk/battle-icon.png":Gl,"../assets/units/syltharion-the-verdant-warden/battle-icon.png":Hl,"../assets/units/umbralis/battle-icon.png":Vl,"../assets/units/verdant-fangfin/battle-icon.png":Yl,"../assets/units/whisperhart/battle-icon.png":Kl})[`../assets/units/${e.unitType}/battle-icon.png`],import.meta.url).href;return{unitType:e.unitType,name:e.name,affinity:Ld(e.affinity),family:Ud(e.family),levelingConfig:Pd(e.levelingConfig),movement:qd(e.movement),bestiaryImage:t,headshotImage:n,battleIconImage:s}},Ln={};let Un=!1;const qn=()=>{Object.entries(Object.assign({"./unitConfigs/embermew.json":tc,"./unitConfigs/general.json":lc,"./unitConfigs/mireglow-guardian.json":pc,"./unitConfigs/mossfeather.json":kc,"./unitConfigs/mycelin.json":Cc,"./unitConfigs/ripplemask.json":Pc,"./unitConfigs/shadow-of-the-forest.json":Wc,"./unitConfigs/stone-monkey.json":Jc,"./unitConfigs/suntusk.json":sd,"./unitConfigs/syltharion-the-verdant-warden.json":dd,"./unitConfigs/umbralis.json":yd,"./unitConfigs/verdant-fangfin.json":Nd,"./unitConfigs/whisperhart.json":Sd})).forEach(([t,n])=>{try{const s=n,i=Xo(s);if(!i.isValid){console.log("config",s),console.error(`Unit config ${t} failed schema validation:`,i.errors);return}if(!s.unitType){console.warn(`Unit config ${t} is missing unitType field, skipping`);return}Ln[s.unitType]=Md(s)}catch(s){console.error(`Failed to process unit config from ${t}:`,s)}}),Un=!0},H=e=>{Un||qn();const t=Ln[e];if(!t)throw new Error(`Unit type not found: ${e}`);return t},Od=(e,t)=>{const n=H(e);return n.levelingConfig?n.levelingConfig.learnableAttacks.filter(s=>s.requiredLevel<=t).map(s=>s.attackId):[]},Rd=()=>(Un||qn(),Ad(Ln));window.hydrateUnitConfigs=qn;const Gt=(e,t)=>t*100*(e*(e-1))/4,sn=e=>{const t=H(e.unitType).levelingConfig,n=e.experience,s=Gt(e.level,t.experienceCurve),i=Gt(e.level+1,t.experienceCurve);return{experience:n-s,experienceToNextLevel:i-s}},Fd=(e,t)=>{const n=e.experience+t,s=[],i=H(e.unitType).levelingConfig;let r=e.level;for(;n>=Gt(r+1,i.experienceCurve);){const o=r+1,l=Od(e.unitType,o).filter(c=>!e.attacks.includes(c));s.push({unitId:e.id,playerId:e.playerId,newLevel:o,availablePoints:i.allocationPoints,statAllocation:i.statGrowth,availableAttacks:l}),r++}return s},Dd="old-man-forest",Bd="Old Man of the Forest",Wd="improved",Gd=["I'll get you!","You're dead!","I'll destroy you!","The forest will consume you!","You dare challenge me?","My roots run deep!","Nature will have its revenge!"],Hd=[{itemId:"potion",quantity:2},{itemId:"antidote",quantity:1}],Vd={id:Dd,name:Bd,aiStrategy:Wd,battleQuotes:Gd,backpack:Hd},Yd="player",Kd="Player",zd="none",Jd=[],Qd=[],Xd={id:Yd,name:Kd,aiStrategy:zd,battleQuotes:Jd,backpack:Qd},Bs={};let Ws=!1;const Zd=e=>{const t=`/src/assets/trainers/${e.id}/headshot.png`,n=`/src/assets/trainers/${e.id}/battle-icon.png`;return{id:e.id,name:e.name,aiStrategy:e.aiStrategy,battleQuotes:e.battleQuotes,headshotImage:t,battleIconImage:n,backpack:e.backpack||[]}},Gs=()=>{Object.entries(Object.assign({"./trainerConfigs/old-man-forest.json":Vd,"./trainerConfigs/player.json":Xd})).forEach(([t,n])=>{try{const s=t.replace("./trainerConfigs/","").replace(".json",""),i=n,r=Qo(i);if(!r.isValid){console.error(`Trainer config ${s} failed schema validation:`,r.errors);return}if(!i.id){console.warn(`Trainer config ${s} is missing id field, skipping`);return}Bs[i.id]=Zd(i)}catch(s){console.error(`Failed to process trainer config from ${t}:`,s)}}),Ws=!0},He=e=>{Ws||Gs();const t=Bs[e];if(!t)throw new Error(`Trainer not found: ${e}`);return t};window.hydrateTrainerConfigs=Gs;const eu=(e,t)=>e.levelingConfig.statGrowth.health*t,tu=(e,t)=>e.levelingConfig.statGrowth.attack*t,nu=(e,t)=>e.levelingConfig.statGrowth.defense*t,su=(e,t)=>e.levelingConfig.learnableAttacks.filter(s=>s.requiredLevel<=t).map(s=>s.attackId),au=(e,t)=>{const n=e.levelingConfig;return Gt(t,n.experienceCurve)},Hs=(e,t,n,s,i)=>{const r=i?He(i):null,o=r?r.backpack:void 0;return{id:`unit-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,unitType:e.unitType,name:s||r?.name||e.name,playerId:t,level:n,maxHealth:eu(e,n),attack:tu(e,n),defense:nu(e,n),experience:au(e,n),attacks:su(e,n),availablePoints:0,trainerId:i,backpack:o}},Nn=(e,t,n,s,i)=>{const r=Hs(e,t,n,s,i);return{...r,health:r.maxHealth,hasMoved:!1,hasAttacked:!1,modifiers:[],backpack:r.backpack||void 0}},ps=()=>({units:[],squads:[],selectedSquadId:"all"}),iu=(e,t,n,s,i)=>{const r=Hs(H(t),1,n,s,i);return{...e,units:[...e.units,r]}},ru=(e,t)=>{const n=e.units.filter(i=>i.id!==t),s=e.squads.map(i=>({...i,unitIds:i.unitIds.filter(r=>r!==t)}));return{...e,units:n,squads:s}},ou=(e,t)=>{const n={id:`squad-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:t,unitIds:[]};return{...e,squads:[...e.squads,n]}},lu=(e,t)=>{const n=e.squads.filter(s=>s.id!==t);return{...e,squads:n}},cu=(e,t,n)=>{const s=e.units.find(r=>r.id===t);if(!s)throw new Error(`Unit with id ${t} not found`);if(s.unitType==="trainer")throw new Error("Trainer units cannot be added to squads");const i=e.squads.map(r=>r.id===n?{...r,unitIds:[...r.unitIds,t]}:r);return{...e,squads:i}},du=(e,t,n)=>{const s=e.squads.map(i=>i.id===n?{...i,unitIds:i.unitIds.filter(r=>r!==t)}:i);return{...e,squads:s}},uu=(e,t,n)=>{const s=e.squads.map(i=>i.id===t?{...i,name:n}:i);return{...e,squads:s}},mu=(e,t)=>({...e,selectedSquadId:t}),hu=4,gs={armies:{1:ps(),2:ps()},levelUpUnits:[]},fu=Kt({name:"army",initialState:gs,reducers:{reset:()=>gs,addUnitToArmy:(e,t)=>{const{playerId:n,unitType:s,level:i,customName:r,trainerId:o}=t.payload;e.armies[n]=iu(e.armies[n],s,i,r,o)},addCapturedUnitToArmy:(e,t)=>{const{playerId:n,unit:s}=t.payload;e.armies[n].units.push({...s,playerId:n})},removeUnitFromArmy:(e,t)=>{const{playerId:n,unitId:s}=t.payload;e.armies[n]=ru(e.armies[n],s)},addExperienceToUnit:(e,t)=>{const{playerId:n,unitId:s,experience:i}=t.payload,r=e.armies[n].units.find(l=>l.id===s);if(!r)throw new Error(`Unit not found: ${s}`);const o=Fd(r,i);r.experience+=i,e.levelUpUnits.push(...o)},applyLevelUp:(e,t)=>{const{playerId:n,unitId:s,newLevel:i,availablePoints:r,statAllocation:o}=t.payload,l=e.armies[n].units.find(c=>c.id===s);if(!l)throw new Error(`Unit not found: ${s}`);l.level=i,l.availablePoints=l.availablePoints+r,l.maxHealth=l.maxHealth+o.health,l.attack=l.attack+o.attack,l.defense=l.defense+o.defense,e.levelUpUnits=e.levelUpUnits.filter(c=>!(c.unitId===s&&c.newLevel===i))},learnAttack:(e,t)=>{const{playerId:n,unitId:s,attackId:i}=t.payload,r=e.armies[n].units.find(o=>o.id===s);if(!r)throw new Error(`Unit not found: ${s}`);if(r.attacks.length>=hu)throw new Error(`Unit ${s} has no available attack slots`);if(r.attacks.includes(i))throw new Error(`Unit ${s} already knows attack ${i}`);r.attacks.push(i)},forgetAttack:(e,t)=>{const{playerId:n,unitId:s,attackId:i}=t.payload,r=e.armies[n].units.find(l=>l.id===s);if(!r)throw new Error(`Unit not found: ${s}`);const o=r.attacks.indexOf(i);if(o===-1)throw new Error(`Unit ${s} does not know attack ${i}`);r.attacks.splice(o,1)},createSquad:(e,t)=>{const{playerId:n,name:s}=t.payload;e.armies[n]=ou(e.armies[n],s)},deleteSquad:(e,t)=>{const{playerId:n,squadId:s}=t.payload;e.armies[n]=lu(e.armies[n],s)},addUnitToSquad:(e,t)=>{const{playerId:n,unitId:s,squadId:i}=t.payload;e.armies[n]=cu(e.armies[n],s,i)},removeUnitFromSquad:(e,t)=>{const{playerId:n,unitId:s,squadId:i}=t.payload;e.armies[n]=du(e.armies[n],s,i)},renameSquad:(e,t)=>{const{playerId:n,squadId:s,newName:i}=t.payload;e.armies[n]=uu(e.armies[n],s,i)},selectSquad:(e,t)=>{const{playerId:n,squadId:s}=t.payload;e.armies[n]=mu(e.armies[n],s)}}}),{actions:ne,reducer:pu}=fu,gu={id:"setPlayerName",execute:(e,t)=>{const n=t.player_name;return J.setPlayerName(n)}},yu={id:"addPlayerTrainer",execute:(e,t)=>{const n=t.player_name;return ne.addUnitToArmy({playerId:1,unitType:"trainer",level:1,customName:n,trainerId:"player"})}},bu={id:"addStoneMonkey",execute:(e,t)=>{const n=t.stone_monkey_name;return ne.addUnitToArmy({playerId:1,unitType:"stone-monkey",level:5,customName:n})}},xu=Object.freeze(Object.defineProperty({__proto__:null,addPlayerTrainer:yu,addStoneMonkey:bu,setPlayerName:gu},Symbol.toStringTag,{value:"Module"})),vu={id:"hasWonBattle",evaluate:e=>e.game.battleHistory.some(t=>t.outcome===Be.WON)},wu={id:"hasLostBattle",evaluate:e=>e.game.battleHistory.some(t=>t.outcome===Be.LOST)},ku={id:"hasNotBattled",evaluate:e=>e.game.battleHistory.length===0},ju=e=>({id:`battleCount >= ${e}`,evaluate:t=>t.game.battleHistory.length>=e}),Nu=ju(1),$u=e=>({id:`wonBattles >= ${e}`,evaluate:t=>t.game.battleHistory.filter(n=>n.outcome===Be.WON).length>=e}),_u=$u(1),Iu=e=>({id:`capturedUnits >= ${e}`,evaluate:t=>t.game.battleHistory.reduce((n,s)=>n+s.unitsCaptured,0)>=e}),Tu=Iu(1),Cu=e=>({id:`killedUnits >= ${e}`,evaluate:t=>t.game.battleHistory.reduce((n,s)=>n+s.unitsKilled,0)>=e}),Eu=Cu(1),Su=Object.freeze(Object.defineProperty({__proto__:null,hasBattled:Nu,hasCapturedAUnit:Tu,hasKilledAUnit:Eu,hasLostBattle:wu,hasNotBattled:ku,hasWonABattles:_u,hasWonBattle:vu},Symbol.toStringTag,{value:"Module"})),Au=(e,t=1)=>({id:`hasItem_${e}_${t}`,evaluate:n=>{const s=n.game.playerBackpack.find(i=>i.itemId===e);return s?s.quantity>=t:!1}}),Lu=Au("potion",1),Uu={id:"hasAnyItems",evaluate:e=>e.game.playerBackpack.length>0},qu={id:"hasEmptyBackpack",evaluate:e=>e.game.playerBackpack.length===0},Pu=Object.freeze(Object.defineProperty({__proto__:null,hasAnyItems:Uu,hasEmptyBackpack:qu,hasPotion:Lu},Symbol.toStringTag,{value:"Module"})),Mu=e=>({id:`isInTown_${e}`,evaluate:t=>t.overworld.playerLocationId===e}),Ou=Mu(nn),Vs=e=>({id:`hasVisited_${e}`,evaluate:t=>t.game.visitedLocations[e]}),Ru=Vs(nn),Fu=Vs(En),Ys=e=>({id:`hasNotVisited_${e}`,evaluate:t=>!t.game.visitedLocations[e]}),Du=Ys(En),Bu=Ys(Ds),Wu=e=>({id:`hasSeenTrainer_${e}`,evaluate:t=>Object.values(t.game.seenTrainers).some(n=>n.includes(e))}),Gu=Wu("old-man-forest"),Hu=Object.freeze(Object.defineProperty({__proto__:null,hasNotVisitedField1:Du,hasNotVisitedForest1:Bu,hasSeenOldManOfTheForest:Gu,hasVisitedField1:Fu,hasVisitedTown:Ru,isInTown:Ou},Symbol.toStringTag,{value:"Module"})),Vu=e=>({id:`hasCompletedConversation_${e}`,evaluate:t=>t.game.completedConversations[e]}),Yu=Vu("welcome/wildlight-guide"),Ku=e=>({id:`hasNotCompletedConversation_${e}`,evaluate:t=>!t.game.completedConversations[e]}),zu=Ku("welcome/wildlight-guide"),Ju={id:"hasCompletedTutorial",evaluate:e=>e.game.hasStarted&&e.game.battleHistory.length>0},Qu={id:"isNewPlayer",evaluate:e=>e.game.battleHistory.length===0},Xu={id:"hasPlayerName",evaluate:e=>!!e.game.playerName},Zu=Object.freeze(Object.defineProperty({__proto__:null,hasCompletedTutorial:Ju,hasCompletedWelcomeDialog:Yu,hasNotCompletedWelcomeDialog:zu,hasPlayerName:Xu,isNewPlayer:Qu},Symbol.toStringTag,{value:"Module"})),em=e=>({id:`hasUnitInArmy_${e}`,evaluate:t=>t.army.armies[1].units.some(s=>s.unitType===e)}),tm=em("mossfeather"),nm=e=>({id:`hasNotUnitInArmy_${e}`,evaluate:t=>!t.army.armies[1].units.some(s=>s.unitType===e)}),sm=nm("mossfeather"),am=e=>({id:`hasSeenUnit_${e}`,evaluate:t=>Object.values(t.game.seenUnitTypes).some(n=>n.includes(e))}),im=am("mossfeather"),rm=Object.freeze(Object.defineProperty({__proto__:null,hasMossfeatherInArmy:tm,hasNotMossfeatherInArmy:sm,hasSeenMossfeather:im},Symbol.toStringTag,{value:"Module"})),om=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),Pn={},Ks={},zs={};let Nt=!1;const $t=()=>{const e=Object.assign({"./conversations/town/childhood-friend-1/conversation.yaml":Jt,"./conversations/town/childhood-friend-2/conversation.yaml":Qt,"./conversations/town/childhood-friend-3/conversation.yaml":Xt,"./conversations/town/village-elder-1/conversation.yaml":Zt,"./conversations/town/village-elder-2/conversation.yaml":en,"./conversations/welcome/wildlight-guide/conversation.yaml":tn}),t=Object.assign({"./conversations/shared/actions/addItem.ts":Wi,"./conversations/shared/actions/setFlag.ts":Vi,"./conversations/shared/actions/unlockLocation.ts":ml,"./conversations/welcome/wildlight-guide/actions.ts":xu}),n=Object.assign({"./conversations/shared/conditions/battleConditions.ts":Su,"./conversations/shared/conditions/inventoryConditions.ts":Pu,"./conversations/shared/conditions/locationConditions.ts":Hu,"./conversations/shared/conditions/progressConditions.ts":Zu,"./conversations/shared/conditions/wildlight.ts":rm,"./conversations/town/village-elder-1/conditions.ts":om});Object.entries(e).forEach(([s,i])=>{try{console.debug("processing conversation config",s);const r=i,o=tl(r);if(!o.isValid){console.error(`Conversation config ${s} failed schema validation:`,o.errors);return}const l=s.split("/");if(r.meta.conversation_id!==`${l[l.length-3]}/${l[l.length-2]}`){console.warn(`Conversation config ${s} has conversation_id ${r.meta.conversation_id}, skipping`);return}Pn[r.meta.conversation_id]=r}catch(r){console.error(`Failed to process conversation config from ${s}:`,r)}}),Object.entries(t).forEach(([s,i])=>{Object.entries(i).forEach(([r,o])=>{console.debug("processing action",s,o.id),Ks[o.id]=o})}),Object.entries(n).forEach(([s,i])=>{Object.entries(i).forEach(([r,o])=>{console.debug("processing condition",s,o.id),zs[o.id]=o})}),Nt=!0},xn=e=>{Nt||$t();const t=Pn[e];if(!t)throw new Error(`Conversation not found: ${e}`);return t},Js=()=>(Nt||$t(),Object.values(Pn)),lm=e=>{Nt||$t();const t=Ks[e];if(!t)throw new Error(`Action not found: ${e}`);return t},cm=e=>{Nt||$t();const t=zs[e];if(!t)throw new Error(`Condition not found: ${e}`);return t};window.hydrateConversationConfigs=$t;var yt={},Lt={},Ut={},ys;function dm(){if(ys)return Ut;ys=1,Ut.__esModule=!0,Ut.default=i;function e(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?e=function(l){return typeof l}:e=function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},e(r)}function t(){}var n={getItem:t,setItem:t,removeItem:t};function s(r){if((typeof self>"u"?"undefined":e(self))!=="object"||!(r in self))return!1;try{var o=self[r],l="redux-persist ".concat(r," test");o.setItem(l,"test"),o.getItem(l),o.removeItem(l)}catch{return!1}return!0}function i(r){var o="".concat(r,"Storage");return s(o)?self[o]:n}return Ut}var bs;function um(){if(bs)return Lt;bs=1,Lt.__esModule=!0,Lt.default=n;var e=t(dm());function t(s){return s&&s.__esModule?s:{default:s}}function n(s){var i=(0,e.default)(s);return{getItem:function(o){return new Promise(function(l,c){l(i.getItem(o))})},setItem:function(o,l){return new Promise(function(c,d){c(i.setItem(o,l))})},removeItem:function(o){return new Promise(function(l,c){l(i.removeItem(o))})}}}return Lt}var xs;function mm(){if(xs)return yt;xs=1,yt.__esModule=!0,yt.default=void 0;var e=t(um());function t(s){return s&&s.__esModule?s:{default:s}}var n=(0,e.default)("local");return yt.default=n,yt}var hm=mm();const fm=zt(hm),te=(e,t)=>(Math.abs(e.q-t.q)+Math.abs(e.q+e.r-t.q-t.r)+Math.abs(e.r-t.r))/2,an=e=>[{q:1,r:0},{q:1,r:-1},{q:0,r:-1},{q:-1,r:0},{q:-1,r:1},{q:0,r:1}].map(n=>({q:e.q+n.q,r:e.r+n.r})),Mn=(e,t)=>{const n=[];for(let s=-t;s<=t;s++){const i=Math.max(-t,-s-t),r=Math.min(t,-s+t);for(let o=i;o<=r;o++)n.push({q:e.q+s,r:e.r+o})}return n},Ie=(e,t)=>Math.abs(e.q)<=t&&Math.abs(e.r)<=t&&Math.abs(e.q+e.r)<=t,pm=(e,t)=>{const n=t.q-e.q,s=t.r-e.r,i=Math.sqrt(n*n+s*s);return i===0?{q:0,r:0}:{q:Math.round(n/i),r:Math.round(s/i)}};var oe=(e=>(e.GRASS="grass",e.WATER="water",e.MOUNTAIN="mountain",e.FOREST="forest",e))(oe||{}),be=(e=>(e.SELECTION="selection",e.UNIT_PLACEMENT="unit_placement",e))(be||{}),le=(e=>(e.TRAINER_DEFEATED="trainer_defeated",e.ALL_UNITS_DEFEATED="all_units_defeated",e.SURRENDER="surrender",e.DRAW="draw",e))(le||{}),I=(e=>(e.WAITING="waiting",e.MOVEMENT="movement",e.ATTACK="attack",e.CAPTURE="capture",e.ITEM="item",e.SUMMON="summon",e))(I||{}),xe=(e=>(e.TRAINER="trainer",e.UNITS="units",e))(xe||{});const Le=e=>e.health<=0,q=e=>e.unitType==="trainer"&&e.trainerId!==void 0,ye=e=>!e.hasMoved&&H(e.unitType).movement.range>0,de=e=>!e.hasAttacked&&(e.attacks.length>0||q(e)),gm=e=>({...e,hasMoved:!1,hasAttacked:!1}),ym=(e,t)=>e.map(n=>n.id===t.playerId?{...n,units:[...n.units,t.id]}:n),vs=(e,t)=>e.map(n=>({...n,units:n.units.filter(s=>s!==t)})),bm=(e,t)=>{const n=[];for(let s=0;s<e.count;s++){const i=xm(e.ratios),r=Nn(H(i),t,1);n.push(r)}return n},xm=e=>{const t=[];for(const[s,i]of An(e))if(i)for(let r=0;r<i;r++)t.push(s);if(t.length===0)throw new Error("No unit types specified");const n=Math.floor(Math.random()*t.length);return t[n]},ws=e=>{const t=e.find(n=>q(n));return t&&Le(t)?!0:e.every(n=>Le(n)||q(n))},vm=(e,t,n)=>{if(e)return{playerId:2,condition:le.SURRENDER};const s=t[0]?.units.map(l=>n[l]).filter(Boolean)||[],i=t[1]?.units.map(l=>n[l]).filter(Boolean)||[],r=ws(s),o=ws(i);if(r&&o)return{condition:le.DRAW};if(o){const l=i.find(d=>q(d));return{playerId:1,condition:l&&Le(l)?le.TRAINER_DEFEATED:le.ALL_UNITS_DEFEATED}}if(r){const l=s.find(d=>q(d));return{playerId:2,condition:l&&Le(l)?le.TRAINER_DEFEATED:le.ALL_UNITS_DEFEATED}}return null},Qs=(e,t)=>{const n=wm(e),s=km(e,n),i=jm(s,t);return{map:n,units:s,players:i}},wm=e=>{const t=e.radius,n=[];if("tiles"in e.terrain)return e.terrain.tiles.map((i,r)=>i.map((o,l)=>o?{position:{q:l-t,r:r-t},terrain:o,unitId:null}:null));const s=Im(e.terrain.ratios);for(let i=-t;i<=t;i++)for(let r=-t;r<=t;r++)if(Math.abs(r)<=t&&Math.abs(i)<=t&&Math.abs(r+i)<=t){const o=i+t,l=r+t;n[o]||(n[o]=[]);const c=Tm(s);n[o][l]={position:{q:r,r:i},terrain:c,unitId:null}}return n},ks=(e,t,n)=>{let s,i=0;const r=50;do{const o=Math.floor(Math.random()*(t-1))+1,l=Math.floor(Math.random()*(t*2+1))-t;Math.abs(o)<=t&&Math.abs(l)<=t&&Math.abs(o+l)<=t?s={q:o,r:l}:s={q:1,r:0},i++}while(i<r&&(!$e(s,e,n)||ot(e,s)));return i<r?s:{q:1,r:0}},km=(e,t)=>{const n={};if("tiles"in e.enemyUnits){const i=An(e.enemyUnits.tiles);for(const[r,o]of i)for(const l of o){const c=Nn(H(r),2,1);We(t,c,l),n[c.id]=c}}else if("squad"in e.enemyUnits){const i=e.enemyUnits.squad;for(const{unitType:r,level:o,position:l,name:c,trainerId:d}of i){const m=Nn(H(r),2,o,c,d);We(t,m,l||ks(t,e.radius,m)),n[m.id]=m}}else if("ratios"in e.enemyUnits){const i=bm(e.enemyUnits,2);i.forEach(r=>{n[r.id]=r}),i.forEach((r,o)=>{const l=ks(t,e.radius,r);We(t,r,l)})}else throw new Error("Invalid enemy units configuration");return n},jm=(e,t)=>t.map(s=>({...s,units:Object.values(e).filter(i=>i.playerId===s.id).map(i=>i.id)})),Xe=(e,t)=>{for(let n=0;n<e.length;n++)for(let s=0;s<e[n].length;s++){const i=e[n][s];i&&i.unitId===t&&(i.unitId=null)}},We=(e,t,n)=>{const s=Rn(e),i=n.r+s,r=n.q+s;e[i]&&e[i][r]&&($e(n,e,t)?e[i][r].unitId=t.id:console.warn("Cannot place unit on non-walkable tile"))},On=(e,t)=>{const n=Rn(t),s=e.r+n,i=e.q+n;return t[s][i]||null},Nm=(e,t,n)=>{const s=On(e,t);return s&&s.unitId?n[s.unitId]:null},$e=(e,t,n)=>{const s=On(e,t);if(!s)return!1;const i=H(n.unitType);switch(s.terrain){case oe.WATER:return i.movement.canSwim||i.movement.canFly;case oe.MOUNTAIN:return i.movement.canClimb||i.movement.canFly;case oe.GRASS:case oe.FOREST:return i.movement.canWalk;default:{const r=s.terrain;throw new Error(`Unknown terrain type: ${r}`)}}},F=(e,t)=>{for(let n=0;n<e.length;n++)for(let s=0;s<e[n].length;s++){const i=e[n][s];if(i&&i.unitId===t)return i.position}return null},$m=(e,t)=>{const n=[];for(let s=0;s<e.length;s++)for(let i=0;i<e[s].length;i++){const r=e[s][i];r&&r.unitId&&t(r.unitId)&&n.push(r.position)}return n},_m=(e,t,n)=>{const s=$m(e,i=>t[i]&&t[i].playerId===n&&t[i].unitType==="trainer");return s.length>0?s[0]:null},ot=(e,t)=>{const n=Rn(e),s=e[t.r+n]?.[t.q+n]?.unitId;return s||null},Xs=(e,t)=>{const n=[];return t.forEach(s=>{const i=ot(e,s);i&&n.push(i)}),n},Rn=e=>Math.floor((e.length-1)/2),Im=e=>{const t=[];for(const[n,s]of An(e))for(let i=0;i<s;i++)t.push(n);return t},Tm=e=>{const t=Math.floor(Math.random()*e.length);return e[t]},Cm=(e,t)=>{const n={id:`effect-${t.modifierType}-${Date.now()}`,type:t.modifierType,value:t.value,duration:t.duration};return{...e,modifiers:[...e.modifiers,n]}},Em=(e,t)=>{const n=t.value>1?t.value:e.maxHealth*t.value;return{...e,health:Math.min(e.maxHealth,e.health+n)}},Sm=(e,t)=>{const n={id:`poison-${Date.now()}`,type:U.POISON,duration:t.duration};return{...e,modifiers:[...e.modifiers,n]}},Am=(e,t)=>{const n={id:`stun-${Date.now()}`,type:U.STUN,duration:t.duration};return{...e,modifiers:[...e.modifiers,n]}},Lm=e=>e.modifiers.find(n=>n.type===U.POISON)?Math.floor(e.maxHealth/8):0,Um=(e,t)=>{const n=e.modifiers.filter(s=>s.type!==U.POISON);return{...e,modifiers:n}},qm=(e,t)=>{const n={id:`sleep-${Date.now()}`,type:U.SLEEP,duration:t.duration};return{...e,modifiers:[...e.modifiers,n]}},Pm=(e,t)=>{const n={id:`burn-${Date.now()}`,type:U.BURN,damage:t.damage,duration:t.duration};return{...e,modifiers:[...e.modifiers,n]}},Mm=e=>e.modifiers.filter(n=>n.type===U.BURN).reduce((n,s)=>s.type===U.BURN&&"damage"in s?n+s.damage:n,0),Om=(e,t)=>{const n={id:`bleed-${Date.now()}`,type:U.BLEED,damage:t.damage,duration:t.duration};return{...e,modifiers:[...e.modifiers,n]}},Rm=e=>e.modifiers.filter(n=>n.type===U.BLEED).reduce((n,s)=>s.type===U.BLEED&&"damage"in s?n+s.damage:n,0),Fm=(e,t)=>{const n={id:`shield-${Date.now()}`,type:U.SHIELD,amount:t.amount,duration:t.duration};return{...e,modifiers:[...e.modifiers,n]}},Dm=(e,t)=>{const n={id:`reflect-${Date.now()}`,type:U.REFLECT,percentage:t.percentage,duration:t.duration};return{...e,modifiers:[...e.modifiers,n]}},Bm=(e,t,n)=>{const s=Math.floor(e.length/2);return Ie(n.position,s)?$e(n.position,e,t)?ot(e,n.position)?(console.warn("Teleport target position is occupied"),e):(Xe(e,t.id),We(e,t,n.position),e):(console.warn("Teleport target position is not walkable"),e):(console.warn("Teleport target position is outside map boundaries"),e)},Wm=(e,t)=>{const n={id:`root-${Date.now()}`,type:U.ROOT,duration:t.duration};return{...e,modifiers:[...e.modifiers,n]}},Gm=(e,t)=>{const n={id:`haste-${Date.now()}`,type:U.HASTE,bonusRange:t.bonusRange,duration:t.duration};return{...e,modifiers:[...e.modifiers,n]}},Hm=(e,t)=>{const n={id:`drain-${Date.now()}`,type:U.DRAIN,amount:t.amount,duration:t.duration};return{...e,modifiers:[...e.modifiers,n]}},Vm=(e,t,n,s)=>{const i=F(e,t.id),r=F(e,n.id);if(!i||!r)throw new Error("Unit not found on map");const o=pm(r,i),l={q:i.q+o.q*s.distance,r:i.r+o.r*s.distance},c=Math.floor(e.length/2);return Ie(l,c)?$e(l,e,t)?ot(e,l)?(console.warn("Push would move unit to occupied tile"),e):(Xe(e,t.id),We(e,t,l),e):(console.warn("Push would move unit to non-walkable terrain"),e):(console.warn("Push would move unit outside map boundaries"),e)},Ym=e=>{const t=e.modifiers.map(n=>n.duration===null?n:n.duration<=1?null:{...n,duration:n.duration-1}).filter(n=>n!==null);return{...e,modifiers:t}},js={players:[{id:1,name:"Player 1",units:[],isActive:!0},{id:2,name:"Player 2",units:[],isActive:!1}],map:[],units:{},currentPlayerId:1,selectedUnit:null,selectionMode:I.MOVEMENT,gamePhase:be.UNIT_PLACEMENT,placementMode:xe.TRAINER,turnNumber:1,radius:3,selectedAttack:null,selectedItem:null,selectedSummonUnit:null,aiPlayers:[{playerId:1,strategy:"Improved Strategic",isEnabled:!1},{playerId:2,strategy:"Improved Strategic",isEnabled:!1}],surrendered:!1,winner:null,kills:[],captures:[],experienceGains:[],chatMessages:[]},Km=Kt({name:"battle",initialState:js,reducers:{reset:()=>js,startBattle:(e,t)=>{const{map:n,units:s,players:i,radius:r}=t.payload;e.gamePhase=be.UNIT_PLACEMENT,e.turnNumber=1,e.currentPlayerId=1,e.map=n,e.selectionMode=I.MOVEMENT,e.placementMode=xe.TRAINER,e.radius=r,e.selectedAttack=null,e.selectedItem=null,e.players=i,e.units=s,e.aiPlayers=e.aiPlayers.map(o=>({...o,isEnabled:o.playerId===2})),e.surrendered=!1,e.winner=null,e.kills=[],e.experienceGains=[],e.chatMessages=[],e.captures=[]},placeUnit:(e,t)=>{const{armyUnit:n,position:s}=t.payload,{map:i}=e,r={...n,health:n.maxHealth,hasMoved:!1,hasAttacked:!1,modifiers:[]};if(!$e(s,i,r)){console.warn("Cannot place unit on non-walkable tile");return}We(i,r,s);const o=ym(e.players,r),l={...e.units,[r.id]:r};e.map=i,e.players=o,e.units=l,e.selectionMode=I.MOVEMENT},removePlacedUnit:(e,t)=>{const n=t.payload,{map:s}=e;Xe(s,n);const i=vs(e.players,n),r={...e.units};delete r[n],e.map=s,e.players=i,e.units=r,e.selectedUnit=null,e.selectionMode=I.MOVEMENT,e.gamePhase=be.UNIT_PLACEMENT},finishUnitPlacement:e=>{const t=Object.values(e.units).filter(i=>i.playerId===e.currentPlayerId),n=t.some(i=>i.unitType==="trainer"),s=t.some(i=>i.unitType!=="trainer");if(!n)throw new Error("Cannot finish placement without a trainer");if(!s)throw new Error("Cannot finish placement without at least one other unit");e.currentPlayerId,e.gamePhase=be.SELECTION,e.selectedUnit=null,e.selectionMode=I.MOVEMENT,e.turnNumber=1,e.currentPlayerId=1},setPlacementMode:(e,t)=>{e.placementMode=t.payload},deselectUnit:e=>{e.selectionMode=I.WAITING,e.selectedUnit=null},startMovement:(e,t)=>{const n=e.units[t.payload.unitId];if(!ye(n)){console.warn("Unit cannot move");return}e.selectionMode=I.MOVEMENT,e.selectedUnit=t.payload.unitId},startAttacking:(e,t)=>{const n=e.units[t.payload.unitId];if(!de(n)){console.warn("Unit cannot attack");return}e.selectedUnit=n.id,e.selectionMode=I.ATTACK,e.selectedAttack=t.payload.attackId},finishAttacking:(e,t)=>{const n=e.units[t.payload.unitId];ye(n)?e.selectionMode=I.MOVEMENT:e.selectionMode=I.WAITING,e.selectedAttack=null,e.units={...e.units,[n.id]:{...n,hasAttacked:!0}}},startCapture:(e,t)=>{const n=e.units[t.payload.unitId];if(!q(n)){console.warn("Only trainers can capture units");return}e.selectedUnit=n.id,e.selectionMode=I.CAPTURE,e.selectedAttack=null},finishCapturing:(e,t)=>{const n=e.units[t.payload.trainerId];ye(n)?e.selectionMode=I.MOVEMENT:e.selectionMode=I.WAITING,e.units={...e.units,[n.id]:{...n,hasAttacked:!0}}},inspectUnit:(e,t)=>{const n=e.units[t.payload.unitId];e.selectionMode=I.WAITING,e.selectedUnit=n.id},moveUnit:(e,t)=>{const{unitId:n,newPosition:s}=t.payload,{map:i}=e,r=e.units[n];if(!$e(s,e.map,r)){console.warn("Cannot move unit to non-walkable tile");return}if(ot(e.map,s)){console.warn("Cannot move unit to occupied tile");return}if(!ye(r)){console.warn("Unit has already moved this turn");return}Xe(i,r.id),We(i,r,s);const l={...r,hasMoved:!0},c={...e.units,[l.id]:l};e.map=i,e.units=c;const d=l.attacks[0];l.hasAttacked||!d||q(l)?e.selectionMode=I.WAITING:(e.selectionMode=I.ATTACK,e.selectedAttack=d)},endActionCleanup:e=>{Object.values(e.units).filter(Le).forEach(n=>{Xe(e.map,n.id)}),e.captures.forEach(n=>{Xe(e.map,n),e.players=vs(e.players,n),delete e.units[n]})},endTurnInternal:(e,t)=>{const{newPlayerId:n,newTurnNumber:s}=t.payload,i=Object.values(e.units).filter(r=>r.playerId===n).map(Ym).map(gm).reduce((r,o)=>(r[o.id]=o,r),{...e.units});e.currentPlayerId=n,e.turnNumber=s,e.selectedUnit=null,e.selectionMode=I.WAITING,e.units=i},setAIPlayer:(e,t)=>{const{playerId:n,isEnabled:s,strategy:i}=t.payload,r=e.aiPlayers.find(o=>o.playerId===n);r&&(r.isEnabled=s,i&&(r.strategy=i))},setWinner:(e,t)=>{e.winner=t.payload},surrenderInternal:e=>{e.surrendered=!0},recordExperienceGain:(e,t)=>{e.experienceGains.push(t.payload)},applyDamage:(e,t)=>{const{targetId:n,damage:s,attackerId:i}=t.payload,r=e.units[n],o=i?e.units[i]:void 0,l={...r,health:Math.max(0,r.health-s)};e.units={...e.units,[l.id]:l},Le(l)&&o&&e.kills.push([o.id,l.id])},captureUnit:(e,t)=>{e.captures.push(t.payload.unitId)},applyEffect:(e,t)=>{const{targetId:n,attackerId:s,effect:i}=t.payload,r=e.units[n],o=e.units[s];switch(i.type){case k.APPLY_MODIFIER:{const l=Cm(r,i);e.units={...e.units,[n]:l};break}case k.HEAL:{const l=Em(r,i);e.units={...e.units,[n]:l};break}case k.PUSH:{const l=Vm(e.map,r,o,i);e.map=l;break}case k.POISON:{const l=Sm(r,i);e.units={...e.units,[r.id]:l};break}case k.STUN:{const l=Am(r,i);e.units={...e.units,[r.id]:l};break}case k.SLEEP:{const l=qm(r,i);e.units={...e.units,[r.id]:l};break}case k.BURN:{const l=Pm(r,i);e.units={...e.units,[r.id]:l};break}case k.BLEED:{const l=Om(r,i);e.units={...e.units,[r.id]:l};break}case k.SHIELD:{const l=Fm(r,i);e.units={...e.units,[r.id]:l};break}case k.REFLECT:{const l=Dm(r,i);e.units={...e.units,[r.id]:l};break}case k.TELEPORT:{const l=Bm(e.map,r,i);e.map=l;break}case k.ROOT:{const l=Wm(r,i);e.units={...e.units,[r.id]:l};break}case k.HASTE:{const l=Gm(r,i);e.units={...e.units,[r.id]:l};break}case k.DRAIN:{const l=Hm(r,i);e.units={...e.units,[r.id]:l};break}case k.CREATE_TERRAIN:{console.warn("Create terrain effect not yet implemented");break}case k.CRITICAL_STRIKE:{console.warn("Critical strike effect not yet implemented");break}case k.ARMOR_PIERCE:{console.warn("Armor pierce effect not yet implemented");break}case k.CURE_POISON:{const l=Um(r);e.units={...e.units,[r.id]:l};break}default:{const l=i;throw new Error(`Unknown effect type: ${l}`)}}},addChatMessage:(e,t)=>{const{sender:n,content:s}=t.payload,i={id:`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,sender:n,content:s,timestamp:Date.now()};e.chatMessages.push(i)},startUsingItem:(e,t)=>{const n=e.units[t.payload.unitId];if(!q(n)){console.warn("Only trainers can use items");return}e.selectedUnit=n.id,e.selectionMode=I.ITEM,e.selectedItem=t.payload.itemId,e.selectedAttack=null},finishUsingItem:(e,t)=>{const n=e.units[t.payload.unitId];ye(n)?e.selectionMode=I.MOVEMENT:e.selectionMode=I.WAITING,e.selectedItem=null,e.units={...e.units,[n.id]:{...n,hasAttacked:!0}}},startSummoning:(e,t)=>{const n=e.units[t.payload.unitId];if(!q(n)){console.warn("Only trainers can summon units");return}e.selectedUnit=n.id,e.selectionMode=I.SUMMON,e.selectedAttack=null,e.selectedItem=null},selectSummonUnit:(e,t)=>{e.selectedSummonUnit=t.payload.unitId},finishSummoning:(e,t)=>{const n=e.units[t.payload.trainerId];ye(n)?e.selectionMode=I.MOVEMENT:e.selectionMode=I.WAITING,e.selectedSummonUnit=null,e.units={...e.units,[n.id]:{...n,hasAttacked:!0}}}}}),{actions:L,reducer:zm}=Km,Jm=di({battle:zm,army:pu,overworld:ll,game:Fi}),Qm={key:"root",storage:fm},Xm=ui(),Zm=fi(Qm,Jm),kt=mi({reducer:Zm,middleware:e=>e({serializableCheck:{ignoredActions:["persist/PERSIST","persist/REHYDRATE","listenerMiddleware/add"]}}).prepend(Xm.middleware)}),eh=hi(kt),th=e=>{const t=Zs(e,U.ATTACK_MULTIPLIER);return Math.floor(e.attack*t)},nh=e=>{const t=Zs(e,U.DEFENSE_MULTIPLIER);return Math.floor(e.defense*t)},Zs=(e,t)=>{const n=e.modifiers.filter(l=>l.type===t);if(n.length===0)return 1;let s=0,i=0;n.forEach(l=>{l.value>0?s+=l.value:l.value<0&&(i+=Math.abs(l.value))});const r=1+s,o=Math.pow(.5,i);if(s>0&&i>0){const l=s-i;return l>0?1+l:l<0?Math.pow(.5,Math.abs(l)):1}return s>0?r:o},sh=([e,t])=>{let n=0;for(let s=0;s<e;s++)n+=Math.floor(Math.random()*t)+1;return n},ah=(e,t,n)=>{if(n.power[0]===0)return{damage:0,meta:{isCritical:!1,affinityMultiplier:1,damageType:"attack",attackId:n.id}};const s=1,i=s>1,r=H(e.unitType).affinity,o=H(t.unitType).affinity,l=ih(r,o),c=th(e),d=nh(t),m=c/d,u=sh(n.power);return{damage:Math.ceil(s*l*m*u/2),meta:{isCritical:i,affinityMultiplier:l,damageType:"attack",attackId:n.id}}},ih=(e,t)=>e===V.WATER&&t===V.FIRE||e===V.LIGHTNING&&t===V.WATER||e===V.EARTH&&t===V.LIGHTNING||e===V.FIRE&&t===V.EARTH?1.5:e===V.FIRE&&t===V.WATER||e===V.WATER&&t===V.LIGHTNING||e===V.LIGHTNING&&t===V.EARTH||e===V.EARTH&&t===V.FIRE?.75:(e===V.AIR||t===V.AIR||e===t,1),at=e=>{if(q(e))return 0;const t=H(e.unitType),n=e.maxHealth+e.attack+e.defense+t.movement.range*10,s=(t.movement.canSwim?10:0)+(t.movement.canClimb?10:0)+(t.movement.canFly?10:0),i=e.attacks.length*10,r=n+s+i;return Math.max(1,Math.round(r))},ea=e=>e.reduce((t,n)=>t+at(n),0),rh=(e,t,n,s)=>{let i=0,r=0;for(const o of t){const l=at(o),c=o.level/e.level,d=Math.ceil(l*c*2);i+=d,r++}if(s)for(const o of n){const l=at(o),c=o.level/e.level,d=Math.ceil(l*c);i+=d}return{unitId:e.id,experience:i,kills:r,survived:s}},oh=(e,t,n)=>e.units.map(s=>{const i=t[s],r=H(i.unitType).levelingConfig;if(r&&i.level===r.maxLevel)return null;const o=i.health>0,l=n.filter(([d,m])=>d===s).map(([d,m])=>t[m]),c=Object.values(t).filter(d=>d.playerId!==i.playerId);return rh(i,l,c,o)}).filter(Boolean),lh="aqua-jet",ch="Aqua Jet",dh="Shoots a high-pressure stream of water at a distant target",uh=["ranged",2,4],mh="3d3",hh={id:lh,name:ch,description:dh,pattern:uh,power:mh},fh="armor-shatter",ph="Armor Shatter",gh="A devastating blow that ignores most of the target's defense",yh=["direct"],bh="3d3",xh=[{type:"armor_pierce",percentage:75}],vh={id:fh,name:ph,description:gh,pattern:yh,power:bh,effects:xh},wh="assassinate",kh="Assassinate",jh="A precise strike that guarantees a critical hit",Nh=["direct"],$h="2d4",_h=[{type:"critical_strike",multiplier:2}],Ih={id:wh,name:kh,description:jh,pattern:Nh,power:$h,effects:_h},Th="barrier",Ch="Barrier",Eh="Creates a protective barrier that absorbs incoming damage",Sh=["self"],Ah="0d0",Lh=[{type:"shield",amount:15,duration:5}],Uh={id:Th,name:Ch,description:Eh,pattern:Sh,power:Ah,effects:Lh},qh="blink",Ph="Blink",Mh="Instantly teleports the caster to a nearby position",Oh=["self"],Rh="0d0",Fh=[{type:"teleport",position:{q:0,r:0}}],Dh={id:qh,name:Ph,description:Mh,pattern:Oh,power:Rh,effects:Fh},Bh="bubble-burst",Wh="Bubble Burst",Gh="Creates a cluster of explosive bubbles that detonate on impact",Hh=["aoe",2,3,1],Vh="5d2",Yh={id:Bh,name:Wh,description:Gh,pattern:Hh,power:Vh},Kh="entangle",zh="Entangle",Jh="Roots the target in place with vines and thorns",Qh=["direct"],Xh="1d4",Zh=[{type:"root",duration:3}],ef={id:Kh,name:zh,description:Jh,pattern:Qh,power:Xh,effects:Zh},tf="fang-strike",nf="Fang Strike",sf="A sharp bite attack using the fish's prominent fangs",af=["direct"],rf="2d4",of={id:tf,name:nf,description:sf,pattern:af,power:rf},lf="fin-slash",cf="Fin Slash",df="A sweeping attack with razor-sharp fins that cuts through multiple enemies",uf=["line",1,1,3],mf="3d3",hf={id:lf,name:cf,description:df,pattern:uf,power:mf},ff="fire-breath",pf="Fire Breath",gf="A devastating blast of flames that burns enemies over time",yf=["ranged",1,3],bf="2d4",xf=[{type:"burn",damage:3,duration:4}],vf={id:ff,name:pf,description:gf,pattern:yf,power:bf,effects:xf},wf="fireball",kf="Fireball",jf="Area of effect attack",Nf=["aoe",2,2,1],$f="1d6",_f={id:wf,name:kf,description:jf,pattern:Nf,power:$f},If="forest-awakening",Tf="Forest Awakening",Cf="Awakens the ancient power of the forest, creating a devastating torus of natural energy that damages and weakens enemies",Ef=["torus",1,3],Sf="4d6",Af=[{type:"apply_modifier",modifierType:"attack_multiplier",value:1,duration:2},{type:"apply_modifier",modifierType:"defense_multiplier",value:1,duration:2}],Lf={id:If,name:Tf,description:Cf,pattern:Ef,power:Sf,effects:Af},Uf="headbutt",qf="Headbutt",Pf="A powerful headbutt attack",Mf=["direct"],Of="2d3",Rf={id:Uf,name:qf,description:Pf,pattern:Mf,power:Of},Ff="inner-fire",Df="Inner Fire",Bf="Ignites inner strength, doubling attack power",Wf=["self"],Gf="0d0",Hf=[{type:"apply_modifier",modifierType:"attack_multiplier",value:1}],Vf={id:Ff,name:Df,description:Bf,pattern:Wf,power:Gf,effects:Hf},Yf="kick",Kf="Kick",zf="A powerful kick that can knock back the target",Jf=["direct"],Qf="1d6",Xf=[{type:"push",distance:1}],Zf={id:Yf,name:Kf,description:zf,pattern:Jf,power:Qf,effects:Xf},ep="leap-crush",tp="Leap Crush",np="Leaps onto enemies with crushing force",sp=["ranged",2,2],ap="2d4",ip={id:ep,name:tp,description:np,pattern:sp,power:ap},rp="life-drain",op="Life Drain",lp="Drains life force from the target, healing the caster",cp=["direct"],dp="1d6",up=[{type:"drain",amount:5,duration:2}],mp={id:rp,name:op,description:lp,pattern:cp,power:dp,effects:up},hp="lightning-strike",fp="Lightning Strike",pp="A powerful electrical attack that stuns the target with crackling energy",gp=["direct"],yp="2d6",bp=[{type:"stun",duration:2}],xp={id:hp,name:fp,description:pp,pattern:gp,power:yp,effects:bp},vp="lily-pad-bounce",wp="Lily Pad Bounce",kp="Leaps onto enemies using water lily pads for momentum",jp=["ranged",2,3],Np="2d4",$p={id:vp,name:wp,description:kp,pattern:jp,power:Np},_p="lullaby",Ip="Lullaby",Tp="A soothing melody that puts enemies to sleep",Cp=["torus",0,2],Ep="0d0",Sp=[{type:"sleep",duration:3}],Ap={id:_p,name:Ip,description:Tp,pattern:Cp,power:Ep,effects:Sp},Lp="mire-splash",Up="Mire Splash",qp="Splashes muddy water in a wide area, drenching enemies",Pp=["torus",1,1],Mp="6d1",Op={id:Lp,name:Up,description:qp,pattern:Pp,power:Mp},Rp="mirror-aura",Fp="Mirror Aura",Dp="Creates a reflective aura that returns a portion of incoming damage to attackers",Bp=["self"],Wp="0d0",Gp=[{type:"reflect",percentage:50,duration:4}],Hp={id:Rp,name:Fp,description:Dp,pattern:Bp,power:Wp,effects:Gp},Vp="moonbeam",Yp="Moonbeam",Kp="A beam of moonlight that deals damage to all enemies",zp=["line",1,1,2],Jp="1d4",Qp={id:Vp,name:Yp,description:Kp,pattern:zp,power:Jp},Xp="multi-strike",Zp="Multi Strike",eg="A multi-strike attack that hits multiple enemies",tg=["tripleLine",3],ng="1d6",sg={id:Xp,name:Zp,description:eg,pattern:tg,power:ng},ag="peck",ig="Peck",rg="A quick peck with deadly intent",og=["direct"],lg="1d4",cg={id:ag,name:ig,description:rg,pattern:og,power:lg},dg="razor-claws",ug="Razor Claws",mg="Sharp claws that cause deep wounds that continue to bleed",hg=["direct"],fg="1d6",pg=[{type:"bleed",damage:2,duration:3}],gg={id:dg,name:ug,description:mg,pattern:hg,power:fg,effects:pg},yg="ripple-wave",bg="Ripple Wave",xg="Creates expanding water ripples that affect nearby enemies",vg=["torus",1,2],wg="3d2",kg={id:yg,name:bg,description:xg,pattern:vg,power:wg},jg="scratch",Ng="Scratch",$g="A quick swipe with deadly intent",_g=["direct"],Ig="1d6",Tg={id:jg,name:Ng,description:$g,pattern:_g,power:Ig},Cg="screech",Eg="Screech",Sg="Causes nearby enemies to fear the attacker",Ag=["direct"],Lg="0d0",Ug=[{type:"apply_modifier",modifierType:"defense_multiplier",value:-1}],qg={id:Cg,name:Eg,description:Sg,pattern:Ag,power:Lg,effects:Ug},Pg="slash",Mg="slash",Og="Direct melee attack",Rg=["direct"],Fg="1d6",Dg={id:Pg,name:Mg,description:Og,pattern:Rg,power:Fg},Bg="spore-bomb",Wg="Spore Bomb",Gg="A spore bomb that explodes on contact",Hg=["aoe",2,2,1],Vg="1d4",Yg={id:Bg,name:Wg,description:Gg,pattern:Hg,power:Vg},Kg="stealth-dive",zg="Stealth Dive",Jg="Dives underwater and emerges behind enemies for a surprise attack",Qg=["ranged",1,3],Xg="2d6",Zg={id:Kg,name:zg,description:Jg,pattern:Qg,power:Xg},ey="stone-wall",ty="Stone Wall",ny="Creates a barrier of stone to block enemy movement",sy=["aoe",1,2,1],ay="0d0",iy=[{type:"create_terrain",terrainType:"mountain",positions:[],duration:5}],ry={id:ey,name:ty,description:ny,pattern:sy,power:ay,effects:iy},oy="tail-slap",ly="Tail Slap",cy="A powerful tail strike that affects nearby enemies",dy=["torus",1,1],uy="4d2",my={id:oy,name:ly,description:cy,pattern:dy,power:uy},hy="thorn-barrage",fy="Thorn Barrage",py="Launches a volley of poisonous thorns that pierce through armor and poison enemies",gy=["ranged",2,5],yy="2d4",by=[{type:"poison",duration:3}],xy={id:hy,name:fy,description:py,pattern:gy,power:yy,effects:by},vy="tongue-lash",wy="Tongue Lash",ky="Extends a long, sticky tongue to strike enemies at range",jy=["ranged",2,4],Ny="1d4",$y=[{type:"apply_modifier",modifierType:"defense_multiplier",value:-1}],_y={id:vy,name:wy,description:ky,pattern:jy,power:Ny,effects:$y},Iy="toxic-croak",Ty="Toxic Croak",Cy="Emits a poisonous croak that affects nearby enemies",Ey=["torus",0,1],Sy="0d0",Ay=[{type:"poison",duration:3}],Ly={id:Iy,name:Ty,description:Cy,pattern:Ey,power:Sy,effects:Ay},Uy="verdant-storm",qy="Verdant Storm",Py="Summons a devastating storm of wind and thorns that ravages all enemies in a wide area",My=["aoe",2,4,2],Oy="3d6",Ry=[{type:"push",distance:1}],Fy={id:Uy,name:qy,description:Py,pattern:My,power:Oy,effects:Ry},Dy="warden-embrace",By="Warden Embrace",Wy="Channels the power of the forest to heal wounds and strengthen defenses",Gy=["self"],Hy="0d0",Vy=[{type:"heal",value:.25},{type:"apply_modifier",modifierType:"defense_multiplier",value:1,duration:3}],Yy={id:Dy,name:By,description:Wy,pattern:Gy,power:Hy,effects:Vy},Ky="water-bomb",zy="Water Bomb",Jy="Throws a concentrated water bomb that explodes on impact",Qy=["aoe",2,4,1],Xy="4d2",Zy={id:Ky,name:zy,description:Jy,pattern:Qy,power:Xy},eb="water-swipe",tb="Water Swipe",nb="A quick swipe with water-soaked claws",sb=["direct"],ab="1d6",ib={id:eb,name:tb,description:nb,pattern:sb,power:ab},rb="whirlpool",ob="Whirlpool",lb="Creates a spinning vortex of water that pulls in surrounding enemies",cb=["torus",2,3],db="6d2",ub={id:rb,name:ob,description:lb,pattern:cb,power:db},mb="wind-rush",hb="Wind Rush",fb="Grants incredible speed and agility, increasing movement range",pb=["self"],gb="0d0",yb=[{type:"haste",bonusRange:2,duration:3}],bb={id:mb,name:hb,description:fb,pattern:pb,power:gb,effects:yb},ta=e=>e?e.map(t=>{switch(t.type){case"apply_modifier":if(!t.modifierType||t.value===void 0)throw new Error("apply_modifier effect requires modifierType and value");return{type:k.APPLY_MODIFIER,value:t.value,duration:t.duration??null,modifierType:t.modifierType};case"heal":if(t.value===void 0)throw new Error("heal effect requires value");return{type:k.HEAL,value:t.value};case"push":if(t.distance===void 0)throw new Error("push effect requires distance");return{type:k.PUSH,distance:t.distance};case"poison":if(t.duration===void 0)throw new Error("poison effect requires duration");return{type:k.POISON,duration:t.duration};case"stun":if(t.duration===void 0)throw new Error("stun effect requires duration");return{type:k.STUN,duration:t.duration};case"sleep":if(t.duration===void 0)throw new Error("sleep effect requires duration");return{type:k.SLEEP,duration:t.duration};case"burn":if(t.damage===void 0||t.duration===void 0)throw new Error("burn effect requires damage and duration");return{type:k.BURN,damage:t.damage,duration:t.duration};case"bleed":if(t.damage===void 0||t.duration===void 0)throw new Error("bleed effect requires damage and duration");return{type:k.BLEED,damage:t.damage,duration:t.duration};case"shield":if(t.amount===void 0||t.duration===void 0)throw new Error("shield effect requires amount and duration");return{type:k.SHIELD,amount:t.amount,duration:t.duration};case"reflect":if(t.percentage===void 0||t.duration===void 0)throw new Error("reflect effect requires percentage and duration");return{type:k.REFLECT,percentage:t.percentage,duration:t.duration};case"teleport":if(!t.position)throw new Error("teleport effect requires position");return{type:k.TELEPORT,position:t.position};case"root":if(t.duration===void 0)throw new Error("root effect requires duration");return{type:k.ROOT,duration:t.duration};case"haste":if(t.bonusRange===void 0||t.duration===void 0)throw new Error("haste effect requires bonusRange and duration");return{type:k.HASTE,bonusRange:t.bonusRange,duration:t.duration};case"drain":if(t.amount===void 0||t.duration===void 0)throw new Error("drain effect requires amount and duration");return{type:k.DRAIN,amount:t.amount,duration:t.duration};case"create_terrain":if(!t.terrainType||!t.positions||t.duration===void 0)throw new Error("create_terrain effect requires terrainType, positions, and duration");return{type:k.CREATE_TERRAIN,terrainType:t.terrainType,positions:t.positions,duration:t.duration};case"critical_strike":if(t.multiplier===void 0)throw new Error("critical_strike effect requires multiplier");return{type:k.CRITICAL_STRIKE,multiplier:t.multiplier};case"armor_pierce":if(t.percentage===void 0)throw new Error("armor_pierce effect requires percentage");return{type:k.ARMOR_PIERCE,percentage:t.percentage};case"cure_poison":return{type:k.CURE_POISON};default:throw new Error(`Unknown effect type: ${t.type}`)}}):[],xb=()=>({id:"direct",needsTarget:!0,meta:{Range:1},getTargets:(e,t,n)=>[t],validateTarget:(e,t)=>te(e,t)===1}),vb=()=>({id:"self",needsTarget:!0,meta:{Self:!0},getTargets:(e,t,n)=>[e],validateTarget:(e,t)=>te(e,t)===0}),wb=(e,t)=>({id:"ranged",needsTarget:!0,meta:{Range:e===t?e:`${e}-${t}`},getTargets:(n,s,i)=>[s],validateTarget:(n,s)=>{const i=te(n,s);return i>=e&&i<=t}}),kb=(e,t,n)=>({id:"aoe",needsTarget:!1,meta:{Range:e===t?e:`${e}-${t}`,Area:n},getTargets:(s,i,r)=>Mn(i,n).filter(l=>Ie(l,r)),validateTarget:(s,i)=>{const r=te(s,i);return r>=e&&r<=t}}),jb=(e,t,n)=>({id:"line",needsTarget:!1,meta:{Range:e===t?e:`${e}-${t}`,Distance:n},getTargets:(s,i,r)=>{const o=[],l=i.q-s.q,c=i.r-s.r,d={q:Math.sign(l),r:Math.sign(c)};if(te(s,i)!==1)return o;for(let m=1;m<=n;m++){const u={q:s.q+d.q*m,r:s.r+d.r*m};Ie(u,r)&&o.push(u)}return o},validateTarget:(s,i)=>{const r=te(s,i);return r>=e&&r<=t}}),Nb=e=>({id:"tripleLine",needsTarget:!0,meta:{Range:1,Distance:e},getTargets:(t,n,s)=>{const i=[],r=n.q-t.q,o=n.r-t.r,l={q:Math.sign(r),r:Math.sign(o)};return te(t,n)!==1||[l,{q:-l.r,r:l.q+l.r},{q:l.q+l.r,r:-l.q}].forEach(d=>{for(let m=1;m<=e;m++){const u={q:t.q+d.q*m,r:t.r+d.r*m};Ie(u,s)&&i.push(u)}}),i},validateTarget:(t,n)=>te(t,n)===1}),$b=(e,t)=>({id:"torus",needsTarget:!1,meta:{Torus:e===t?e:`${e}-${t}`},getTargets:(n,s,i)=>Mn(n,t).filter(o=>Ie(o,i)).filter(o=>{const l=te(n,o);return l>=e&&l<=t}),validateTarget:(n,s)=>te(n,s)===0}),na=(e,t=n=>`tile-${n}-${Date.now()}`)=>{const[n,...s]=e;switch(n){case"direct":{if(s.length!==0)throw new Error("Direct pattern requires exactly zero arguments");const i=xb();return{...i,id:t(n),validateTarget:i.validateTarget}}case"self":{if(s.length!==0)throw new Error("Self pattern requires exactly zero arguments");const i=vb();return{...i,id:t(n),validateTarget:i.validateTarget}}case"ranged":{if(s.length!==2||typeof s[0]!="number"||typeof s[1]!="number")throw new Error("Ranged pattern requires exactly two number arguments (minRange, maxRange)");const i=wb(s[0],s[1]);return{...i,id:t(n),validateTarget:i.validateTarget}}case"aoe":{if(s.length!==3||typeof s[0]!="number"||typeof s[1]!="number"||typeof s[2]!="number")throw new Error("AOE pattern requires exactly three number arguments (minRange, maxRange, areaEffect)");const i=kb(s[0],s[1],s[2]);return{...i,id:t(n),validateTarget:i.validateTarget}}case"line":{if(s.length!==3||typeof s[0]!="number"||typeof s[1]!="number"||typeof s[2]!="number")throw new Error("Line pattern requires exactly three number arguments (minRange, maxRange, lineLength)");const i=jb(s[0],s[1],s[2]);return{...i,id:t(n),validateTarget:i.validateTarget}}case"tripleLine":{if(s.length!==1||typeof s[0]!="number")throw new Error("Triple line pattern requires exactly one number argument (lineLength)");const i=Nb(s[0]);return{...i,id:t(n),validateTarget:i.validateTarget}}case"torus":{if(s.length!==2||typeof s[0]!="number"||typeof s[1]!="number")throw new Error("Torus pattern requires exactly two number arguments (innerRadius, outerRadius)");const i=$b(s[0],s[1]);return{...i,id:t(n),validateTarget:i.validateTarget}}default:throw new Error(`Unknown tile pattern type: ${n}`)}},_b=e=>{const t=na(e.pattern),[n,s]=e.power.split("d").map(Number),i=ta(e.effects);return{id:e.id,name:e.name,description:e.description,pattern:t,power:[n,s],effects:i.length>0?i:[]}},sa={};let aa=!1;const ia=()=>{Object.entries(Object.assign({"./attackConfigs/aqua-jet.json":hh,"./attackConfigs/armor-shatter.json":vh,"./attackConfigs/assassinate.json":Ih,"./attackConfigs/barrier.json":Uh,"./attackConfigs/blink.json":Dh,"./attackConfigs/bubble-burst.json":Yh,"./attackConfigs/entangle.json":ef,"./attackConfigs/fang-strike.json":of,"./attackConfigs/fin-slash.json":hf,"./attackConfigs/fire-breath.json":vf,"./attackConfigs/fireball.json":_f,"./attackConfigs/forest-awakening.json":Lf,"./attackConfigs/headbutt.json":Rf,"./attackConfigs/inner-fire.json":Vf,"./attackConfigs/kick.json":Zf,"./attackConfigs/leap-crush.json":ip,"./attackConfigs/life-drain.json":mp,"./attackConfigs/lightning-strike.json":xp,"./attackConfigs/lily-pad-bounce.json":$p,"./attackConfigs/lullaby.json":Ap,"./attackConfigs/mire-splash.json":Op,"./attackConfigs/mirror-aura.json":Hp,"./attackConfigs/moonbeam.json":Qp,"./attackConfigs/multi-strike.json":sg,"./attackConfigs/peck.json":cg,"./attackConfigs/razor-claws.json":gg,"./attackConfigs/ripple-wave.json":kg,"./attackConfigs/scratch.json":Tg,"./attackConfigs/screech.json":qg,"./attackConfigs/slash.json":Dg,"./attackConfigs/spore-bomb.json":Yg,"./attackConfigs/stealth-dive.json":Zg,"./attackConfigs/stone-wall.json":ry,"./attackConfigs/tail-slap.json":my,"./attackConfigs/thorn-barrage.json":xy,"./attackConfigs/tongue-lash.json":_y,"./attackConfigs/toxic-croak.json":Ly,"./attackConfigs/verdant-storm.json":Fy,"./attackConfigs/warden-embrace.json":Yy,"./attackConfigs/water-bomb.json":Zy,"./attackConfigs/water-swipe.json":ib,"./attackConfigs/whirlpool.json":ub,"./attackConfigs/wind-rush.json":bb})).forEach(([t,n])=>{try{const s=t.replace("./attackConfigs/","").replace(".json",""),i=n,r=zo(i);if(!r.isValid){console.error(`Attack config ${s} failed schema validation:`,r.errors);return}if(!i.id){console.warn(`Attack config ${s} is missing id field, skipping`);return}if(i.id!==s){console.warn(`Attack config ${s} has id field ${i.id}, skipping`);return}sa[i.id]=_b(i)}catch(s){console.error(`Failed to process attack config from ${t}:`,s)}}),aa=!0},Ue=e=>{aa||ia();const t=sa[e];if(!t)throw new Error(`Attack type not found: ${e}`);return t},Ve=e=>e.map(t=>Ue(t));window.hydrateAttackConfigs=ia;const Ib="ancient-forest/forest-researcher",Tb="Forest Researcher Battle",Cb="A battle with a researcher studying wildlight behavior",Eb=3,Sb=200,Ab={ratios:{forest:8,grass:2}},Lb={squad:[{unitType:"embermew",level:4},{unitType:"mireglow-guardian",level:4}]},Ub={id:Ib,name:Tb,description:Cb,radius:Eb,pointLimit:Sb,terrain:Ab,enemyUnits:Lb},qb="ancient-forest/old-man-forest",Pb="Ancient Forest",Mb="A dense forest with advanced enemies.",Ob=3,Rb=300,Fb={ratios:{grass:1,mountain:1,forest:10}},Db={squad:[{unitType:"shadow-of-the-forest",level:3},{unitType:"umbralis",level:2},{unitType:"trainer",level:5,trainerId:"old-man-forest"}]},Bb={id:qb,name:Pb,description:Mb,radius:Ob,pointLimit:Rb,terrain:Fb,enemyUnits:Db},Wb="ancient-forest/wildlight",Gb="Ancient Forest Wildlight Search",Hb="A random encounter while searching for wildlight in the ancient forest",Vb=3,Yb=150,Kb={ratios:{forest:8,grass:2,water:1}},zb={squad:[{unitType:"embermew",level:3},{unitType:"embermew",level:4},{unitType:"mireglow-guardian",level:3},{unitType:"mireglow-guardian",level:4}]},Jb={id:Wb,name:Gb,description:Hb,radius:Vb,pointLimit:Yb,terrain:Kb,enemyUnits:zb},Qb="field-1/wildlight",Xb="Field Wildlight Search",Zb="A random encounter while searching for wildlight in the field",ex=3,tx=150,nx={ratios:{forest:8,grass:2,water:1}},sx={squad:[{unitType:"embermew",level:3},{unitType:"embermew",level:4},{unitType:"mireglow-guardian",level:3},{unitType:"mireglow-guardian",level:4}]},ax={id:Qb,name:Xb,description:Zb,radius:ex,pointLimit:tx,terrain:nx,enemyUnits:sx},ix="lakeside-town/lake-guardian",rx="Lake Guardian Battle",ox="A battle with the guardian of the sacred lake",lx=4,cx=400,dx={ratios:{water:6,grass:2,forest:2}},ux={squad:[{unitType:"trainer",level:7,trainerId:"lake-guardian"},{unitType:"ripplemask",level:6},{unitType:"verdant-fangfin",level:6},{unitType:"mireglow-guardian",level:5}]},mx={id:ix,name:rx,description:ox,radius:lx,pointLimit:cx,terrain:dx,enemyUnits:ux},hx="lakeside-town/wildlight",fx="Lakeside Town Wildlight Search",px="A random encounter while searching for wildlight near the lakeside town",gx=3,yx=200,bx={ratios:{water:5,grass:3,forest:2}},xx={squad:[{unitType:"embermew",level:5},{unitType:"mireglow-guardian",level:5},{unitType:"mireglow-guardian",level:6}]},vx={id:hx,name:fx,description:px,radius:gx,pointLimit:yx,terrain:bx,enemyUnits:xx},wx="lakeside-town/woodland-lakes",kx="Woodland Lakes",jx="A lake in the woods.",Nx=5,$x=300,_x={ratios:{water:1,forest:1}},Ix={squad:[{unitType:"mireglow-guardian",level:5},{unitType:"ripplemask",level:5},{unitType:"verdant-fangfin",level:5}]},Tx={id:wx,name:kx,description:jx,radius:Nx,pointLimit:$x,terrain:_x,enemyUnits:Ix},Cx="legacy/all-grass",Ex="All Grass",Sx="Test",Ax=3,Lx={ratios:{grass:1}},Ux={count:0,ratios:{}},qx=100,Px={id:Cx,name:Ex,description:Sx,radius:Ax,terrain:Lx,enemyUnits:Ux,pointLimit:qx},Mx="legacy/all-water",Ox="All Water",Rx="Test",Fx=3,Dx={ratios:{water:1}},Bx={count:0,ratios:{}},Wx=100,Gx={id:Mx,name:Ox,description:Rx,radius:Fx,terrain:Dx,enemyUnits:Bx,pointLimit:Wx},Hx="legacy/forest-clearing",Vx="Forest Clearing",Yx="A mystical clearing in the forest.",Kx=4,zx=500,Jx={tiles:[[null,null,null,null,"forest","forest","forest","forest","forest"],[null,null,null,"forest","grass","grass","grass","grass","forest"],[null,null,"forest","grass","grass","grass","grass","grass","forest"],[null,"forest","grass","grass","water","water","water","grass","forest"],["forest","grass","grass","water","water","grass","grass","grass","forest"],["forest","grass","grass","water","water","water","grass","forest",null],["forest","grass","grass","grass","grass","grass","forest",null,null],["forest","grass","grass","grass","grass","forest",null,null,null],["forest","forest","forest","forest","forest",null,null,null,null]]},Qx={tiles:{"syltharion-the-verdant-warden":[{q:1,r:0}],whisperhart:[{q:3,r:-1},{q:2,r:0},{q:2,r:1}]}},Xx={id:Hx,name:Vx,description:Yx,radius:Kx,pointLimit:zx,terrain:Jx,enemyUnits:Qx},Zx="legacy/western-field",ev="Western Field",tv="A small field to the west of town.",nv=3,sv=300,av={ratios:{grass:10,water:1,forest:4}},iv={squad:[{unitType:"mossfeather",level:5},{unitType:"embermew",level:5},{unitType:"suntusk",level:3},{unitType:"suntusk",level:3},{unitType:"suntusk",level:3}]},rv={id:Zx,name:ev,description:tv,radius:nv,pointLimit:sv,terrain:av,enemyUnits:iv},ov="legacy/western-forest",lv="Western Forest",cv="A dense forest to the west of town.",dv=3,uv=300,mv={ratios:{grass:4,water:1,forest:10}},hv={squad:[{unitType:"whisperhart",level:5},{unitType:"mycelin",level:5},{unitType:"mycelin",level:5},{unitType:"mycelin",level:5}]},fv={id:ov,name:lv,description:cv,radius:dv,pointLimit:uv,terrain:mv,enemyUnits:hv},pv="town/training-field",gv="Training Field",yv="A small training field for basic tactics.",bv=3,xv=1e3,vv={ratios:{grass:10,water:1,forest:1}},wv={squad:[{unitType:"mossfeather",level:3}]},kv={id:pv,name:gv,description:yv,radius:bv,pointLimit:xv,terrain:vv,enemyUnits:wv},jv="town/wildlight",Nv="Town Wildlight Search",$v="A random encounter while searching for wildlight near the town",_v=3,Iv=100,Tv={ratios:{grass:7,water:3}},Cv={squad:[{unitType:"embermew",level:1},{unitType:"embermew",level:2},{unitType:"mireglow-guardian",level:1},{unitType:"mireglow-guardian",level:2},{unitType:"stormcaller",level:3}]},Ev={id:jv,name:Nv,description:$v,radius:_v,pointLimit:Iv,terrain:Tv,enemyUnits:Cv},ra={};let oa=!1;const la=()=>{Object.entries(Object.assign({"./battleConfigs/ancient-forest/forest-researcher.json":Ub,"./battleConfigs/ancient-forest/old-man-forest.json":Bb,"./battleConfigs/ancient-forest/wildlight.json":Jb,"./battleConfigs/field-1/wildlight.json":ax,"./battleConfigs/lakeside-town/lake-guardian.json":mx,"./battleConfigs/lakeside-town/wildlight.json":vx,"./battleConfigs/lakeside-town/woodland-lakes.json":Tx,"./battleConfigs/legacy/all-grass.json":Px,"./battleConfigs/legacy/all-water.json":Gx,"./battleConfigs/legacy/forest-clearing.json":Xx,"./battleConfigs/legacy/western-field.json":rv,"./battleConfigs/legacy/western-forest.json":fv,"./battleConfigs/town/training-field.json":kv,"./battleConfigs/town/wildlight.json":Ev})).forEach(([t,n])=>{try{const s=t.replace("./battleConfigs/","").replace(".json","").replace(/\//g,"/"),i=n,r=Jo(i);if(!r.isValid){console.error(`Battle config ${s} failed schema validation:`,r.errors);return}if(!i.id){console.warn(`Battle config ${s} is missing id field, skipping`);return}ra[i.id]=i}catch(s){console.error(`Failed to process battle config from ${t}:`,s)}}),oa=!0},Fn=e=>{oa||la();const t=ra[e];if(!t)throw new Error(`Location not found: ${e}`);return t};window.hydrateBattleConfigs=la;const Sv="antidote",Av="Antidote",Lv="A curative potion that removes poison effects.",Uv=!0,qv=["self"],Pv=[{type:"cure_poison"}],Mv={id:Sv,name:Av,description:Lv,consumable:Uv,pattern:qv,effects:Pv},Ov="potion",Rv="Potion",Fv="A basic healing potion that restores 10 health.",Dv=!0,Bv=["ranged",0,1],Wv=[{type:"heal",value:10}],Gv={id:Ov,name:Rv,description:Fv,consumable:Dv,pattern:Bv,effects:Wv},Hv="power-up",Vv="Power Up",Yv="A permanent enhancement that increases attack and defense by 1.",Kv=!0,zv=["self"],Jv=[{type:"apply_modifier",modifierType:"attack_multiplier",value:1,duration:null},{type:"apply_modifier",modifierType:"defense_multiplier",value:1,duration:null}],Qv={id:Hv,name:Vv,description:Yv,consumable:Kv,pattern:zv,effects:Jv},Xv="super-potion",Zv="Super Potion",ew="A powerful healing potion that restores 25 health.",tw=!0,nw=["self"],sw=[{type:"heal",value:25}],aw={id:Xv,name:Zv,description:ew,consumable:tw,pattern:nw,effects:sw},iw=e=>{const t=na(e.pattern),n=ta(e.effects);return{id:e.id,name:e.name,description:e.description,consumable:e.consumable,pattern:t,effects:n.length>0?n:[],iconImage:`/src/assets/items/${e.id}.png`}},ca={};let da=!1;const ua=()=>{Object.entries(Object.assign({"./itemConfigs/antidote.json":Mv,"./itemConfigs/potion.json":Gv,"./itemConfigs/power-up.json":Qv,"./itemConfigs/super-potion.json":aw})).forEach(([t,n])=>{try{const s=t.replace("./itemConfigs/","").replace(".json",""),i=n,r=Zo(i);if(!r.isValid){console.error(`Item config ${s} failed schema validation:`,r.errors);return}if(!i.id){console.warn(`Item config ${s} is missing id field, skipping`);return}if(i.id!==s){console.warn(`Item config ${s} has id field ${i.id}, skipping`);return}ca[i.id]=iw(i)}catch(s){console.error(`Failed to process item config from ${t}:`,s)}}),da=!0},it=e=>{da||ua();const t=ca[e];if(!t)throw new Error(`Item not found: ${e}`);return t};window.hydrateItemConfigs=ua;const rw=()=>(e,t)=>{localStorage.removeItem("persist:root"),e(ne.reset()),e(L.reset()),e(Se.reset()),e(J.startGame())},ow=()=>(e,t)=>{const n=t(),s=new Date().toISOString().slice(0,19).replace(/:/g,"-"),r=JSON.stringify({version:"1.0.0",timestamp:s,state:n}),o=new Blob([r],{type:"application/json"}),l=URL.createObjectURL(o),c=document.createElement("a");c.href=l,c.download=`wildlight-tactics-${s}.json`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(l)},lw=e=>async(t,n)=>{try{const s=await e.text(),i=JSON.parse(s);if(!i.version||!i.state)throw new Error("Invalid save file format");localStorage.setItem("persist:root",JSON.stringify(i.state)),t(J.startOverworld())}catch(s){throw console.error("Failed to load save file:",s),new Error("Failed to load save file. Please check the file format.")}},cw=(e,t)=>(n,s)=>{throw new Error("enterLocation is deprecated. Use startTrainerBattle instead.")},dw=(e,t)=>(n,s)=>{const i=s(),r=Fn(e.battleConfigId),{map:o,units:l,players:c}=Qs(r,i.battle.players),d=[...new Set(Object.values(l).filter(u=>u.playerId===2).filter(u=>!q(u)).map(u=>u.unitType))],m=[...new Set(Object.values(l).filter(u=>u.playerId===2).filter(q).map(u=>u.trainerId))];n(J.recordSeenUnitTypes({locationId:t,unitTypeIds:d})),m.forEach(u=>{n(J.recordSeenTrainer({locationId:t,trainerId:u}))}),n(L.startBattle({map:o,units:l,players:c,radius:r.radius})),n(J.startBattle(t))},uw=e=>(t,n)=>{const s=n(),i=s.overworld.locations.find(m=>m.id===e);if(!i?.wildlightSearchConfig)throw new Error(`No wildlight search config found for location: ${e}`);const r=Fn(i.wildlightSearchConfig.battleConfigId),{map:o,units:l,players:c}=Qs(r,s.battle.players),d=[...new Set(Object.values(l).filter(m=>m.playerId===2).filter(m=>!q(m)).map(m=>m.unitType))];t(J.recordSeenUnitTypes({locationId:e,unitTypeIds:d})),t(L.startBattle({map:o,units:l,players:c,radius:r.radius})),t(J.startBattle(e))},mw=(e,t)=>(n,s)=>{const i=s(),r=lm(e);n(r.execute(i,t))},hw=(e,t)=>(n,s)=>{const i=s(),r=i.battle.units[e],o=F(i.battle.map,r.id);if(!o){console.error("Attacker not found on map");return}if(!i.battle.selectedAttack){console.error("No attack name provided");return}const l=Ue(i.battle.selectedAttack),c=l.pattern.getTargets(o,t,i.battle.radius);Xs(i.battle.map,c).map(m=>i.battle.units[m]).forEach(m=>{const{damage:u,meta:h}=ah(r,m,l);n(L.applyDamage({targetId:m.id,damage:u,attackerId:r.id,meta:h})),l.effects.forEach(y=>{n(L.applyEffect({targetId:m.id,attackerId:r.id,effect:y}))})}),n(L.finishAttacking({unitId:r.id})),setTimeout(()=>{n(L.endActionCleanup()),n(lt())},1e3)},fw=(e,t)=>(n,s)=>{const i=s(),r=i.battle.units[e],o=i.battle.units[t];if(Object.values(i.battle.units).some(c=>c.playerId===o.playerId&&c.unitType==="trainer")){console.warn("Cannot capture units when opposing team has a trainer");return}n(L.captureUnit({unitId:o.id})),n(ne.addCapturedUnitToArmy({playerId:r.playerId,unit:o})),n(L.finishCapturing({trainerId:r.id})),setTimeout(()=>{n(L.endActionCleanup()),n(lt())},1e3)},pw=(e,t)=>(n,s)=>{const i=s(),r=i.battle.selectedItem,o=F(i.battle.map,e);if(!o){console.error("Unit not found on map");return}if(!r){console.warn("No item selected");return}const l=it(r);if(!l.pattern.validateTarget(o,t)){console.warn("Invalid target position for item");return}const c=l.pattern.getTargets(o,t,i.battle.radius);Xs(i.battle.map,c).forEach(m=>{l.effects.forEach(u=>{n(L.applyEffect({targetId:m,attackerId:e,effect:u}))})}),l.consumable&&n(J.consumeItem(r)),n(L.finishUsingItem({unitId:e})),setTimeout(()=>{n(L.endActionCleanup()),n(lt())},1e3)},gw=(e,t)=>(n,s)=>{const i=s(),r=i.battle.selectedSummonUnit,o=F(i.battle.map,e);if(!o){console.error("Trainer not found on map");return}if(!r){console.warn("No unit selected for summoning");return}const l=i.army.armies[i.battle.currentPlayerId].units.find(f=>f.id===r);if(!l){console.error("Unit not found in army");return}if(Object.values(i.battle.units).some(f=>f.id===r)){console.warn("Unit is already in battle");return}if(!an(o).some(f=>f.q===t.q&&f.r===t.r)){console.warn("Target position must be adjacent to trainer");return}const u=t.r+i.battle.radius,h=t.q+i.battle.radius,y=i.battle.map[u]?.[h];if(!y||y.unitId!==null){console.warn("Target position is not available");return}const x={...l,health:l.maxHealth,hasMoved:!1,hasAttacked:!1,modifiers:[]};n(L.placeUnit({armyUnit:x,position:t})),n(L.finishSummoning({trainerId:e})),setTimeout(()=>{n(L.endActionCleanup()),n(lt())},1e3)},yw=()=>(e,t)=>{const n=t(),s=n.battle.currentPlayerId===1?2:1,i=n.battle.currentPlayerId===2?n.battle.turnNumber+1:n.battle.turnNumber;Object.values(n.battle.units).filter(o=>o.playerId===s).forEach(o=>{const l=Lm(o);l>0&&e(L.applyDamage({targetId:o.id,damage:l,meta:{damageType:"poison"}}));const c=Mm(o);c>0&&e(L.applyDamage({targetId:o.id,damage:c,meta:{damageType:"burn"}}));const d=Rm(o);d>0&&e(L.applyDamage({targetId:o.id,damage:d,meta:{damageType:"bleed"}}))}),e(L.endTurnInternal({newPlayerId:s,newTurnNumber:i})),e(lt())},bw=()=>(e,t)=>{e(L.surrenderInternal()),e(lt())},lt=()=>(e,t)=>{const n=t();if(n.battle.winner)return;const s=vm(n.battle.surrendered,n.battle.players,n.battle.units);s&&e(L.setWinner(s)),setTimeout(()=>{const i=t(),r=i.battle.winner;if(!r)return;e(xw());const o={id:`battle_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date().toISOString(),locationId:i.overworld.playerLocationId,outcome:r.condition===le.DRAW?Be.DRAW:r.playerId===1?Be.WON:Be.LOST,turnNumber:i.battle.turnNumber,unitsKilled:i.battle.kills.length,unitsCaptured:i.battle.captures.length,trainerId:Object.values(i.battle.units).find(l=>l.unitType==="trainer"&&l.playerId===2)?.trainerId??null};e(J.endBattle(o))},1e3)},xw=()=>(e,t)=>{const n=t(),{winner:s,kills:i,units:r,players:o}=n.battle;if(!s||s.condition===le.DRAW||s.playerId!==1)return;const l=oh(o.find(c=>c.id===s.playerId),r,i);for(const c of l)e(L.recordExperienceGain(c)),e(ne.addExperienceToUnit({playerId:s.playerId,unitId:c.unitId,experience:c.experience}))},ct=yi,ee=gi,vw=pi.withTypes(),_t=()=>{const e=ct();return{startGame:()=>e(rw()),saveGame:()=>e(ow()),loadGame:t=>e(lw(t)),enterLocation:(t,n)=>e(cw()),startTrainerBattle:(t,n)=>e(dw(t,n)),startWildlightSearchBattle:t=>e(uw(t)),executeAttack:(t,n)=>e(hw(t,n)),captureUnit:(t,n)=>e(fw(t,n)),employItem:(t,n)=>e(pw(t,n)),summonUnit:(t,n)=>e(gw(t,n)),endTurn:()=>e(yw()),surrender:()=>e(bw()),executeConversationAction:(t,n)=>e(mw(t,n))}},Ye=(e,t,n=[])=>{const s=ct();p.useEffect(()=>s(vw({type:e,effect:t})),[s,e,t,n])};window.reloadOverworld=()=>{kt.dispatch(Se.reset())};window.unlockAllLocations=()=>{kt.getState().overworld.locations.forEach(t=>{kt.dispatch(Se.unlockLocation(t.id))})};const Te=()=>ee(e=>e.game);ce([e=>e.game.seenUnitTypes,(e,t)=>t],(e,t)=>e[t]||[]);ce([e=>e.game.seenTrainers,(e,t)=>t],(e,t)=>e[t]||[]);const ww=ce([e=>e],e=>Js().filter(t=>t.meta.location===e.overworld.playerLocationId).filter(t=>t.meta.conditions.every(n=>cm(n).evaluate(e))).map(t=>({...t.meta,completed:e.game.completedConversations[t.meta.conversation_id]}))),kw=()=>ee(e=>ww(e)),qe=()=>{const e=ct();return{startOverworld:()=>e(J.startOverworld()),startArmyManagement:()=>e(J.startArmyManagement()),startBestiary:()=>e(J.startBestiary()),startConversationEditor:()=>e(J.startConversationEditor()),addItemToBackpack:t=>e(J.addItemToBackpack(t)),returnToMenu:()=>e(J.returnToMenu()),startNPCDialog:t=>e(J.startNPCDialog(t)),endNPCDialog:()=>e(J.endNPCDialog())}},jw=ce([(e,t)=>e.army.armies[t],(e,t)=>e.battle.units,(e,t)=>t,(e,t)=>e.army.armies[t].selectedSquadId],(e,t,n,s)=>{const i=Object.values(t).filter(c=>c.playerId===n),r=e.units.find(c=>c.unitType==="trainer")||null,o=e.units.filter(c=>{if(c.unitType==="trainer")return!1;if(s!="all")if(s=="unassigned"){if(e.squads.some(u=>u.unitIds.includes(c.id)))return!1}else{const m=e.squads.find(u=>u.id===s);if(m&&!m.unitIds.includes(c.id))return!1}return!i.some(m=>m.unitType===c.unitType&&m.name===c.name)}),l=ea(i);return{trainer:r,availableArmyUnits:o,placedUnits:i,selectedSquadId:s,totalPlacedCost:l}}),Dn=e=>ee(t=>t.army.armies[e].units),ma=e=>ee(t=>t.army.armies[e].squads),ha=(e,t)=>ee(n=>n.army.armies[e].units.find(s=>s.id===t)),fa=e=>ee(t=>jw(t,e)),Nw=()=>ee(e=>e.army.levelUpUnits[0]),rn=()=>{const e=ct();return{addUnitToArmy:(t,n,s)=>e(ne.addUnitToArmy({playerId:t,unitType:n,level:s})),removeUnitFromArmy:(t,n)=>e(ne.removeUnitFromArmy({playerId:t,unitId:n})),createSquad:(t,n)=>e(ne.createSquad({playerId:t,name:n})),deleteSquad:(t,n)=>e(ne.deleteSquad({playerId:t,squadId:n})),addUnitToSquad:(t,n,s)=>e(ne.addUnitToSquad({playerId:t,unitId:n,squadId:s})),removeUnitFromSquad:(t,n,s)=>e(ne.removeUnitFromSquad({playerId:t,unitId:n,squadId:s})),renameSquad:(t,n,s)=>e(ne.renameSquad({playerId:t,squadId:n,newName:s})),selectSquad:(t,n)=>e(ne.selectSquad({playerId:t,squadId:n})),applyLevelUp:t=>e(ne.applyLevelUp(t)),learnAttack:(t,n,s)=>e(ne.learnAttack({playerId:t,unitId:n,attackId:s})),forgetAttack:(t,n,s)=>e(ne.forgetAttack({playerId:t,unitId:n,attackId:s}))}},$w=({units:e,squads:t,selectedSquadId:n,setSelectedSquadId:s,newSquadName:i,setNewSquadName:r,handleCreateSquad:o,editingSquadId:l,editingSquadName:c,setEditingSquadName:d,handleSaveSquadName:m,handleRemoveUnitFromSquad:u,handleCancelEditSquad:h,handleStartEditSquad:y,handleDeleteSquad:x})=>{const f=n?t.find(v=>v.id===n):null;return a.jsx("div",{className:"card card-bg-paper shadow-xl",children:a.jsxs("div",{className:"card-body",children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"label",children:a.jsx("span",{className:"label-text",children:"Select Squad to View"})}),a.jsxs("select",{className:"select select-bordered w-full bg-transparent border-black",value:n||"",onChange:v=>s(v.target.value),children:[a.jsx("option",{value:"",children:"All Units"}),t.map(v=>a.jsx("option",{value:v.id,children:v.name},v.id))]})]}),!n&&a.jsxs("div",{className:"join mb-4",children:[a.jsx("input",{type:"text",placeholder:"Squad name",className:"input input-bordered join-item flex-1 bg-transparent border-black",value:i,onChange:v=>r(v.target.value),onKeyDown:v=>v.key==="Enter"&&o()}),a.jsx("button",{className:"btn btn-neutral btn-outline join-item",onClick:o,disabled:!i.trim(),children:"Create Squad"})]}),f&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:l===f.id?a.jsxs("div",{className:"join flex-1",children:[a.jsx("input",{type:"text",className:"input input-bordered join-item flex-1",value:c,onChange:v=>d(v.target.value),onKeyDown:v=>v.key==="Enter"&&m()}),a.jsx("button",{className:"btn btn-success btn-sm join-item",onClick:m,children:"Save"}),a.jsx("button",{className:"btn btn-outline btn-sm join-item",onClick:h,children:"Cancel"})]}):a.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[a.jsx("h4",{className:"flex-1 font-bold text-lg",children:f.name}),a.jsx("button",{className:"btn btn-ghost btn-xs",onClick:()=>y(f),children:"✏️"}),a.jsx("button",{className:"btn btn-ghost btn-xs text-error",onClick:()=>x(f.id),children:"🗑️"})]})}),a.jsxs("div",{className:"stats stats-horizontal w-full",children:[a.jsxs("div",{className:"stat",children:[a.jsx("div",{className:"stat-title",children:"Units"}),a.jsx("div",{className:"stat-value text-primary",children:e.filter(v=>f.unitIds.includes(v.id)).length})]}),a.jsxs("div",{className:"stat",children:[a.jsx("div",{className:"stat-title",children:"Total Cost"}),a.jsx("div",{className:"stat-value text-secondary",children:ea(e.filter(v=>f.unitIds.includes(v.id)))})]})]})]})]})})};function _w({title:e,titleId:t,...n},s){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"}))}const Iw=p.forwardRef(_w);function Tw({title:e,titleId:t,...n},s){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"}))}const Cw=p.forwardRef(Tw);function Ew({title:e,titleId:t,...n},s){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"}))}const Sw=p.forwardRef(Ew);function Aw({title:e,titleId:t,...n},s){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const Lw=p.forwardRef(Aw);function Uw({title:e,titleId:t,...n},s){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const qw=p.forwardRef(Uw),Pw={[U.ATTACK_MULTIPLIER]:"Attack",[U.DEFENSE_MULTIPLIER]:"Defense"},Mw=({effect:e})=>{switch(e.type){case k.APPLY_MODIFIER:return a.jsxs("span",{className:"badge badge-outline badge-xs",children:[Pw[e.modifierType],e.value>0?` +${e.value}`:` ${e.value}`]});case k.HEAL:return a.jsxs("span",{className:"badge badge-outline badge-xs",children:["Heal: ",e.value]});case k.PUSH:return a.jsxs("span",{className:"badge badge-outline badge-xs",children:["Push: ",e.distance]});case k.POISON:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Poison"});case k.STUN:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Stun"});case k.SLEEP:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Sleep"});case k.BURN:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Burn"});case k.BLEED:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Bleed"});case k.SHIELD:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Shield"});case k.REFLECT:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Reflect"});case k.TELEPORT:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Teleport"});case k.ARMOR_PIERCE:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Armor Pierce"});case k.HASTE:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Haste"});case k.DRAIN:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Drain"});case k.CREATE_TERRAIN:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Create Terrain"});case k.CRITICAL_STRIKE:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Critical Strike"});case k.ROOT:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Root"});case k.CURE_POISON:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Cure Poison"});default:{const t=e;throw new Error(`Unknown effect type: ${t}`)}}},Ow=({unit:e,squads:t,handleRemoveUnit:n,handleRemoveUnitFromSquad:s,handleAddUnitToSquad:i,isAdminMode:r})=>{const o=sn(e),l=H(e.unitType),c=Ve(e.attacks);return a.jsx("div",{className:"card inset-shadow-sm shadow-xl",children:a.jsx("div",{className:"card-body p-4",children:a.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("div",{className:"w-20 h-20 mx-auto lg:mx-0",children:a.jsx("img",{src:l.headshotImage,alt:e.name,className:"w-full h-full object-contain rounded-lg border border-base-300"})})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h5",{className:"font-semibold text-lg text-primary mb-1",children:e.name}),a.jsx("p",{className:"text-sm text-base-content/70 capitalize",children:l.name})]}),a.jsxs("div",{className:"flex flex-col w-16",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Level"}),a.jsx("span",{className:"font-semibold text-lg",children:e.level})]}),a.jsxs("div",{className:"flex flex-col w-16",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Health"}),a.jsx("span",{className:"font-semibold text-lg text-success",children:e.maxHealth})]}),a.jsxs("div",{className:"flex flex-col w-16",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Attack"}),a.jsx("span",{className:"font-semibold text-lg text-error",children:e.attack})]}),a.jsxs("div",{className:"flex flex-col w-16",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Defense"}),a.jsx("span",{className:"font-semibold text-lg text-info",children:e.defense})]}),a.jsxs("div",{className:"flex flex-col w-16",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Cost"}),a.jsx("span",{className:"font-semibold text-lg text-accent",children:at(e)})]})]}),o&&a.jsx("div",{className:"mb-4 space-y-3",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{className:"flex-1 space-y-2",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase",children:"Experience"}),a.jsxs("span",{className:"font-semibold",children:[o.experience,"/",o.experienceToNextLevel]})]}),a.jsx("progress",{className:"progress w-full progress-primary",value:o.experience,max:o.experienceToNextLevel})]}),a.jsxs("div",{className:"flex flex-col w-34",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Available Points"}),a.jsx("span",{className:"font-semibold text-lg text-warning",children:e.availablePoints})]})]})}),a.jsxs("div",{className:"mb-4",children:[a.jsx("h6",{className:"font-medium text-sm mb-2 text-base-content/90",children:"Attacks"}),a.jsx("div",{className:"space-y-2",children:c.map(d=>a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between p-2 rounded inset-shadow-sm bg-black/5",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"font-medium text-xs text-primary mb-1",children:d.name}),a.jsx("p",{className:"text-xs text-base-content/70 mb-1",children:d.description})]}),a.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[d.power[0]>0&&a.jsxs("div",{className:"badge badge-outline badge-xs",children:["Power: ",d.power[0],"d",d.power[1]]}),Object.entries(d.pattern.meta).map(([m,u])=>a.jsx("span",{className:"badge badge-outline badge-xs",children:typeof u=="boolean"?m:`${m}: ${u}`},m)),d.effects.map((m,u)=>a.jsx(Mw,{effect:m},`effect-${u}`))]})]},d.id))})]}),t.length>0&&a.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.map(d=>a.jsx(Ps.Fragment,{children:d.unitIds.includes(e.id)?a.jsxs("button",{className:"btn btn-info btn-sm",onClick:()=>s(e.id,d.id),children:[a.jsx(qw,{className:"size-4"}),d.name]}):a.jsxs("button",{className:"btn btn-outline btn-info btn-sm",onClick:()=>i(e.id,d.id),children:[a.jsx(Lw,{className:"size-4"}),d.name]})},d.id)),r&&a.jsx("button",{className:"btn btn-outline btn-error btn-sm",onClick:()=>n(e.id),children:"Remove from army"})]})]})]})})})},Rw=({unit:e,isAdminMode:t})=>{const n=sn(e),s=H(e.unitType),i=q(e)?He(e.trainerId):null;return a.jsx("div",{className:"card card-bg-paper shadow-xl",children:a.jsx("div",{className:"card-body",children:a.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("div",{className:"w-20 h-20 mx-auto lg:mx-0",children:a.jsx("img",{src:i?i.headshotImage:s.headshotImage,alt:e.name,className:"w-full h-full object-contain rounded-lg border border-base-300"})})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-4",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h5",{className:"font-semibold text-lg text-primary mb-1",children:e.name}),a.jsx("p",{className:"text-sm text-base-content/70 capitalize",children:s.name})]}),a.jsxs("div",{className:"flex flex-col w-16",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Level"}),a.jsx("span",{className:"font-semibold text-lg",children:e.level})]}),a.jsxs("div",{className:"flex flex-col w-16",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Health"}),a.jsx("span",{className:"font-semibold text-lg text-success",children:e.maxHealth})]}),a.jsxs("div",{className:"flex flex-col w-16",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Defense"}),a.jsx("span",{className:"font-semibold text-lg text-info",children:e.defense})]})]}),n&&a.jsx("div",{className:"mb-4 space-y-3",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{className:"flex-1 space-y-2",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase",children:"Experience"}),a.jsxs("span",{className:"font-semibold",children:[n.experience,"/",n.experienceToNextLevel]})]}),a.jsx("progress",{className:"progress w-full progress-primary",value:n.experience,max:n.experienceToNextLevel})]}),a.jsxs("div",{className:"flex flex-col w-34",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Available Points"}),a.jsx("span",{className:"font-semibold text-lg text-warning",children:e.availablePoints})]})]})})]})]})})})},Fw=""+new URL("army-management-Dp64uZk7.png",import.meta.url).href,Dw=()=>{const{startOverworld:t}=qe(),n=ma(1),s=Dn(1),i=()=>new URLSearchParams(window.location.search).has("admin"),{addUnitToArmy:r,removeUnitFromArmy:o,createSquad:l,deleteSquad:c,addUnitToSquad:d,removeUnitFromSquad:m,renameSquad:u}=rn(),[h,y]=p.useState(""),[x,f]=p.useState(null),[v,w]=p.useState(""),[g,j]=p.useState(""),[N,T]=p.useState(1),[$,P]=p.useState(null),b=()=>{g&&(r(1,g,N),j(""))},_=C=>{o(1,C)},D=()=>{h.trim()&&(l(1,h.trim()),y(""))},E=C=>{c(1,C)},B=(C,we)=>{d(1,C,we)},pe=(C,we)=>{m(1,C,we)},ft=C=>{f(C.id),w(C.name)},S=()=>{x&&v.trim()&&(u(1,x,v.trim()),f(null),w(""))},A=()=>{f(null),w("")},se=s.filter(C=>C.unitType!=="trainer"),W=s.find(C=>C.unitType==="trainer"),M=$?n.find(C=>C.id===$):null,G=M?s.filter(C=>M.unitIds.includes(C.id)):se;return W?a.jsxs("div",{className:"flex h-full min-h-screen bg-cover bg-center bg-no-repeat bg-fixed",style:{backgroundImage:`url(${Fw})`},children:[a.jsxs("div",{className:"w-96 p-4 space-y-6",children:[a.jsx("div",{className:"card card-bg-paper shadow-xl",children:a.jsx("div",{className:"card-body",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("h4",{className:"font-bold text-lg",children:"Team Overview"}),a.jsx("p",{className:"text-sm text-base-content/70",children:"Manage your units and squads"})]}),a.jsxs("div",{className:"stats stats-horizontal w-full",children:[a.jsxs("div",{className:"stat",children:[a.jsx("div",{className:"stat-title",children:"Total Units"}),a.jsx("div",{className:"stat-value text-primary",children:s.length-1})]}),a.jsxs("div",{className:"stat",children:[a.jsx("div",{className:"stat-title",children:"Squads"}),a.jsx("div",{className:"stat-value text-secondary",children:n.length})]})]})]})})}),a.jsx("div",{className:"card card-bg-paper shadow-xl",children:a.jsx("div",{className:"card-body",children:a.jsx("button",{className:"btn btn-block btn-neutral btn-outline",onClick:t,children:"Return to Overworld"})})}),i()&&a.jsx("div",{className:"card shadow-xl bg-base-100",children:a.jsxs("div",{className:"card-body",children:[a.jsx("h3",{className:"card-title text-lg mb-4",children:"➕ Add New Unit"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"join w-full",children:[a.jsxs("select",{className:"select select-bordered join-item flex-1",value:g,onChange:C=>j(C.target.value),children:[a.jsx("option",{value:"",children:"Select unit type"}),Rd().map(C=>a.jsx("option",{value:C,children:C},C))]}),a.jsx("input",{type:"number",placeholder:"Level",min:"1",className:"input input-bordered join-item w-24",value:N,onChange:C=>T(Math.max(1,parseInt(C.target.value)||1)),onKeyDown:C=>C.key==="Enter"&&b()})]}),a.jsx("button",{className:"btn btn-primary w-full",onClick:b,disabled:!g.trim(),children:"Add Unit"})]})]})})]}),a.jsx("div",{className:"flex-1 p-4",children:a.jsxs("div",{className:"h-full space-y-6",children:[a.jsx(Rw,{unit:W,isAdminMode:i()}),a.jsx($w,{units:s,squads:n,selectedSquadId:$,setSelectedSquadId:P,newSquadName:h,setNewSquadName:y,handleCreateSquad:D,editingSquadId:x,editingSquadName:v,setEditingSquadName:w,handleSaveSquadName:S,handleCancelEditSquad:A,handleStartEditSquad:ft,handleDeleteSquad:E,handleRemoveUnitFromSquad:pe}),a.jsx("div",{className:"card card-bg-paper shadow-xl",children:a.jsx("div",{className:"card-body space-y-4",children:G.length===0?a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"text-4xl mb-2",children:"✅"}),a.jsx("p",{className:"text-base-content/70",children:M?"No units in this squad":"No units to assign"})]}):a.jsx(a.Fragment,{children:G.map(C=>a.jsx(Ow,{unit:C,squads:n,handleAddUnitToSquad:B,handleRemoveUnit:_,handleRemoveUnitFromSquad:pe,isAdminMode:i()},C.id))})})})]})})]}):null},Bw=ce([e=>e.battle.currentPlayerId,e=>e.battle.players],(e,t)=>{const n=t.find(s=>s.id===e);if(!n)throw new Error("Player not found");return n}),Ww=ce([e=>e.battle.currentPlayerId,e=>e.battle.players],(e,t)=>t.find(s=>s.id===e)?.units||[]),Gw=ce([e=>e.battle.units],e=>Object.values(e)),Hw=ce([e=>e.battle.units,(e,t)=>t],(e,t)=>Object.values(e).filter(n=>n.playerId===t)),Vw=ce([e=>e.battle.map,e=>e.battle.currentPlayerId,e=>e.battle.units],(e,t,n)=>_m(e,n,t)),Yw=ce([e=>e.battle.units,(e,t)=>t],(e,t)=>Object.values(e).find(n=>n.playerId===t&&n.unitType==="trainer")),z=()=>ee(e=>e.battle),Ke=()=>ee(e=>e.battle.selectedUnit?e.battle.units[e.battle.selectedUnit]:null),Kw=e=>ee(t=>t.battle.units[e]),pa=()=>ee(Gw),$n=e=>ee(t=>Hw(t,e)),zw=()=>ee(Bw),Jw=()=>ee(Ww),Qw=()=>ee(Vw),ga=e=>ee(t=>Yw(t,e)),fe=()=>{const e=ct();return{placeUnit:(t,n)=>e(L.placeUnit({armyUnit:t,position:n})),removePlacedUnit:t=>e(L.removePlacedUnit(t)),finishUnitPlacement:()=>e(L.finishUnitPlacement()),setPlacementMode:t=>e(L.setPlacementMode(t)),deselectUnit:()=>e(L.deselectUnit()),startMovement:t=>e(L.startMovement({unitId:t})),startAttacking:(t,n)=>e(L.startAttacking({unitId:t,attackId:n})),startCapture:t=>e(L.startCapture({unitId:t})),startSummoning:t=>e(L.startSummoning({unitId:t})),selectSummonUnit:t=>e(L.selectSummonUnit({unitId:t})),startUsingItem:(t,n)=>e(L.startUsingItem({unitId:t,itemId:n})),inspectUnit:t=>e(L.inspectUnit({unitId:t})),moveUnit:(t,n)=>e(L.moveUnit({unitId:t,newPosition:n})),setAIPlayer:t=>e(L.setAIPlayer(t)),addChatMessage:t=>e(L.addChatMessage(t))}},Xw=[{id:"welcome",sender:"Wildlight Guide",content:"Welcome to your first battle! I'll guide you through the basics of tactical combat.",delay:500},{id:"unit-selection",sender:"Wildlight Guide",content:"Click on your units to select them. You can move, attack, or capture with different units.",delay:2e3},{id:"movement",sender:"Wildlight Guide",content:"When you select a unit, you can move it by clicking on a highlighted tile. Units can only move once per turn.",delay:3e3},{id:"attacking",sender:"Wildlight Guide",content:"To attack, click on a unit, then select an attack in the attack panel. Highlighting tiles will show you the range of the attack. Each unit has different attack patterns.",delay:4e3},{id:"trainers",sender:"Wildlight Guide",content:"Your Character can capture enemy units by getting close to them. This is often the key to victory!",delay:5e3},{id:"turn-management",sender:"Wildlight Guide",content:"Use the 'End Turn' button when you're done with all your actions. The AI will then take their turn.",delay:6e3},{id:"victory",sender:"Wildlight Guide",content:"Win by defeating the enemy Trainer or capturing all their units. Good luck, trainer!",delay:7e3}],Zw=()=>{const{battleHistory:e}=Te(),{gamePhase:t,chatMessages:n}=z(),{addChatMessage:s}=fe(),i=p.useRef(!1),r=e.length===0,o=t===be.SELECTION,l=p.useCallback(()=>{Xw.forEach((c,d)=>{setTimeout(()=>{s({sender:c.sender,content:c.content})},c.delay||0)})},[s]);return p.useEffect(()=>{if(!r||!o||i.current)return;if(n.some(d=>d.sender==="Wildlight Guide"&&d.content.includes("Welcome to your first battle"))){i.current=!0;return}i.current=!0,l()},[r,o,n,s,l]),{replayTutorial:l}},Ge=300,ek=(e,t,n,s)=>{let i="";switch(e.damageType){case"poison":i=`${n} takes ${s} poison damage!`;break;case"burn":i=`${n} takes ${s} burn damage!`;break;case"bleed":i=`${n} takes ${s} bleed damage!`;break;case"attack":{const{isCritical:r,affinityMultiplier:o,attackId:l}=e,c=Ue(l);i=`${t} attacks ${n} for ${s} damage with ${c.name}`,r&&(i+=" - Critical hit!"),o>=3?i+=" - Super effective!":o>=2?i+=" - Effective!":o===0?i+=" - Has no effect!":o<=.25?i+=" - Barely effective!":o<=.5&&(i+=" - Partially effective!"),i+="!";break}default:{const r=e;throw new Error(`Unknown damage type: ${r}`)}}return i},tk=(e,t,n)=>{switch(e.type){case k.APPLY_MODIFIER:{const s=e.modifierType,i=e.value,r=e.duration;if(s===U.ATTACK_MULTIPLIER){const o=r===null?"permanently":`for ${r} turns`;return`${n}'s attack power is ${i>1?"increased":"decreased"} by ${Math.abs(i-1)*100}% ${o}!`}else if(s===U.DEFENSE_MULTIPLIER){const o=r===null?"permanently":`for ${r} turns`;return`${n}'s defense is ${i>1?"increased":"decreased"} by ${Math.abs(i-1)*100}% ${o}!`}return`${t} applies a modifier to ${n}!`}case k.HEAL:return`${n} is healed for ${e.value} health!`;case k.PUSH:return`${n} is pushed ${e.distance} spaces!`;case k.POISON:return`${n} is poisoned for ${e.duration} turns!`;case k.STUN:return`${n} is stunned for ${e.duration} turns!`;case k.SLEEP:return`${n} falls asleep for ${e.duration} turns!`;case k.BURN:return`${n} is burned and will take ${e.damage} damage per turn for ${e.duration} turns!`;case k.BLEED:return`${n} is bleeding and will take ${e.damage} damage per turn for ${e.duration} turns!`;case k.SHIELD:return`${n} gains a shield absorbing ${e.amount} damage for ${e.duration} turns!`;case k.REFLECT:return`${n} gains ${e.percentage}% damage reflection for ${e.duration} turns!`;case k.TELEPORT:return`${n} teleports to a new location!`;case k.ROOT:return`${n} is rooted in place for ${e.duration} turns!`;case k.HASTE:return`${n} gains +${e.bonusRange} movement range for ${e.duration} turns!`;case k.DRAIN:return`${n} is drained of ${e.amount} energy for ${e.duration} turns!`;case k.CREATE_TERRAIN:return`${t} creates ${e.terrainType} terrain!`;case k.CRITICAL_STRIKE:return`${t} gains ${e.multiplier}x critical strike chance!`;case k.ARMOR_PIERCE:return`${t} gains ${e.percentage}% armor piercing!`;case k.CURE_POISON:return`${n} is cured of poison!`;default:{const s=e;throw new Error(`Unknown effect type: ${s}`)}}},nk=()=>{const{units:e}=z(),{addChatMessage:t}=fe();Ye("battle/applyDamage",n=>{const{targetId:s,attackerId:i,meta:r,damage:o}=n.payload;if(!r)return;const l=e[s],c=i?e[i]:null;if(!l)return;const d=l.name||l.unitType,m=c?c.name||c.unitType:"Unknown",u=ek(r,m,d,o);setTimeout(()=>{t({sender:"Wildlight Guide",content:u})},Ge)})},sk=()=>{const{units:e}=z(),{addChatMessage:t}=fe();Ye("battle/applyEffect",n=>{const{targetId:s,attackerId:i,effect:r}=n.payload,o=e[s],l=e[i];if(!o)return;const c=o.name||o.unitType,d=l?l.name||l.unitType:"Unknown",m=tk(r,d,c);setTimeout(()=>{t({sender:"Wildlight Guide",content:m})},Ge)})},ak=()=>{const{players:e}=z(),{addChatMessage:t}=fe();Ye("battle/endTurnInternal",n=>{const{newPlayerId:s}=n.payload,i=e.find(o=>o.id===s);if(!i)return;const r=`${i.name} begins their turn.`;setTimeout(()=>{t({sender:"Wildlight Guide",content:r})},Ge)})},ik=e=>{const{addChatMessage:t}=fe(),{playerName:n}=Te();Ye("battle/addChatMessage",s=>{const{sender:i,content:r}=s.payload;if(i!==n)return;const o=r.toLowerCase();if(o==="help"){setTimeout(()=>{t({sender:"Wildlight Guide",content:`Here are the commands I understand:

• help - Show this list of commands
• tutorial - Replay the battle tutorial

Type any of these commands to get started!`})},Ge);return}if(o==="tutorial"){setTimeout(()=>{t({sender:"Wildlight Guide",content:"Of course! Let me walk you through the battle basics again."}),e()},Ge);return}setTimeout(()=>{t({sender:"Wildlight Guide",content:"I don't understand that command. Type 'help' to see a list of valid commands I can help you with!"})},Ge)})},rk=()=>{const{addChatMessage:e}=fe(),{units:t}=z(),n=ga(2),s=n?He(n.trainerId):null;Ye("battle/applyDamage",i=>{const{attackerId:r}=i.payload;if((r?t[r]:null)?.playerId!==1||!s||!n||Math.random()>.2)return;const l=Math.floor(Math.random()*s.battleQuotes.length),c=s.battleQuotes[l];setTimeout(()=>{e({sender:n.name,content:c})},Ge)})},ok=()=>{const[e,t]=p.useState(""),n=p.useRef(null),{chatMessages:s,selectedUnit:i,currentPlayerId:r}=z(),{addChatMessage:o}=fe(),{playerName:l}=Te(),c=r===2||!i,{replayTutorial:d}=Zw();nk(),sk(),ak(),ik(d),rk(),p.useEffect(()=>{n.current&&c&&n.current.scrollTo({top:n.current.scrollHeight,behavior:n.current.scrollTop>0?"smooth":"instant"})},[s,c]);const m=y=>{y.preventDefault();const x=e.trim();x&&(o({sender:l||"Player",content:x}),t(""))},u=y=>{t(y.target.value)},h=y=>{y.stopPropagation(),y.key==="Escape"&&document.getElementById("chat-input")?.blur()};return c?a.jsx("div",{className:"card card-bg-paper shadow-xl m-4",children:a.jsxs("div",{className:"card-body p-4 h-[calc(100vh-200px))]",children:[a.jsx("div",{ref:n,className:"overflow-y-auto mb-4 h-full ",children:a.jsx("div",{className:"flex flex-col gap-4 justify-end min-h-full",children:s.map(y=>a.jsxs("div",{className:`chat ${y.sender===l||y.sender==="Player"?"chat-end":"chat-start"}`,children:[a.jsx("div",{className:"chat-header",children:y.sender}),a.jsx("div",{className:`chat-bubble ${y.sender===l||y.sender==="Player"?"chat-bubble-primary":""}`,children:y.content})]},y.id))})}),a.jsx("form",{onSubmit:m,className:"mt-auto",children:a.jsxs("div",{className:"flex w-full gap-2",children:[a.jsx("input",{type:"text",placeholder:"Type your message...",className:"input input-bordered w-full",value:e,onChange:u,onKeyDown:h,maxLength:200,id:"chat-input"}),a.jsx("button",{type:"submit",className:"btn btn-primary",disabled:!e.trim(),children:"Send"})]})})]})}):null},lk=({svgRef:e,handleWheel:t,disabled:n=!1})=>{p.useEffect(()=>{const s=e.current;if(s&&!n)return s.addEventListener("wheel",t,{passive:!1}),()=>{s.removeEventListener("wheel",t)}},[t,e,n])},ck=(e,{originalOffset:t,originalZoomLevel:n,minZoom:s=.1,maxZoom:i=5,size:r="cover"})=>{const o=p.useRef(null),l=p.useRef(null),[c,d]=p.useState({width:1,height:1,left:0,top:0}),m=e.width/c.width,u=e.height/c.height,h=r==="cover"?Math.min(m,u):Math.max(m,u),y=p.useMemo(()=>({x:e.width/2,y:e.height/2}),[e]),x=p.useMemo(()=>({x:c.width*h/2,y:c.height*h/2}),[c,h]),f=p.useMemo(()=>t||(r==="cover"?y:x),[t,r,y,x]),v=n,[w,g]=p.useState(!1),[j,N]=p.useState({x:0,y:0,clientX:0,clientY:0}),[T,$]=p.useState(!1),[P,b]=p.useState(!1),[_,D]=p.useState(f),[E,B]=p.useState(v),pe=p.useCallback((R,ae,ie)=>{let ke,ge,Me,Oe;switch(r){case"cover":ke=c.width*h-ie*ae.width/2,ge=c.height*h-ie*ae.height/2,Me=ae.width/2*ie,Oe=ae.height/2*ie;break;case"contain":ke=ie*ae.width/2,ge=ie*ae.height/2,Me=c.width*h-ie*ae.width/2,Oe=c.height*h-ie*ae.height/2;break;default:throw new Error(`Invalid size: ${r}`)}[ke,Me]=[ke,Me].sort((pt,gt)=>pt-gt),[ge,Oe]=[ge,Oe].sort((pt,gt)=>pt-gt);const yn=Math.max(ke,Math.min(Me,R.x)),bn=Math.max(ge,Math.min(Oe,R.y));return{x:yn,y:bn}},[h,c,r]),ft=p.useCallback(R=>{const ae=e.width/2-R.x*E,ie=e.height/2-R.y*E;D(pe({x:ae,y:ie},e,E))},[e,E,pe]),S=p.useCallback(()=>{if(l.current){const R=l.current.getBoundingClientRect();d(R),b(!0)}else setTimeout(S,0)},[]);p.useEffect(()=>(S(),window.addEventListener("resize",S),()=>{window.removeEventListener("resize",S)}),[S]);const A=p.useCallback(R=>{R.preventDefault();const ke=1+(R.deltaY>0?-1:1)*.03,ge=Math.max(s,Math.min(i,E*ke));if(ge!==E){const Me=(R.clientX-c.left)*h,Oe=(R.clientY-c.top)*h,yn=(Me-_.x)/E,bn=(Oe-_.y)/E,pt=_.x+yn*(E-ge),gt=_.y+bn*(E-ge);B(ge),D(pe({x:pt,y:gt},e,ge))}},[E,_,e,s,i,c,h,pe]),se=p.useCallback(R=>{if(R.button===0){const ae=(R.clientX-c.left)*h-_.x,ie=(R.clientY-c.top)*h-_.y;$(!1),g(!0),N({x:ae,y:ie,clientX:R.clientX,clientY:R.clientY})}},[h,c,_]),W=p.useCallback(R=>{if(w){const ae=(R.clientX-c.left)*h-j.x,ie=(R.clientY-c.top)*h-j.y,ke=Math.abs(j.clientX-R.clientX)+Math.abs(j.clientY-R.clientY);D(pe({x:ae,y:ie},e,E)),ke>10&&$(!0)}},[w,j,e,E,pe,h,c]),M=p.useCallback(R=>{g(!1)},[]),G=p.useCallback(()=>{g(!1)},[]),C=p.useCallback(()=>{D(f),B(v)},[f,v]),we=p.useCallback(()=>{const R=Math.min(i,E*1.2);R!==E&&B(R)},[E,i]),Pe=p.useCallback(()=>{const R=Math.max(s,E/1.2);R!==E&&B(R)},[E,s]);p.useEffect(()=>{P&&C()},[P,C]);const ti=c.width,ni=c.height,si=h*c.width/E,ai=h*c.height/E,ii=-_.x/E,ri=-_.y/E;return{disableClick:T,isDragging:w,svgRef:o,containerRef:l,svgWidth:ti,svgHeight:ni,viewBoxX:ii,viewBoxY:ri,viewBoxWidth:si,viewBoxHeight:ai,handleWheel:A,handleMouseDown:se,handleMouseMove:W,handleMouseUp:M,handleMouseLeave:G,panTo:ft,resetView:C,zoomIn:we,zoomOut:Pe}},dk=({tile:e,unit:t,points:n,onTileClick:s,onTileHover:i,onTileLeave:r})=>{const o=s?l=>{s(e,t,l)}:void 0;return a.jsx("polygon",{points:n,fill:"transparent",onClick:o,onMouseEnter:()=>{i(e,t)},onMouseLeave:r,className:"cursor-pointer"})},uk=({tile:e,center:t})=>{const{position:n}=e;return a.jsxs("text",{x:t.x,y:t.y,fill:"#333",fontSize:"12",textAnchor:"middle",dominantBaseline:"middle",children:[n.q,", ",n.r]})},ya=({points:e,variant:t="default"})=>a.jsx("polygon",{points:e,stroke:`var(--border-${t})`,strokeWidth:"2",fill:"none"}),Ce=({points:e,variant:t,isHovered:n=!1})=>{const s=`highlight-${t}`,i=n?"0.8":"0.6";return a.jsxs("g",{children:[a.jsx(ya,{variant:t,points:e}),a.jsx("polygon",{points:e,fill:`url(#${s})`,opacity:i})]})},mk=""+new URL("forest-6YRjAE2u.png",import.meta.url).href,hk=""+new URL("grass-CQSe_z-b.png",import.meta.url).href,fk=""+new URL("mountain-B8jQAaM6.png",import.meta.url).href,pk=""+new URL("water-BeJlSNpC.png",import.meta.url).href,gk=({tile:e,points:t,size:n,center:s})=>{const{position:i,terrain:r}=e,o={[oe.GRASS]:hk,[oe.WATER]:pk,[oe.MOUNTAIN]:fk,[oe.FOREST]:mk},l=()=>({[oe.GRASS]:"#90EE90",[oe.WATER]:"#87CEEB",[oe.MOUNTAIN]:"#8B7355",[oe.FOREST]:"#228B22"})[r];return a.jsxs("g",{children:[a.jsx("defs",{children:a.jsx("clipPath",{id:`hexClip-${i.q}-${i.r}`,children:a.jsx("polygon",{points:t})})}),a.jsx("polygon",{points:t,fill:l()}),a.jsx("image",{href:o[r],x:s.x-n,y:s.y-n,width:n*2,height:n*2,clipPath:`url(#hexClip-${i.q}-${i.r})`})]})},yk=""+new URL("enemy-BkN9Tsj6.png",import.meta.url).href,bk=""+new URL("friend-DDnDxBtR.png",import.meta.url).href,xk=({unitId:e,center:t,size:n,isFlashing:s=!1,isBeingCaptured:i=!1,damageNumber:r})=>{const o=Kw(e),l=p.useRef(null),c=H(o.unitType),d=q(o)?He(o.trainerId):null;return o?a.jsxs("g",{ref:l,className:"unit-renderer-group",children:[a.jsx("image",{x:t.x-n*.5,y:t.y-n*.6,width:n,height:n,href:d?d.battleIconImage:c.battleIconImage,className:`${i?"animate-capture":""} ${s?"animate-flash":""}`}),a.jsx("rect",{x:t.x-n*.2,y:t.y+n*.5,width:n*.6,height:n*.1,fill:"#333",rx:2}),a.jsx("rect",{x:t.x-n*.2,y:t.y+n*.5,width:n*.6*(o.health/o.maxHealth),height:n*.1,fill:"#FF0000",rx:2}),a.jsx("image",{x:t.x-n*.45,y:t.y+n*.42,width:n*.25,height:n*.25,href:o.playerId===1?bk:yk}),r&&a.jsxs("text",{x:t.x,y:t.y-n*.9,textAnchor:"middle",fontSize:n*.4,fill:"#FFFFFF",fontWeight:"bold",className:"animate-damage-float",children:["-",r]})]}):null},vk=(e,t)=>{const{x:n,y:s}=ba(e,t);return[`${n+t*.866},${s+t*.5}`,`${n+t*.866},${s-t*.5}`,`${n},${s-t}`,`${n-t*.866},${s-t*.5}`,`${n-t*.866},${s+t*.5}`,`${n},${s+t}`].join(" ")},ba=(e,t)=>{const{position:n}=e,s=n.q+(n.r-(n.r&1))/2,i=n.r,r=t*(Math.sqrt(3)*s+Math.sqrt(3)/2*(i&1)),o=t*(3/2*i);return{x:r,y:o}},xa=({hexSize:e,onTileClick:t,onTileHover:n,onTileLeave:s,isMovementTarget:i,isInDamagePreview:r,isAttackTarget:o,isCaptureTarget:l,isSummonTarget:c,isItemTarget:d,isHovered:m,disableCameraControls:u=!1,getUnitEffects:h,debug:y=!1})=>{const{map:x,radius:f,currentPlayerId:v}=z(),w=pa(),g=Ke(),j=p.useMemo(()=>{const b=(f*2+1)*e*.866*2,_=e*3*f+e*2;return{width:b,height:_}},[f,e]),N=ck(j,{originalZoomLevel:.9,minZoom:.9,maxZoom:3,size:"contain"}),$=x.flat().filter(b=>b).map(b=>({tile:b,points:vk(b,e),center:ba(b,e),unit:w.find(_=>_.id===b.unitId),...h(b.unitId)})),P=u?void 0:{cursor:N.isDragging?"grabbing":"grab"};return lk({svgRef:N.svgRef,handleWheel:N.handleWheel,disabled:u}),a.jsx("div",{ref:N.containerRef,className:"w-full h-full",children:a.jsxs("svg",{ref:N.svgRef,width:N.svgWidth,height:N.svgHeight,viewBox:`${N.viewBoxX} ${N.viewBoxY} ${N.viewBoxWidth} ${N.viewBoxHeight}`,onMouseDown:u?void 0:N.handleMouseDown,onMouseMove:u?void 0:N.handleMouseMove,onMouseUp:u?void 0:N.handleMouseUp,onMouseLeave:u?void 0:N.handleMouseLeave,onDoubleClick:u?void 0:N.resetView,style:P,children:[a.jsxs("defs",{children:[a.jsxs("radialGradient",{id:"highlight-selected",cx:"50%",cy:"50%",r:"50%",children:[a.jsx("stop",{offset:"0%",stopColor:"#E0E0FF",stopOpacity:"0.2"}),a.jsx("stop",{offset:"100%",stopColor:"#E0E0FF",stopOpacity:"1.0"})]}),a.jsxs("radialGradient",{id:"highlight-movement",cx:"50%",cy:"50%",r:"50%",children:[a.jsx("stop",{offset:"0%",stopColor:"#FFFFE0",stopOpacity:"0.2"}),a.jsx("stop",{offset:"100%",stopColor:"#FFFFE0",stopOpacity:"1.0"})]}),a.jsxs("radialGradient",{id:"highlight-attack",cx:"50%",cy:"50%",r:"50%",children:[a.jsx("stop",{offset:"0%",stopColor:"#FF8C00",stopOpacity:"0.2"}),a.jsx("stop",{offset:"100%",stopColor:"#FF8C00",stopOpacity:"1.0"})]}),a.jsxs("radialGradient",{id:"highlight-capture",cx:"50%",cy:"50%",r:"50%",children:[a.jsx("stop",{offset:"0%",stopColor:"#9370DB",stopOpacity:"0.2"}),a.jsx("stop",{offset:"100%",stopColor:"#9370DB",stopOpacity:"1.0"})]}),a.jsxs("radialGradient",{id:"highlight-summon",cx:"50%",cy:"50%",r:"50%",children:[a.jsx("stop",{offset:"0%",stopColor:"#7350BB",stopOpacity:"0.2"}),a.jsx("stop",{offset:"100%",stopColor:"#7350BB",stopOpacity:"1.0"})]}),a.jsxs("radialGradient",{id:"highlight-item",cx:"50%",cy:"50%",r:"50%",children:[a.jsx("stop",{offset:"0%",stopColor:"var(--border-item)",stopOpacity:"0.2"}),a.jsx("stop",{offset:"100%",stopColor:"var(--border-item)",stopOpacity:"1.0"})]}),a.jsxs("radialGradient",{id:"highlight-damage",cx:"50%",cy:"50%",r:"50%",children:[a.jsx("stop",{offset:"0%",stopColor:"#FF6B6B",stopOpacity:"0.2"}),a.jsx("stop",{offset:"100%",stopColor:"#FF6B6B",stopOpacity:"1.0"})]}),a.jsxs("radialGradient",{id:"highlight-friendly",cx:"50%",cy:"50%",r:"50%",children:[a.jsx("stop",{offset:"0%",stopColor:"#6BFF6B",stopOpacity:"1.0"}),a.jsx("stop",{offset:"100%",stopColor:"#6BFF6B",stopOpacity:"0.2"})]}),a.jsxs("radialGradient",{id:"highlight-enemy",cx:"50%",cy:"50%",r:"50%",children:[a.jsx("stop",{offset:"0%",stopColor:"#FF0000",stopOpacity:"1.0"}),a.jsx("stop",{offset:"100%",stopColor:"#FF0000",stopOpacity:"0.2"})]}),a.jsx("filter",{id:"unitNameGlow",children:a.jsx("feDropShadow",{dx:"0",dy:"0",floodColor:"#FFF",stdDeviation:"2"})})]}),$.map(({tile:b,points:_,center:D})=>a.jsx(gk,{tile:b,points:_,size:e,center:D},`terrain-${b.position.q}-${b.position.r}`)),$.map(({tile:b,points:_})=>a.jsx(ya,{points:_},`border-${b.position.q}-${b.position.r}`)),$.filter(({unit:b})=>b).map(({unit:b,points:_,tile:D})=>a.jsx(Ce,{points:_,variant:b.playerId===v?"friendly":"enemy",isHovered:m(D.position.q,D.position.r)},`highlight-team-${b.id}`)),$.filter(({tile:b})=>g&&g.id===b.unitId).map(({tile:b,points:_})=>a.jsx(Ce,{points:_,variant:"selected",isHovered:m(b.position.q,b.position.r)},`selected-${b.position.q}-${b.position.r}`)),$.filter(({tile:b})=>i(b.position.q,b.position.r)).map(({tile:b,points:_})=>a.jsx(Ce,{points:_,variant:"movement",isHovered:m(b.position.q,b.position.r)},`movement-${b.position.q}-${b.position.r}`)),$.filter(({tile:b})=>o(b.position.q,b.position.r)).map(({tile:b,points:_})=>a.jsx(Ce,{points:_,variant:"attack",isHovered:m(b.position.q,b.position.r)},`attack-${b.position.q}-${b.position.r}`)),$.filter(({tile:b})=>l(b.position.q,b.position.r)).map(({tile:b,points:_})=>a.jsx(Ce,{points:_,variant:"capture",isHovered:m(b.position.q,b.position.r)},`capture-${b.position.q}-${b.position.r}`)),$.filter(({tile:b})=>c(b.position.q,b.position.r)).map(({tile:b,points:_})=>a.jsx(Ce,{points:_,variant:"summon",isHovered:m(b.position.q,b.position.r)},`summon-${b.position.q}-${b.position.r}`)),$.filter(({tile:b})=>d(b.position.q,b.position.r)).map(({tile:b,points:_})=>a.jsx(Ce,{points:_,variant:"item",isHovered:m(b.position.q,b.position.r)},`item-${b.position.q}-${b.position.r}`)),$.filter(({tile:b})=>r(b.position.q,b.position.r)).map(({tile:b,points:_})=>a.jsx(Ce,{points:_,variant:"damage",isHovered:m(b.position.q,b.position.r)},`damage-${b.position.q}-${b.position.r}`)),y&&$.map(({tile:b,center:_})=>a.jsx(uk,{tile:b,center:_},`coords-${b.position.q}-${b.position.r}`)),$.filter(({unit:b})=>b).sort((b,_)=>b.unit.id>_.unit.id?1:-1).map(({unit:b,center:_,isFlashing:D,isBeingCaptured:E,damageNumber:B})=>a.jsx(xk,{unitId:b.id,center:_,size:e,isFlashing:D,isBeingCaptured:E,damageNumber:B},`unit-${b.id}`)),$.map(({tile:b,points:_,unit:D})=>a.jsx(dk,{tile:b,unit:D,points:_,onTileClick:N.disableClick?void 0:t,onTileHover:n,onTileLeave:s},`terrain-${b.position.q}-${b.position.r}`))]})})},wk=()=>{const[e,t]=p.useState(new Map),n=p.useCallback((o,l)=>{const c=`${o}-damage-${Date.now()}`;t(d=>new Map(d).set(c,{id:c,type:"damage",unitId:o,damage:l,duration:1500,startTime:Date.now()}))},[]),s=p.useCallback(o=>{const l=`${o}-flash-${Date.now()}`;t(c=>new Map(c).set(l,{id:l,type:"flash",unitId:o,duration:300,startTime:Date.now()}))},[]),i=p.useCallback(o=>{const l=`${o}-capture-${Date.now()}`;t(c=>new Map(c).set(l,{id:l,type:"capture",unitId:o,duration:2e3,startTime:Date.now()}))},[]);p.useEffect(()=>{const o=setInterval(()=>{const l=Date.now();t(c=>{const d=new Map(c);for(const[m,u]of d)l-u.startTime>u.duration&&d.delete(m);return d})},100);return()=>clearInterval(o)},[]);const r=p.useCallback(o=>{const l={isFlashing:!1,isBeingCaptured:!1,damageNumber:void 0};if(!o)return l;for(const c of e.values())c.unitId===o&&(c.type==="flash"?l.isFlashing=!0:c.type==="damage"&&c.damage!==void 0?l.damageNumber=c.damage:c.type==="capture"&&(l.isBeingCaptured=!0));return l},[e]);return{effects:e,triggerDamageEffect:n,triggerFlashEffect:s,triggerCaptureEffect:i,getUnitEffects:r}},Bn=(e,t,n,s)=>{const i=H(n.unitType).movement.range;let o=Mn(s,i).filter(l=>Ie(l,t));return o=o.filter(l=>{const c=l.r+t,d=l.q+t;return!(!e[c]||!e[c][d]||l.q===s.q&&l.r===s.r||!$e(l,e,n)||e[c][d].unitId||te(s,l)>1&&!kk(s,l,i,t,e,n))}),o},kk=(e,t,n,s,i,r)=>{if(e.q===t.q&&e.r===t.r)return!0;if(te(e,t)>n)return!1;const l=[{pos:e,distance:0}],c=new Set,d=m=>`${m.q},${m.r}`;for(c.add(d(e));l.length>0;){const{pos:m,distance:u}=l.shift();if(m.q===t.q&&m.r===t.r)return!0;if(u>=n)continue;const h=an(m);for(const y of h){const x=d(y);if(c.has(x)||!Ie(y,s)||!$e(y,i,r))continue;const f=y.r+s,v=y.q+s;i[f]?.[v]?.unitId||(c.add(x),l.push({pos:y,distance:u+1}))}}return!1},jk=e=>({handleUnitSelection:(t,n,s,i,r)=>{const o=t.playerId===s,l=t.id===i,c=Ve(t.attacks)[0];o&&(!l||r!==I.MOVEMENT)&&!n&&ye(t)?e.startMovement(t.id):o&&(!l||r!==I.ATTACK)&&n&&de(t)?q(t)?e.startCapture(t.id):e.startAttacking(t.id,c.id):l?e.deselectUnit():e.inspectUnit(t.id)},handleAttackMode:(t,n,s,i)=>{if(q(t)){console.warn("Trainers cannot attack");return}if(!Ue(i).pattern.validateTarget(n,s)){console.warn("Cannot attack");return}e.executeAttack(t.id,s)},handleMovementMode:(t,n,s,i,r)=>{Bn(t,n,s,i).some(c=>c.q===r.q&&c.r===r.r)&&e.moveUnit(s.id,r)},handleCaptureMode:(t,n,s,i)=>{if(!q(t))return console.warn("Only trainers can capture units"),!1;if(te(n,i)>2){console.warn("Cannot capture units more than 2 tiles away");return}e.captureUnit(t.id,s.id)},handleItemMode:(t,n,s,i)=>{if(console.log("handleItemMode"),!q(t)){console.warn("Only trainers can use items");return}if(!it(i).pattern.validateTarget(n,s)){console.warn("Cannot use item");return}e.employItem(t.id,s)},handleSummonMode:(t,n,s)=>{if(!q(t)){console.warn("Only trainers can summon units");return}if(!an(n).some(o=>o.q===s.q&&o.r===s.r)){console.warn("Target position must be adjacent to trainer");return}e.summonUnit(t.id,s)},handleModeSwitch:(t,n,s,i,r,o,l,c)=>{const d=o&&Ue(o).pattern.validateTarget(i,r),m=l&&it(l).pattern.validateTarget(i,r),u=Ve(t.attacks)[0],h=t.playerId===c;console.log("handleModeSwitch"),h&&n&&q(t)&&s!==I.ATTACK?e.startCapture(t.id):h&&n&&s!==I.ATTACK&&u?e.startAttacking(t.id,u.id):h&&!n&&s===I.ATTACK&&d?e.executeAttack(t.id,r):h&&!n&&s===I.ITEM&&m?e.employItem(t.id,r):e.deselectUnit()}}),on=()=>{const{currentPlayerId:e,selectionMode:t,selectedAttack:n,selectedItem:s,map:i,radius:r}=z(),o=Ke(),l=fe(),{executeAttack:c,captureUnit:d,endTurn:m,surrender:u,employItem:h,summonUnit:y}=_t(),x=jk({...l,executeAttack:c,captureUnit:d,employItem:h,summonUnit:y}),f=p.useCallback((b,_,D)=>{const E=D.metaKey||D.ctrlKey;if(!o&&_){x.handleUnitSelection(_,E,e,null,t);return}else if(!o)return;const B=F(i,o.id);if(!B)throw new Error("Selected unit not found on map");if(_&&_.id===o.id){x.handleModeSwitch(_,E,t,B,b.position,n,s,e);return}switch(t){case I.MOVEMENT:_?x.handleUnitSelection(_,E,e,o.id,t):x.handleMovementMode(i,r,o,B,b.position);break;case I.ATTACK:if(n)x.handleAttackMode(o,B,b.position,n);else throw new Error("No attack selected");break;case I.CAPTURE:if(q(o))_&&x.handleCaptureMode(o,B,_,b.position);else throw new Error("Only trainers can capture units");break;case I.ITEM:if(q(o)&&s)x.handleItemMode(o,B,b.position,s);else throw new Error("Only trainers can use items");break;case I.SUMMON:if(q(o))x.handleSummonMode(o,B,b.position);else throw new Error("Only trainers can summon units");break;case I.WAITING:_&&x.handleUnitSelection(_,E,e,o.id,t);break}},[o,e,t,n,s,i,r,x]),v=p.useCallback(()=>{l.deselectUnit()},[l]),w=p.useCallback(()=>{m()},[m]),g=p.useCallback(b=>{o&&l.startAttacking(o.id,b)},[l,o]),j=p.useCallback(b=>{o&&l.startUsingItem(o.id,b)},[l,o]),N=p.useCallback(()=>{o&&l.startCapture(o.id)},[l,o]),T=p.useCallback(()=>{o&&l.startSummoning(o.id)},[l,o]),$=p.useCallback(()=>{u()},[u]),P=p.useCallback((b,_)=>{x.handleUnitSelection(b,_.metaKey||_.ctrlKey,e,o?.id??null,t)},[x,e,o,t]);return{handleTileClick:f,handleUnitClick:P,handleUnitDeselection:v,handleEndTurn:w,handleAttackSelection:g,handleItemSelection:j,handleCaptureSelection:N,handleSummonSelection:T,handleSurrender:$}},va=()=>{const{selectionMode:e,map:t,radius:n,selectedAttack:s,selectedItem:i,winner:r}=z(),o=Ke(),l=pa(),[c,d]=p.useState(null),m=p.useCallback(()=>{if(!o)return new Set;const S=new Set,A=F(t,o.id);return A?(e===I.MOVEMENT&&!o.hasMoved&&Bn(t,n,o,A).forEach(W=>{S.add(`${W.q},${W.r}`)}),S):new Set},[o,e,n,t]),u=p.useCallback(()=>{if(!o||e!==I.CAPTURE||o.hasAttacked||o.unitType!=="trainer")return new Set;const S=new Set,A=F(t,o.id);return t.flatMap(W=>W).filter(Boolean).map(W=>W.position).forEach(W=>{if(Math.abs(W.q-A.q)+Math.abs(W.q+W.r-A.q-A.r)+Math.abs(W.r-A.r)<=2){const G=W.r+n,C=W.q+n;if(t[G]&&t[G][C]&&t[G][C].unitId){const we=l.find(Pe=>Pe.id===t[G][C]?.unitId);we&&we.playerId!==o.playerId&&S.add(`${W.q},${W.r}`)}}}),S},[o,e,t,n,l]),h=p.useCallback(()=>{if(!o||e!==I.SUMMON||o.hasAttacked||o.unitType!=="trainer")return new Set;const S=new Set,A=F(t,o.id);return an(A).forEach(W=>{const M=W.r+n,G=W.q+n;if(t[M]&&t[M][G]){const C=t[M][G];C&&!C.unitId&&S.add(`${W.q},${W.r}`)}}),S},[o,e,t,n]),y=p.useCallback(()=>{if(!o||e!==I.ATTACK||o.hasAttacked||o.unitType==="trainer"||!s)return new Set;const S=Ue(s),A=new Set,se=F(t,o.id);return t.flatMap(M=>M).filter(Boolean).map(M=>M.position).forEach(M=>{if(S&&S.pattern.validateTarget(se,M))if(S.pattern.needsTarget){const G=M.r+n,C=M.q+n;t[G]&&t[G][C]&&t[G][C].unitId&&l.find(Pe=>Pe.id===t[G][C]?.unitId)&&A.add(`${M.q},${M.r}`)}else A.add(`${M.q},${M.r}`)}),A},[o,e,t,n,l,s]),x=p.useCallback(()=>{if(!o||!c||!s||e!==I.ATTACK||o.hasAttacked||o.unitType==="trainer")return new Set;const S=Ue(s),A=new Set,se=F(t,o.id);return S.pattern.validateTarget(se,c)&&S.pattern.getTargets(se,c,n).forEach(G=>{Ie(G,n)&&A.add(`${G.q},${G.r}`)}),A},[o,c,e,n,t,s]),f=p.useCallback(()=>{if(!o||e!==I.ITEM||!i||o.hasAttacked||o.unitType!=="trainer")return new Set;const S=F(t,o.id),A=it(i),se=new Set;return t.flatMap(M=>M).filter(Boolean).map(M=>M.position).forEach(M=>{if(A&&A.pattern.validateTarget(S,M))if(A.pattern.needsTarget){const G=M.r+n,C=M.q+n;t[G]&&t[G][C]&&t[G][C].unitId&&l.find(Pe=>Pe.id===t[G][C]?.unitId)&&se.add(`${M.q},${M.r}`)}else se.add(`${M.q},${M.r}`)}),se},[o,e,i,t,n,l]),v=m(),w=x(),g=y(),j=u(),N=h(),T=f(),$=p.useCallback((S,A)=>r?!1:w.has(`${S},${A}`),[w,r]),P=p.useCallback((S,A)=>r?!1:v.has(`${S},${A}`),[v,r]),b=p.useCallback((S,A)=>r?!1:g.has(`${S},${A}`),[g,r]),_=p.useCallback((S,A)=>r?!1:j.has(`${S},${A}`),[j,r]),D=p.useCallback((S,A)=>r?!1:N.has(`${S},${A}`),[N,r]),E=p.useCallback((S,A)=>r?!1:T.has(`${S},${A}`),[T,r]),B=p.useCallback((S,A)=>r?!1:!!(c&&c.q===S&&c.r===A),[c,r]),pe=p.useCallback(S=>{d(S.position)},[]),ft=p.useCallback(()=>{d(null)},[]);return{handleTileHover:pe,handleTileLeave:ft,isInDamagePreview:$,isMovementTarget:P,isAttackTarget:b,isCaptureTarget:_,isSummonTarget:D,isItemTarget:E,isHovered:B}},Nk=()=>{const{selectionMode:e}=z(),t=Ke();return a.jsxs("div",{className:"dropdown  dropdown-end dropdown-hover",children:[a.jsx("button",{className:"btn btn-sm btn-outline btn-secondary bg-base-100",tabIndex:0,role:"button",children:a.jsx(Sw,{className:"w-4 h-4"})}),a.jsx("div",{className:"dropdown-content card bg-base-100 shadow-lg border border-base-300 w-max z-50",children:a.jsxs("div",{className:"card-body p-4",children:[a.jsx("h3",{className:"card-title text-sm mb-3",children:"Game Controls"}),a.jsxs("div",{className:"space-y-2 text-xs",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"badge badge-sm badge-outline",children:"🖱️"}),a.jsx("span",{children:"Drag to pan"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"badge badge-sm badge-outline",children:"🔄"}),a.jsx("span",{children:"Click Reset to center view"})]}),t&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"divider my-2"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"badge badge-sm badge-outline",children:"🎯"}),a.jsxs("span",{children:["Mode:"," ",a.jsxs("span",{className:"badge badge-sm badge-primary",children:[e===I.MOVEMENT&&"Movement",e===I.ATTACK&&"Attack",e===I.CAPTURE&&"Capture",e===I.ITEM&&"Item",e===I.WAITING&&"Waiting"]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"badge badge-sm badge-outline",children:"🖱️"}),a.jsxs("span",{children:["Click tile to ",e===I.MOVEMENT&&"move",e===I.ATTACK&&"attack",e===I.CAPTURE&&"capture",e===I.ITEM&&"use item",e===I.WAITING&&"wait"]})]}),e===I.ATTACK&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"badge badge-sm badge-outline",children:"🔴"}),a.jsx("span",{children:"Hover over attack targets to see damage preview"})]}),e===I.ATTACK&&t&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"badge badge-sm badge-outline",children:"⚔️"}),a.jsx("span",{children:"Damage Preview"})]}),e===I.ATTACK&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"badge badge-sm badge-outline",children:"🎯"}),a.jsx("span",{children:"Orange tiles = valid attack targets"})]}),e===I.ATTACK&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"badge badge-sm badge-outline",children:"🔴"}),a.jsx("span",{children:"Red tiles = damage preview"})]}),e===I.MOVEMENT&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"badge badge-sm badge-outline",children:"💛"}),a.jsx("span",{children:"Yellow tiles = movement range"})]}),e===I.CAPTURE&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"badge badge-sm badge-outline",children:"🟣"}),a.jsx("span",{children:"Purple tiles = capture targets"})]}),e===I.ITEM&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"badge badge-sm badge-outline",children:"🔵"}),a.jsx("span",{children:"Blue tiles = item targets"})]})]})]})]})})]})},$k=()=>{const{triggerDamageEffect:e,triggerFlashEffect:t,triggerCaptureEffect:n,getUnitEffects:s}=wk();Ye("battle/applyDamage",l=>{const{targetId:c,damage:d}=l.payload;t(c),e(c,d)}),Ye("battle/captureUnit",l=>{const{unitId:c}=l.payload;n(c)});const i=40,r=on(),o=va();return a.jsxs("div",{className:"relative w-full h-full",children:[a.jsx("div",{className:"absolute top-4 left-96 z-10"}),a.jsx("div",{className:"absolute top-4 right-96 z-10",children:a.jsx(Nk,{})}),a.jsx(xa,{hexSize:i,onTileClick:r.handleTileClick,onTileHover:o.handleTileHover,onTileLeave:o.handleTileLeave,isMovementTarget:o.isMovementTarget,isInDamagePreview:o.isInDamagePreview,isAttackTarget:o.isAttackTarget,isCaptureTarget:o.isCaptureTarget,isSummonTarget:o.isSummonTarget,isItemTarget:o.isItemTarget,isHovered:o.isHovered,getUnitEffects:s})]})},_k=()=>{const{selectedUnit:e}=z(),t=$n(1),{handleUnitClick:n,handleEndTurn:s,handleSurrender:i}=on(),r=zw();return a.jsxs("div",{className:"p-4 space-y-4 h-full overflow-y-auto",children:[a.jsx("div",{className:"card card-bg-paper shadow-xl",children:a.jsxs("div",{className:"card-body p-4",children:[a.jsx("div",{children:a.jsxs("div",{className:"stat",children:[a.jsx("div",{className:"stat-title",children:"Current Player"}),a.jsx("div",{className:"stat-value text-secondary",children:r.name})]})}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("button",{className:"btn btn-outline btn-neutral btn-block",onClick:s,disabled:r.id!==1,children:[a.jsx(Iw,{className:"w-4 h-4"}),"End Turn"]}),a.jsxs("button",{className:"btn btn-outline btn-neutral btn-block",onClick:i,children:[a.jsx(Cw,{className:"w-4 h-4"}),"Surrender"]})]})]})}),a.jsx("div",{className:"space-y-4",children:a.jsx("div",{className:"card card-bg-paper shadow-xl",children:a.jsx("div",{className:"card-body p-4",children:t.map(o=>a.jsx("div",{className:`card inset-shadow-sm bg-black/5 border ${o.id===e?"border-neutral cursor-pointer":Le(o)?"border-error opacity-50":"border-transparent cursor-pointer"}`,onClick:Le(o)?void 0:l=>n(o,l),children:a.jsxs("div",{className:"card-body p-3",children:[a.jsxs("div",{className:"flex justify-between items-baseline gap-2 mb-2",children:[a.jsx("span",{className:"font-semibold text-base-content flex-1",children:o.name}),a.jsx("span",{className:`badge badge-sm ${ye(o)?"badge-success":"badge-outline"}`,children:ye(o)?"Can Move":"Moved"}),!q(o)&&a.jsx("span",{className:`badge badge-sm ${de(o)?"badge-accent":"badge-outline"}`,children:de(o)?"Can Attack":"Attacked"}),q(o)&&a.jsx("span",{className:`badge badge-sm ${de(o)?"badge-secondary":"badge-outline"}`,children:de(o)?"Can Act":"Acted"})]}),a.jsx("div",{className:"space-y-1 text-sm",children:a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{children:"Health"}),a.jsxs("span",{className:o.health<=0?"text-error font-semibold":"font-semibold",children:[o.health,"/",o.maxHealth]})]}),a.jsx("progress",{className:"progress w-full progress-error",value:o.health,max:o.maxHealth})]})})]})},o.id))})})})]})},Ik=({isOpen:e,onClose:t})=>{const n=Ke(),{selectedSummonUnit:s,units:i}=z(),r=Dn(1),{selectSummonUnit:o,startSummoning:l}=fe();if(!e||!n)return null;const c=Object.values(i).map(u=>u.id),d=r.filter(u=>!c.includes(u.id)),m=u=>{o(u),l(n.id),t()};return a.jsx("div",{className:"modal modal-open",children:a.jsxs("div",{className:"modal-box",children:[a.jsx("h3",{className:"font-bold text-lg mb-4",children:"Select Unit to Summon"}),d.length===0?a.jsxs("div",{className:"text-center py-8",children:[a.jsx("p",{className:"text-base-content/70",children:"No units available for summoning"}),a.jsx("p",{className:"text-sm text-base-content/50 mt-2",children:"All units are already in battle"})]}):a.jsx("div",{className:"grid grid-cols-1 gap-4 max-h-96 overflow-y-auto",children:d.map(u=>{const h=H(u.unitType);return a.jsx("div",{className:`
                    card cursor-pointer transition-all duration-200
                    ${s===u.id?"ring-2 ring-primary bg-primary/10":"hover:bg-base-200"}
                  `,onClick:()=>m(u.id),children:a.jsx("div",{className:"card-body p-4",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("img",{src:h.headshotImage,alt:u.name,className:"w-16 h-16 object-cover rounded-lg"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"card-title text-lg",children:u.name}),a.jsxs("div",{className:"text-sm text-base-content/70",children:[a.jsx("span",{className:"capitalize",children:h.affinity})," ",a.jsx("span",{className:"capitalize",children:h.family})]}),a.jsxs("div",{className:"flex gap-4 mt-2 text-sm",children:[a.jsxs("span",{children:["Level ",u.level]}),a.jsxs("span",{children:["HP: ",u.maxHealth]}),a.jsxs("span",{children:["ATK: ",u.attack]}),a.jsxs("span",{children:["DEF: ",u.defense]})]})]})]})})},u.id)})}),a.jsx("div",{className:"modal-action",children:a.jsx("button",{className:"btn btn-outline",onClick:t,children:"Cancel"})})]})})},Tk={[U.ATTACK_MULTIPLIER]:"Attack",[U.DEFENSE_MULTIPLIER]:"Defense"},Ns=({effect:e})=>{switch(e.type){case k.APPLY_MODIFIER:return a.jsxs("span",{className:"badge badge-outline badge-xs",children:[Tk[e.modifierType],e.value>0?` +${e.value}`:` ${e.value}`]});case k.HEAL:return a.jsxs("span",{className:"badge badge-outline badge-xs",children:["Heal: ",e.value]});case k.PUSH:return a.jsxs("span",{className:"badge badge-outline badge-xs",children:["Push: ",e.distance]});case k.POISON:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Poison"});case k.STUN:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Stun"});case k.SLEEP:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Sleep"});case k.BURN:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Burn"});case k.BLEED:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Bleed"});case k.SHIELD:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Shield"});case k.REFLECT:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Reflect"});case k.TELEPORT:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Teleport"});case k.ARMOR_PIERCE:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Armor Pierce"});case k.HASTE:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Haste"});case k.DRAIN:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Drain"});case k.CREATE_TERRAIN:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Create Terrain"});case k.CRITICAL_STRIKE:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Critical Strike"});case k.ROOT:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Root"});case k.CURE_POISON:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Cure Poison"});default:{const t=e;throw new Error(`Unknown effect type: ${t}`)}}},Ck=""+new URL("attack-CjWLVDqi.png",import.meta.url).href,Ek=""+new URL("defense-CqlxeKv8.png",import.meta.url).href,Sk=""+new URL("poison-BQ7Hh4O6.png",import.meta.url).href,Ak=({modifier:e})=>{const t=()=>{switch(e.type){case U.ATTACK_MULTIPLIER:{const s=e.value>0?`+${e.value}`:`${e.value}`;return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"tooltip","data-tip":"Attack",children:a.jsx("img",{src:Ck,alt:"Attack",className:"w-6 h-6"})}),a.jsx("span",{className:"text-xs opacity-70",children:s})]})}case U.DEFENSE_MULTIPLIER:{const s=e.value>0?`+${e.value}`:`${e.value}`;return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"tooltip","data-tip":"Defense",children:a.jsx("img",{src:Ek,alt:"Defense",className:"w-6 h-6"})}),a.jsx("span",{className:"text-xs opacity-70",children:s})]})}case U.POISON:return a.jsx("div",{className:"tooltip","data-tip":"Poisoned",children:a.jsx("img",{src:Sk,alt:"Poisoned",className:"w-6 h-6"})});case U.STUN:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Stun"});case U.SLEEP:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Sleep"});case U.BURN:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Burn"});case U.BLEED:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Bleed"});case U.SHIELD:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Shield"});case U.REFLECT:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Reflect"});case U.ROOT:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Root"});case U.HASTE:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Haste"});case U.DRAIN:return a.jsx("span",{className:"badge badge-outline badge-xs",children:"Drain"});default:{const s=e;throw new Error(`Unknown modifier type: ${s}`)}}},n=()=>e.duration===null?"Permanent":e.duration===1?"1 turn":`${e.duration} turns`;return a.jsxs("div",{className:"flex flex-row items-center gap-1",children:[t(),e.duration!==null&&a.jsx("span",{className:"text-xs opacity-70",children:n()})]})},Lk=()=>{const e=Ke(),{selectedAttack:t,selectedItem:n,selectionMode:s,currentPlayerId:i}=z(),{playerBackpack:r}=Te(),{handleAttackSelection:o,handleItemSelection:l,handleCaptureSelection:c}=on(),d=ga(2),[m,u]=p.useState(!1);if(!e||i!==1)return null;const h=Ve(e.attacks),y=H(e.unitType),x=e.playerId===i,f=sn(e),v=q(e)?He(e.trainerId):null;return a.jsxs("div",{className:"p-4 space-y-4 h-full overflow-y-auto",children:[a.jsx("div",{className:"card card-bg-paper shadow-xl",children:a.jsxs("div",{className:"card-body p-4",children:[a.jsxs("div",{className:"flex justify-between items-baseline gap-2",children:[a.jsx("h3",{className:"card-title text-lg flex-1",children:e.name}),a.jsx("span",{className:`badge badge-sm ${ye(e)?"badge-success":"badge-outline"}`,children:ye(e)?"Can Move":"Moved"}),e.unitType!=="trainer"&&a.jsx("span",{className:`badge badge-sm ${de(e)?"badge-accent":"badge-outline"}`,children:de(e)?"Can Attack":"Attacked"})]}),!q(e)&&a.jsxs("div",{className:"text-gray-500",children:[a.jsx("span",{className:"capitalize",children:y.affinity})," ",a.jsx("span",{className:"capitalize",children:y.family})]}),a.jsx("img",{src:v?v.headshotImage:y.headshotImage,alt:e.name,className:"w-full -scale-x-100"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{children:"Health"}),a.jsxs("span",{className:e.health<=0?"text-error font-semibold":"font-semibold",children:[e.health,"/",e.maxHealth]})]}),a.jsx("progress",{className:"progress w-full progress-error",value:e.health,max:e.maxHealth})]}),x&&f&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{children:"Level"}),a.jsx("span",{className:"font-semibold",children:e.level})]}),a.jsx("progress",{className:"progress w-full progress-error",value:f.experience,max:f.experienceToNextLevel})]}),e.modifiers.length>0&&a.jsx("div",{className:"flex flex-wrap gap-2",children:e.modifiers.map(w=>a.jsx(Ak,{modifier:w},w.id))})]})}),x&&q(e)&&a.jsx("div",{className:"card card-bg-paper shadow-xl",children:a.jsxs("div",{className:"card-body p-4",children:[a.jsx("h4",{className:"card-title text-md text-secondary",children:"Actions"}),a.jsxs("div",{className:"space-y-4",children:[d?a.jsx("div",{className:"card inset-shadow-sm bg-black/5",children:a.jsxs("div",{className:"card-body p-2",children:[a.jsx("h5",{className:"font-semibold text-base-content/50",children:"Summon"}),a.jsx("p",{className:"text-sm text-base-content/50",children:"Summoning is disabled when battling another character."})]})}):a.jsx("div",{className:`
                    ${de(e)?"cursor-pointer":"cursor-default"}
                    ${s===I.SUMMON?"border-neutral":"border-transparent"}
                    card inset-shadow-sm bg-black/5 border
                  `,onClick:()=>u(!0),children:a.jsxs("div",{className:"card-body p-2",children:[a.jsx("h5",{className:"font-semibold text-base-content",children:"Summon"}),a.jsx("p",{className:"text-sm text-base-content/80",children:"Summon a unit from your army"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:a.jsx("span",{className:"badge badge-xs badge-outline",children:"Adjacent"})})]})}),d?a.jsx("div",{className:"card inset-shadow-sm bg-black/5",children:a.jsxs("div",{className:"card-body p-2",children:[a.jsx("h5",{className:"font-semibold text-base-content/50",children:"Capture"}),a.jsx("p",{className:"text-sm text-base-content/50",children:"Capturing is disabled when battling another character."})]})}):a.jsx("div",{className:`
                    ${de(e)?"cursor-pointer":"cursor-default"}
                    ${s===I.CAPTURE?"border-neutral":"border-transparent"}
                    card inset-shadow-sm bg-black/5 border
                  `,onClick:()=>c(),children:a.jsxs("div",{className:"card-body p-2",children:[a.jsx("h5",{className:"font-semibold text-base-content",children:"Capture"}),a.jsx("p",{className:"text-sm text-base-content/80",children:"Capture the enemy unit"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:a.jsx("span",{className:"badge badge-xs badge-outline",children:"Range: 1"})})]})})]})]})}),x&&q(e)&&a.jsx("div",{className:"card card-bg-paper shadow-xl",children:a.jsxs("div",{className:"card-body p-4",children:[a.jsx("h4",{className:"card-title text-md text-secondary",children:"Items"}),a.jsxs("div",{className:"space-y-4",children:[r.map(w=>{const g=it(w.itemId);return a.jsx("div",{className:`
                      ${de(e)?"cursor-pointer":"cursor-default"}
                      ${s===I.ITEM&&g.id===n?"border-neutral":"border-transparent"}
                      card inset-shadow-sm bg-black/5 border
                    `,onClick:()=>l(g.id),children:a.jsxs("div",{className:"card-body p-2",children:[a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsx("h5",{className:"font-semibold text-base-content",children:g.name}),a.jsxs("span",{className:"badge badge-sm badge-outline",children:["x",w.quantity]})]}),a.jsx("p",{className:"text-sm text-base-content/80",children:g.description}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[g.consumable&&a.jsx("span",{className:"badge badge-xs badge-outline",children:"Consumable"}),Object.entries(g.pattern.meta).map(([j,N])=>a.jsxs("span",{className:"badge badge-xs badge-outline",children:[j,": ",N]},j)),g.effects.map((j,N)=>a.jsx(Ns,{effect:j},`effect-${N}`))]})]})},g.id)}),r.length===0&&a.jsx("div",{className:"text-center text-base-content/50 py-4",children:"No items available"})]})]})}),x&&!q(e)&&a.jsx("div",{className:"card card-bg-paper shadow-xl",children:a.jsxs("div",{className:"card-body p-4",children:[a.jsx("h4",{className:"card-title text-md text-secondary",children:"Attacks"}),a.jsx("div",{className:"space-y-4",children:h.map(w=>a.jsx("div",{className:`
                    ${de(e)?"cursor-pointer":"cursor-default opacity-50"}
                    ${w.id===t?"border-neutral":"border-transparent"}
                    card inset-shadow-sm bg-black/5 border
                  `,onClick:()=>o(w.id),children:a.jsxs("div",{className:"card-body p-2",children:[a.jsx("h5",{className:"font-semibold text-base-content",children:w.name}),a.jsx("p",{className:"text-sm text-base-content/80",children:w.description}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[w.power[0]>0&&a.jsxs("span",{className:"badge badge-xs badge-outline",children:["Power: ",w.power[0],"d",w.power[1]]}),Object.entries(w.pattern.meta).map(([g,j])=>a.jsxs("span",{className:"badge badge-xs badge-outline",children:[g,": ",j]},g)),w.effects.map((g,j)=>a.jsx(Ns,{effect:g},`effect-${j}`))]})]})},w.id))})]})}),a.jsx(Ik,{isOpen:m,onClose:()=>u(!1)})]})},Uk=ce([e=>e.overworld],e=>{console.log("overworld.playerLocationId",e.playerLocationId),console.log("overworld.locations",e.locations);const t=e.locations.find(n=>n.id===e.playerLocationId);if(!t)throw new Error("Player location not found");return t});ce([e=>e.overworld],e=>e.unlockedLocations);const qk=ce([e=>e.overworld],e=>e.locations.filter(t=>e.unlockedLocations.includes(t.id))),Pk=()=>ee(e=>e.overworld),wa=()=>ee(e=>Uk(e)),Mk=()=>ee(e=>qk(e)),ka=()=>Fn("ancient-forest/old-man-forest"),ja=()=>{const e=ct();return{moveToLocation:t=>e(Se.moveToLocation(t)),unlockLocation:t=>e(Se.unlockLocation(t)),completeActivity:(t,n,s)=>e(Se.completeActivity({locationId:t,activityType:n,activityId:s})),unlockActivity:(t,n,s)=>e(Se.unlockActivity({locationId:t,activityType:n,activityId:s}))}},Ok=(e,t)=>{const{map:n,placementMode:s,currentPlayerId:i}=z(),{removePlacedUnit:r,setPlacementMode:o,placeUnit:l}=fe(),{trainer:c,placedUnits:d,totalPlacedCost:m}=fa(i),u=Qw(),h=ka();if(!h)throw new Error("Battle config not found");const y=h.pointLimit,x=p.useCallback((j,N)=>{if(!$e(j,n,N)||ot(n,j)||m+at(N)>y)return!1;if(s===xe.TRAINER){const T=Math.floor((n.length-1)/2);return j.q===-T||j.q+j.r===-T}else return u?te(j,u)<=3:!1},[n,u,s,y,m]),f=p.useCallback(j=>{const N=d.find(T=>T.id===j);if(!N){console.warn("Unit not found for removal:",j);return}if(N.playerId!==i){console.warn("Cannot remove enemy unit");return}j===c?.id?(d.filter($=>$.playerId===i).forEach($=>{r($.id)}),o(xe.TRAINER),t(c)):r(j)},[d,c,i,r,o,t]),v=p.useCallback((j,N)=>{x(N.position,j)&&(l(j,N.position),t(null),s===xe.TRAINER&&j.unitType==="trainer"&&o(xe.UNITS))},[l,t,s,x,o]),w=p.useCallback((j,N)=>{if(N){f(N.id);return}if(e){v(e,j);return}},[v,f,e]),g=p.useCallback((j,N,T)=>T?x({q:j,r:N},T):!1,[x]);return{handleTileClick:w,handleRemoveUnit:f,isPlacementTarget:g}},Wn=""+new URL("overworld-map-2_ngTzvm.png",import.meta.url).href,Rk=()=>{const{selectSquad:e}=rn(),{finishUnitPlacement:t}=fe(),{currentPlayerId:n,placementMode:s}=z(),i=ma(n),r=wa(),{handleTileHover:o,handleTileLeave:l,isHovered:c}=va(),{trainer:d,availableArmyUnits:m,placedUnits:u,selectedSquadId:h,totalPlacedCost:y}=fa(n),[x,f]=p.useState(d),{handleTileClick:v,handleRemoveUnit:w,isPlacementTarget:g}=Ok(x,f),j=ka();if(!j)throw new Error("Battle config not found");const N=j.pointLimit,T=N-y;return d?a.jsxs("div",{className:"flex size-full min-h-screen bg-cover bg-center bg-no-repeat bg-fixed bg-black",style:{backgroundImage:`url(${Wn})`},children:[a.jsxs("div",{className:"flex flex-col gap-4 w-96 p-4 max-h-screen",children:[a.jsx("div",{className:"flex-1 card card-bg-paper shadow-xl overflow-y-auto",children:a.jsxs("div",{className:"card-body p-4",children:[a.jsx("h3",{className:"card-title text-lg mb-2",children:"Available Units"}),s===xe.UNITS&&i.length>0&&a.jsxs("select",{className:"select select-bordered bg-transparent w-full mb-2",value:h??void 0,onChange:$=>e(n,$.target.value),children:[a.jsx("option",{value:"all",children:"All ▼"}),i.map($=>a.jsx("option",{value:$.id,children:$.name},$.id)),a.jsx("option",{value:"unassigned",children:"Unassigned"})]}),a.jsxs("div",{className:"space-y-4 overflow-y-auto",children:[(s===xe.TRAINER?[d]:m).map($=>{const P=at($),b=y+P<=N,_=sn($),D=H($.unitType),E=q($),B=E?He($.trainerId):null;return a.jsx("div",{className:`card inset-shadow-sm shadow-xl cursor-pointer border-2 ${x?.id===$.id?"border-base-100":"border-neutral"} ${b?"":"opacity-50"}`,onClick:()=>f($),children:a.jsxs("div",{className:"card-body p-4 space-y-4",children:[a.jsxs("div",{className:"flex flex-row gap-4",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("div",{className:"w-16 h-16 mx-auto lg:mx-0",children:a.jsx("img",{src:E?B?.headshotImage:D.headshotImage,alt:$.name,className:"w-full h-full object-contain rounded-lg border border-neutral"})})}),a.jsx("div",{className:"flex-1",children:a.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:a.jsxs("div",{className:"flex-1",children:[a.jsx("h5",{className:"font-semibold text-lg mb-1",children:$.name}),a.jsx("p",{className:"text-sm text-base-content/70 capitalize",children:D.name})]})})})]}),a.jsxs("div",{className:"flex flex-row gap-4",children:[a.jsxs("div",{className:"flex flex-col w-12",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Level"}),a.jsx("span",{className:"font-semibold text-lg",children:$.level})]}),a.jsxs("div",{className:"flex flex-col w-12",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Health"}),a.jsx("span",{className:"font-semibold text-lg text-success",children:$.maxHealth})]}),a.jsxs("div",{className:"flex flex-col w-12",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Attack"}),a.jsx("span",{className:"font-semibold text-lg text-error",children:$.attack})]}),a.jsxs("div",{className:"flex flex-col w-12",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Defense"}),a.jsx("span",{className:"font-semibold text-lg text-info",children:$.defense})]}),a.jsxs("div",{className:"flex flex-col w-12",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Cost"}),a.jsx("span",{className:"font-semibold text-lg text-accent",children:P})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase",children:"Experience"}),a.jsxs("span",{className:"font-semibold",children:[_.experience,"/",_.experienceToNextLevel]})]}),a.jsx("progress",{className:"progress w-full progress-neutral",value:_.experience,max:_.experienceToNextLevel})]}),!b&&s===xe.UNITS&&a.jsxs("div",{className:"text-error text-sm text-center font-medium bg-error/10 p-2 rounded",children:["Cannot afford (need ",P," points)"]})]})},$.id)}),m.length===0&&a.jsx("div",{className:"text-center py-8 text-base-content/70",children:a.jsx("p",{className:"text-sm",children:"No units available"})})]})]})}),a.jsx("div",{className:"flex-shrink-0 card card-bg-paper shadow-xl",children:a.jsxs("div",{className:"card-body p-4",children:[a.jsx("h3",{className:"card-title text-lg mb-3",children:"Placed Units"}),a.jsx("div",{className:"space-y-2",children:u.length===0?a.jsx("div",{className:"text-center py-4 text-base-content/70",children:a.jsx("p",{className:"text-sm",children:"No units placed"})}):u.map($=>{const P=H($.unitType),b=q($),_=b?He($.trainerId):null;return a.jsx("div",{className:"card inset-shadow-sm bg-neutral/5",children:a.jsx("div",{className:"card-body p-3",children:a.jsxs("div",{className:"flex flex-row gap-3",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("div",{className:"w-12 h-12",children:a.jsx("img",{src:b?_?.headshotImage:P.headshotImage,alt:$.name,className:"w-full h-full object-contain rounded-lg border border-neutral"})})}),a.jsx("div",{className:"flex-1",children:a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-2",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h5",{className:"font-semibold text-sm mb-1",children:$.name}),a.jsx("p",{className:"text-xs text-base-content/70 capitalize",children:P.name})]}),a.jsxs("div",{className:"flex flex-col w-8",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Lvl"}),a.jsx("span",{className:"font-semibold text-sm",children:$.level})]}),a.jsx("button",{className:"btn btn-xs btn-outline btn-error",onClick:D=>w($.id),children:"×"})]})})]})})},$.id)})})]})})]}),a.jsxs("div",{className:"flex-1 p-4 flex flex-col gap-4 max-h-screen",children:[a.jsx("div",{className:"card card-bg-paper shadow-xl",children:a.jsx("div",{className:"card-body p-4",children:a.jsxs("div",{className:"flex flex-row gap-4 items-end",children:[a.jsx("h3",{className:"text-3xl font-semibold",children:r.name}),a.jsx("div",{className:"flex-1 text-center",children:a.jsx("button",{className:"btn btn-outline btn-neutral",onClick:t,disabled:s===xe.TRAINER||u.length===1,children:"Start Battle"})}),a.jsx("div",{className:"flex flex-col",children:a.jsx("span",{className:"text-neutral/70 text-lg",children:"Points:"})}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Limit"}),a.jsx("span",{className:"font-semibold text-lg text-neutral",children:N.toString().padStart(3,"0")})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Used"}),a.jsx("span",{className:"font-semibold text-lg text-neutral",children:y.toString().padStart(3,"0")})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Remaining"}),a.jsx("span",{className:`font-semibold text-lg ${T>=0?"text-neutral":"text-error"}`,children:T.toString().padStart(3,"0")})]})]})})}),a.jsx("div",{className:"flex-1 card card-bg-paper shadow-xl",children:a.jsx("div",{className:"card-body p-4 backdrop-blur-xs backdrop-brightness-60",children:a.jsx("div",{className:"flex-1",children:a.jsx(xa,{hexSize:24,onTileClick:v,onTileHover:o,onTileLeave:l,isMovementTarget:($,P)=>g($,P,x),isInDamagePreview:()=>!1,isAttackTarget:()=>!1,isCaptureTarget:()=>!1,isSummonTarget:()=>!1,isItemTarget:()=>!1,isHovered:c,disableCameraControls:!0,getUnitEffects:()=>({isFlashing:!1,isBeingCaptured:!1,damageNumber:void 0})})})})})]})]}):a.jsx("div",{className:"flex-1 min-h-screen bg-base-100 p-6",children:a.jsx("div",{className:"card bg-error text-error-content shadow-lg border border-error",children:a.jsxs("div",{className:"card-body text-center",children:[a.jsx("h2",{className:"card-title text-3xl",children:"Error"}),a.jsx("p",{children:"Trainer unit not found in army!"})]})})})};class Fk{name="Improved Strategic";DEBUG_LOGGING=!1;log(t,...n){this.DEBUG_LOGGING&&console.log(`[AI Strategy] ${t}`,...n)}selectUnitsToAct(t,n){this.log("=== SELECTING UNITS TO ACT ===");const s=t.filter(o=>!o.hasMoved||!o.hasAttacked);if(this.log(`Found ${s.length} available units out of ${t.length} total`),s.length===0)return this.log("No units available to act"),[];const r=s.sort((o,l)=>{const c=!o.hasMoved,d=!l.hasMoved;if(c&&!d)return-1;if(!c&&d)return 1;const m=!o.hasAttacked,u=!l.hasAttacked;return m&&!u?-1:!m&&u?1:0}).map(o=>o.id);return this.log("Selected units in priority order:",r.map(o=>{const l=t.find(c=>c.id===o);return`${o} (can move: ${!l?.hasMoved}, can attack: ${!l?.hasAttacked})`})),r}selectMovementTarget(t,n){if(this.log(`=== SELECTING MOVEMENT TARGET FOR UNIT ${t.id} ===`),t.hasMoved)return this.log(`Unit ${t.id} has already moved, skipping`),null;const{map:s,radius:i,units:r}=n,o=this.findEnemyUnits(t.playerId,r);if(this.log(`Found ${o.length} enemy units`),o.length===0)return this.log("No enemies found, no movement needed"),null;const l=F(s,t.id);if(!l)return this.log(`Unit ${t.id} not found on map`),null;const c=Bn(s,i,t,l);if(this.log(`Found ${c.length} valid movement targets`),c.length===0)return this.log("No valid movement targets available"),null;const d=this.selectBestAttack(t,n);if(!d){this.log("No good attack available, moving towards closest enemy");const u=this.findClosestEnemy(t,o,s);if(!u)return this.log("No closest enemy found"),null;const h=F(s,u.id);if(!h)return this.log("Closest enemy position not found"),null;const y=this.findBestMovementTowardsTarget(c,h);return this.log(`Moving towards enemy ${u.id} at position (${h.q}, ${h.r})`),y}const m=this.findBestPositionForAttack(t,d,c,n);return this.log(`Selected attack position: (${m?.q}, ${m?.r})`),m}selectActionTarget(t,n){if(this.log(`=== SELECTING ACTION TARGET FOR UNIT ${t.id} ===`),t.hasAttacked)return this.log(`Unit ${t.id} has already attacked, skipping`),null;const s=Ve(t.attacks),i=this.getAvailableItems(t,n);this.log(`Available attacks: ${s.map(l=>l.id).join(", ")}`),this.log(`Available items: ${i.map(l=>l.id).join(", ")}`);let r=null,o=-1/0;for(const l of s){const c=this.evaluateAttack(l,t,n);if(this.log(`Evaluating attack ${l.id}: score ${c.toFixed(2)}`),c>o){const d=this.findBestTargetForAttack(t,l,n);d&&(o=c,r={target:d,attackId:l.id},this.log(`New best action: attack ${l.id} with score ${c.toFixed(2)}`))}}if(q(t))for(const l of i){const c=this.evaluateItem(t,l,n);if(this.log(`Evaluating item ${l.id}: score ${c.toFixed(2)}`),c>o){const d=this.findBestTargetForItem(t,l,n);d&&(o=c,r={target:d,itemId:l.id},this.log(`New best action: item ${l.id} with score ${c.toFixed(2)}`))}}return r?this.log(`Final action selection: ${"attackId"in r?"attack":"item"} ${"attackId"in r?r.attackId:r.itemId} with score ${o.toFixed(2)}`):this.log("No suitable action found"),r}isPositiveEffect(t){switch(t.type){case k.HEAL:return!0;case k.SHIELD:return!0;case k.REFLECT:return!0;case k.HASTE:return!0;case k.APPLY_MODIFIER:return t.value>0;default:return!1}}isNegativeEffect(t){switch(t.type){case k.POISON:case k.STUN:case k.SLEEP:case k.BURN:case k.BLEED:case k.ROOT:case k.DRAIN:return!0;case k.APPLY_MODIFIER:return t.value<0;default:return!1}}getEffectValue(t){switch(t.type){case k.HEAL:return t.value;case k.SHIELD:return t.amount||0;case k.APPLY_MODIFIER:return t.value;case k.POISON:case k.BURN:case k.BLEED:return 0;case k.DRAIN:return-(t.amount||0);default:return 0}}selectBestAttack(t,n){this.log(`Evaluating attacks for unit ${t.id}`);const s=Ve(t.attacks);if(s.length===0)return this.log("No attacks available"),null;if(s.length===1)return this.log(`Only one attack available: ${s[0].id}`),s[0];let i=s[0],r=this.evaluateAttack(s[0],t,n);this.log(`Evaluating attack ${s[0].id}: score ${r.toFixed(2)}`);for(let o=1;o<s.length;o++){const l=this.evaluateAttack(s[o],t,n);this.log(`Evaluating attack ${s[o].id}: score ${l.toFixed(2)}`),l>r&&(r=l,i=s[o],this.log(`New best attack: ${s[o].id} with score ${l.toFixed(2)}`))}return this.log(`Final selection: ${i.id} with score ${r.toFixed(2)}`),i}evaluateAttack(t,n,s){const{map:i}=s;if(!F(i,n.id))return-1/0;if(t.pattern.id==="self")return this.evaluateSelfAttack(t,n);const o=this.findBestTargetForAttack(n,t,s);return o?this.evaluateTargetPosition(t,o,n,s):-1/0}evaluateSelfAttack(t,n){let s=0;for(const o of t.effects)this.isPositiveEffect(o)?s+=this.getEffectValue(o):this.isNegativeEffect(o)&&(s-=this.getEffectValue(o));const[i,r]=t.power;return s+=i*r*.5,s}findBestTargetForAttack(t,n,s){this.log(`Finding best target for attack ${n.id}`);const{map:i}=s,r=F(i,t.id);if(!r)return this.log("Unit position not found"),null;if(n.pattern.id==="self")return this.log("Self-targeting attack, targeting self"),r;const o=this.getPossibleTargets(t,n,s);if(this.log(`Found ${o.length} possible targets`),o.length===0)return this.log("No possible targets found"),null;let l=o[0],c=this.evaluateTargetPosition(n,l,t,s);this.log(`Evaluating target (${l.q}, ${l.r}): score ${c.toFixed(2)}`);for(let d=1;d<o.length;d++){const m=this.evaluateTargetPosition(n,o[d],t,s);this.log(`Evaluating target (${o[d].q}, ${o[d].r}): score ${m.toFixed(2)}`),m>c&&(c=m,l=o[d],this.log(`New best target: (${o[d].q}, ${o[d].r}) with score ${m.toFixed(2)}`))}return this.log(`Final target selection: (${l.q}, ${l.r}) with score ${c.toFixed(2)}`),l}getPossibleTargets(t,n,s){const{map:i,units:r}=s,o=F(i,t.id);if(!o)return[];const l=[];if(n.pattern.needsTarget){const c=this.findEnemyUnits(t.playerId,r);for(const d of c){const m=F(i,d.id);m&&n.pattern.validateTarget(o,m)&&l.push(m)}}else{const{radius:c}=s;for(let d=-c;d<=c;d++)for(let m=-c;m<=c;m++){const u={q:d,r:m};n.pattern.validateTarget(o,u)&&l.push(u)}}return l}evaluateTargetPosition(t,n,s,i){const{map:r}=i;if(!F(r,s.id))return-1/0;const l=this.getAffectedUnits(t,n,s,i);let c=0;for(const d of l.allies)c+=this.evaluateEffectOnUnit(t,d,!0);for(const d of l.enemies){c+=this.evaluateEffectOnUnit(t,d,!1);const[m,u]=t.power;c+=m*u*.5}return c}getAffectedUnits(t,n,s,i){const{map:r,units:o}=i,l=F(r,s.id);if(!l)return{allies:[],enemies:[]};const c=t.pattern.getTargets(l,n,i.radius),d=[],m=[];for(const u of c){const h=this.findUnitAtPosition(u,o,r);h&&(h.playerId===s.playerId?d.push(h):m.push(h))}return{allies:d,enemies:m}}evaluateEffectOnUnit(t,n,s){const i=s?-1:1;let r=0;for(const c of t.effects){const d=this.getEffectValue(c);this.isPositiveEffect(c)?r+=-d*i:this.isNegativeEffect(c)&&(r+=d*i)}const[o,l]=t.power;return r+=i*o*l*.5,r}findBestPositionForAttack(t,n,s,i){let r=s[0],o=this.evaluateTargetPosition(n,r,t,i);for(let l=1;l<s.length;l++){const c=this.evaluateTargetPosition(n,s[l],t,i);c>o&&(o=c,r=s[l])}if(o===0){this.log("Best attack score is zero, moving towards opponent's trainer");const l=this.findEnemyTrainer(t.playerId,i.units);if(l){const c=F(i.map,l.id);if(c){this.log(`Moving towards enemy trainer at (${c.q}, ${c.r})`);const d=this.findBestMovementTowardsTarget(s,c);this.log(`Best position towards trainer: (${d.q}, ${d.r})`),r=d}}}return this.log(`Best position for attack ${n.id}: (${r.q}, ${r.r}) with score ${o.toFixed(2)}`),r}findUnitAtPosition(t,n,s){for(const i of Object.values(n)){const r=F(s,i.id);if(r&&r.q===t.q&&r.r===t.r)return i}return null}findEnemyUnits(t,n){const s=[];return Object.values(n).forEach(i=>{i.playerId!==t&&s.push(i)}),s}findEnemyTrainer(t,n){this.log(`Finding enemy trainer for player ${t}`);const i=this.findEnemyUnits(t,n).find(r=>q(r));return i?this.log(`Found enemy trainer: ${i.id}`):this.log("No enemy trainer found"),i||null}findClosestEnemy(t,n,s){if(this.log(`Finding closest enemy for unit ${t.id}`),n.length===0)return this.log("No enemy units available"),null;const i=F(s,t.id);if(!i)return this.log("Unit position not found"),null;let r=null,o=1/0;for(const l of n){const c=F(s,l.id);if(c){const d=te(i,c);this.log(`Enemy ${l.id} at distance ${d}`),d<o&&(o=d,r=l,this.log(`New closest enemy: ${l.id} at distance ${d}`))}}return this.log(`Closest enemy: ${r?.id||"none"} at distance ${o}`),r}findBestMovementTowardsTarget(t,n){this.log(`Finding best movement towards target (${n.q}, ${n.r}) from ${t.length} options`);let s=t[0],i=te(t[0],n);this.log(`Initial position (${t[0].q}, ${t[0].r}) at distance ${i}`);for(const r of t){const o=te(r,n);this.log(`Position (${r.q}, ${r.r}) at distance ${o}`),o<i&&(i=o,s=r,this.log(`New best position: (${r.q}, ${r.r}) at distance ${o}`))}return this.log(`Final movement target: (${s.q}, ${s.r}) at distance ${i}`),s}getAvailableItems(t,n){return q(t)?t.backpack.map(s=>it(s.itemId)):(this.log("Unit is not a trainer, cannot use items"),[])}evaluateItem(t,n,s){let i=0;for(const r of n.effects)this.isPositiveEffect(r)?i+=this.getEffectValue(r):this.isNegativeEffect(r)&&(i-=this.getEffectValue(r));return n.id==="potion"&&t.health<t.maxHealth*.5&&(i+=20),n.id==="antidote"&&t.modifiers.some(r=>r.type===U.POISON)&&(i+=15),n.id==="power-up"&&t.attack<10&&(i+=10),i}getPossibleItemTargets(t,n,s){const{map:i}=s,r=F(i,t.id);if(!r)return[];const o=[];if(n.pattern.needsTarget){const l=this.findEnemyUnits(t.playerId,s.units);for(const c of l){const d=F(i,c.id);d&&n.pattern.validateTarget(r,d)&&o.push(d)}}else{const{radius:l}=s;for(let c=-l;c<=l;c++)for(let d=-l;d<=l;d++){const m={q:c,r:d};n.pattern.validateTarget(r,m)&&o.push(m)}}return o}evaluateItemTarget(t,n,s,i){const{map:r}=i;if(!F(r,t.id))return-1/0;const l=this.getAffectedUnitsForItem(n,s,t,i);let c=0;for(const d of l.allies)c+=this.evaluateItemEffectOnUnit(n,d,!0);for(const d of l.enemies)c+=this.evaluateItemEffectOnUnit(n,d,!1);return c}getAffectedUnitsForItem(t,n,s,i){const{map:r,units:o}=i,l=F(r,s.id);if(!l)return{allies:[],enemies:[]};const c=t.pattern.getTargets(l,n,i.radius),d=[],m=[];for(const u of c){const h=this.findUnitAtPosition(u,o,r);h&&(h.playerId===s.playerId?d.push(h):m.push(h))}return{allies:d,enemies:m}}evaluateItemEffectOnUnit(t,n,s){const i=s?-1:1;let r=0;for(const o of t.effects){const l=this.getEffectValue(o);this.isPositiveEffect(o)?r+=-l*i:this.isNegativeEffect(o)&&(r+=l*i)}return r}findBestTargetForItem(t,n,s){const{map:i}=s,r=F(i,t.id);if(!r)return null;if(n.pattern.id==="self")return r;const o=this.getPossibleItemTargets(t,n,s);if(o.length===0)return null;let l=o[0],c=this.evaluateItemTarget(t,n,l,s);for(let d=1;d<o.length;d++){const m=this.evaluateItemTarget(t,n,o[d],s);m>c&&(c=m,l=o[d])}return l}}class Dk{aiConfigs=new Map;constructor(){const t=new Fk;this.aiConfigs.set(1,{playerId:1,strategy:t,isEnabled:!1}),this.aiConfigs.set(2,{playerId:2,strategy:t,isEnabled:!1})}isAIPlayer(t){return this.aiConfigs.get(t)?.isEnabled||!1}setAIPlayer(t,n,s){const i=this.aiConfigs.get(t);i&&this.aiConfigs.set(t,{...i,isEnabled:n,strategy:s||i.strategy})}determineAIAction(t,n){const s=this.aiConfigs.get(t);if(!s||!s.isEnabled)throw new Error(`Player ${t} is not enabled`);const i=s.strategy,r=this.getPlayerUnits(t,n),o=i.selectUnitsToAct(r,n);if(o.length===0)return{type:"end_turn"};for(const l of o){const c=n.units[l];if(!c)throw new Error(`Unit ${l} not found`);if(!c.hasMoved){const d=i.selectMovementTarget(c,n);if(d)return{type:"move",unitId:l,targetPosition:d}}if(!c.hasAttacked){const d=i.selectActionTarget(c,n);if(d)return"attackId"in d?{type:"attack",unitId:l,targetPosition:d.target,attackId:d.attackId}:{type:"use_item",unitId:l,targetPosition:d.target,itemId:d.itemId}}}return{type:"end_turn"}}getPlayerUnits(t,n){const s=n.players.find(i=>i.id===t);return s?s.units.map(i=>n.units[i]).filter(Boolean):[]}}const Bk=1e3,Wk=()=>{const e=z(),{currentPlayerId:t,aiPlayers:n,gamePhase:s,winner:i}=e,{moveUnit:r,startMovement:o,startAttacking:l,startUsingItem:c}=fe(),{executeAttack:d,employItem:m,endTurn:u}=_t(),h=p.useRef(null);p.useEffect(()=>{h.current||(h.current=new Dk,n.forEach(f=>{h.current.setAIPlayer(f.playerId,f.isEnabled)}))},[n]);const y=p.useCallback(()=>{if(!h.current)return;const f=h.current.determineAIAction(t,e);f.type==="move"&&f.targetPosition?(o(f.unitId),r(f.unitId,f.targetPosition)):f.type==="attack"&&f.targetPosition&&f.attackId?(l(f.unitId,f.attackId),d(f.unitId,f.targetPosition)):f.type==="use_item"&&f.targetPosition&&f.itemId?(c(f.unitId,f.itemId),m(f.unitId,f.targetPosition)):f.type==="end_turn"&&u()},[t,u,r,d,m,o,l,c,e]);p.useEffect(()=>{if(h.current&&s===be.SELECTION&&h.current.isAIPlayer(t)&&!i){const f=setTimeout(()=>{y()},Bk);return()=>clearTimeout(f)}},[t,s,n,y,i]);const x=p.useCallback(()=>{h.current&&n.forEach(f=>{h.current.setAIPlayer(f.playerId,f.isEnabled)})},[n]);p.useEffect(()=>{x()},[n,x])},Gk=()=>{const{map:e,units:t,gamePhase:n}=z(),s=Jw(),i=Ke(),{handleTileClick:r,handleUnitClick:o,handleUnitDeselection:l,handleEndTurn:c,handleAttackSelection:d,handleCaptureSelection:m}=on(),u=p.useCallback(g=>{const j=parseInt(g.key,10)-1,N=t[s[j]];N&&(g.preventDefault(),o(N,g))},[t,s,o]),h=p.useCallback(g=>{g.preventDefault(),l()},[l]),y=p.useCallback(g=>{if(!i)return;const j=F(e,i.id);if(!j)return;let N=null;switch(g.key){case"w":N={q:j.q,r:j.r-1};break;case"e":N={q:j.q+1,r:j.r-1};break;case"a":N={q:j.q-1,r:j.r};break;case"s":N={q:j.q,r:j.r};break;case"d":N={q:j.q+1,r:j.r};break;case"z":N={q:j.q-1,r:j.r+1};break;case"x":N={q:j.q,r:j.r+1};break}if(!N)return;const T=On(N,e);if(!T)return;const $=Nm(N,e,t);g.preventDefault(),r(T,$??void 0,g)},[r,i,e,t]),x=p.useCallback(g=>{g.preventDefault(),c()},[c]),f=p.useCallback(g=>{if(!i)return;if(g.key==="j"&&q(i)){m();return}const N={j:0,k:1,l:2,";":3}[g.key];if(N===void 0)return;const T=i.attacks[N];T&&(g.preventDefault(),d(T))},[d,m,i]),v=p.useCallback(g=>{g.preventDefault(),document.getElementById("chat-input")?.focus()},[]);return{handleKeyDown:p.useCallback(g=>{if(n!==be.UNIT_PLACEMENT)switch(g.key){case"Escape":{h(g);break}case"Enter":x(g);break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{u(g);break}case"w":case"e":case"a":case"s":case"d":case"z":case"x":y(g);break;case"j":case"k":case"l":case";":f(g);break;case"/":v(g);break;default:return}},[u,h,y,x,f,v,n])}},Na=""+new URL("battle-canvas-DZEjqFjk.png",import.meta.url).href,Hk=()=>{const{gamePhase:e}=z();Wk();const{handleKeyDown:t}=Gk();return p.useEffect(()=>(document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}),[t]),a.jsxs(a.Fragment,{children:[e===be.UNIT_PLACEMENT&&a.jsx(Rk,{}),e!==be.UNIT_PLACEMENT&&a.jsxs("div",{className:"flex h-screen min-h-screen bg-cover bg-center bg-no-repeat bg-fixed bg-black",tabIndex:-1,style:{backgroundImage:`url(${Na})`},children:[a.jsx("div",{className:"flex-1 flex flex-col",children:a.jsx($k,{})}),a.jsx("div",{className:"w-96 overflow-y-auto absolute top-0 left-0 max-h-full",children:a.jsx(_k,{})}),a.jsxs("div",{className:"w-96 overflow-y-auto absolute top-0 right-0 max-h-full",children:[a.jsx(ok,{}),a.jsx(Lk,{})]})]})]})},Vk=()=>{const{captures:e,currentPlayerId:t}=z(),n=Dn(t);return e.length===0?null:a.jsx("div",{className:"card bg-base-200 border border-base-300 mb-8",children:a.jsxs("div",{className:"card-body",children:[a.jsx("h3",{className:"card-title text-xl mb-4 justify-center",children:"Captures"}),a.jsx("div",{className:"space-y-4",children:e.map((s,i)=>{const r=n.find(c=>c.id===s);if(!r)return null;const o=H(r.unitType),l=Ve(r.attacks);return a.jsx("div",{className:"card bg-base-100 border border-base-300",children:a.jsx("div",{className:"card-body p-4",children:a.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("div",{className:"w-24 h-24 mx-auto lg:mx-0",children:a.jsx("img",{src:o.headshotImage,alt:o.name,className:"w-full h-full object-contain rounded-lg border border-base-300"})})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-xl text-primary mb-1",children:r.name}),a.jsx("p",{className:"text-sm text-base-content/70 capitalize",children:o.name})]}),a.jsx("div",{className:"badge badge-lg badge-success",children:"Captured"})]}),a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 mb-4",children:[a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Level"}),a.jsx("span",{className:"font-semibold text-lg",children:r.level})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Max Health"}),a.jsx("span",{className:"font-semibold text-lg text-success",children:r.maxHealth})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Attack"}),a.jsx("span",{className:"font-semibold text-lg text-error",children:r.attack})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide mb-1",children:"Defense"}),a.jsx("span",{className:"font-semibold text-lg text-info",children:r.defense})]})]}),a.jsxs("div",{children:[a.jsx("h5",{className:"font-medium text-base mb-2 text-base-content/90",children:"Attacks"}),a.jsx("div",{className:"space-y-2",children:l.map(c=>a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between p-3 bg-base-200 rounded-lg border border-base-300",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h6",{className:"font-medium text-sm text-primary mb-1",children:c.name}),a.jsx("p",{className:"text-xs text-base-content/70 mb-2",children:c.description})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"badge badge-outline badge-sm",children:[c.power[0],"d",c.power[1]]}),a.jsx("div",{className:"badge badge-ghost badge-sm",children:c.pattern.needsTarget?"Targeted":"Area"})]})]},c.id))})]})]})]})})},`${s}-${i}`)})})]})})},Yk=()=>{const{units:e,experienceGains:t}=z(),n=t.filter(s=>{const i=e[s.unitId];return i&&i.unitType!=="trainer"&&s.experience>0});return n.length===0?null:a.jsx("div",{className:"card bg-base-200 border border-base-300 mb-8",children:a.jsxs("div",{className:"card-body",children:[a.jsx("h3",{className:"card-title text-xl mb-4 justify-center",children:"Experience Breakdown"}),a.jsx("div",{className:"space-y-4",children:n.map(s=>{const i=e[s.unitId];return i?a.jsx("div",{className:"card bg-base-100 border border-base-300",children:a.jsx("div",{className:"card-body p-4",children:a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-semibold text-lg text-primary mb-2",children:i.name}),a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 text-sm",children:[a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide",children:"Kills"}),a.jsx("span",{className:"font-medium text-base-content",children:s.kills})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide",children:"Experience"}),a.jsxs("span",{className:"font-medium text-success",children:[s.experience," XP"]})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide",children:"Status"}),a.jsx("span",{className:`font-medium ${s.survived?"text-success":"text-error"}`,children:s.survived?"Survived":"Fallen"})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-base-content/70 text-xs uppercase tracking-wide",children:"Unit Type"}),a.jsx("span",{className:"font-medium text-accent capitalize",children:i.unitType})]})]})]}),a.jsx("div",{className:"flex-shrink-0",children:a.jsx("div",{className:`badge badge-lg ${s.survived?"badge-success":"badge-error"}`,children:s.survived?"Alive":"Defeated"})})]})})},s.unitId):null})})]})})},$s=4,Kk=({levelUpUnit:e,onClose:t})=>{const{learnAttack:n,forgetAttack:s}=rn(),i=ha(e.playerId,e.unitId),[r,o]=p.useState(null),[l,c]=p.useState(null);if(!i)return null;const d=i.attacks.length<$s,m=!d&&e.availableAttacks.length>0,u=()=>{r&&(d?n(e.playerId,e.unitId,r):l&&(s(e.playerId,e.unitId,l),n(e.playerId,e.unitId,r)),t())},h=()=>{t()},y=x=>Ue(x).description;return a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsx("div",{className:"card card-bg-paper shadow-xl max-w-2xl w-full",children:a.jsxs("div",{className:"card-body p-8",children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Learn New Attack"}),a.jsxs("p",{className:"text-lg text-base-content/70",children:[a.jsx("span",{className:"font-semibold",children:i.name})," can learn a new attack!"]})]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("h3",{className:"text-xl font-semibold mb-4",children:["Current Attacks (",i.attacks.length,"/",$s,")"]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:i.attacks.map(x=>a.jsx("div",{className:`card inset-shadow-sm bg-black/5 border cursor-pointer transition-all ${l===x?"border-error bg-error/10":m?"border-transparent hover:border-error/50":"border-transparent"}`,onClick:()=>m&&c(x),children:a.jsxs("div",{className:"card-body p-3",children:[a.jsx("h4",{className:"card-title text-sm",children:x}),a.jsx("p",{className:"text-xs text-base-content/70",children:y(x)}),m&&a.jsx("p",{className:"text-xs text-error mt-1",children:l===x?"Selected for replacement":"Click to replace"})]})},x))})]}),e.availableAttacks.length>0&&a.jsxs("div",{className:"mb-6",children:[a.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Available to Learn"}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:e.availableAttacks.map(x=>a.jsx("div",{className:`card inset-shadow-sm bg-black/5 border cursor-pointer transition-all ${r===x?"border-neutral bg-neutral/10":"border-transparent hover:border-transparent/50"}`,onClick:()=>o(x),children:a.jsxs("div",{className:"card-body p-3",children:[a.jsx("h4",{className:"card-title text-sm",children:x}),a.jsx("p",{className:"text-xs text-base-content/70",children:y(x)}),r===x&&a.jsx("p",{className:"text-xs mt-1",children:"Selected to learn"})]})},x))})]}),a.jsx("div",{className:"text-sm mb-6",children:d?a.jsx("p",{children:"Select an attack to learn. You have available attack slots."}):m?a.jsx("p",{children:"Your attack slots are full. Select an attack to learn and an existing attack to replace."}):a.jsx("p",{children:"No new attacks are available to learn at this level."})}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[a.jsx("button",{className:"btn btn-neutral btn-lg btn-outline",onClick:u,disabled:!r||m&&!l,children:"Learn Attack"}),a.jsx("button",{className:"btn btn-neutral btn-ghost btn-lg",onClick:h,children:"Skip"})]})]})})})},zk=({levelUpUnit:e})=>{const{applyLevelUp:t}=rn(),n=ha(e.playerId,e.unitId),[s,i]=p.useState(!1);if(!e||!n)return null;const r=()=>{t(e)},o=()=>{i(!0)},l=()=>{i(!1)};return a.jsxs("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:[a.jsx("div",{className:"card card-bg-paper shadow-xl max-w-lg w-full",children:a.jsxs("div",{className:"card-body p-8",children:[a.jsx("div",{className:"text-center mb-6",children:a.jsxs("p",{className:"text-lg text-base-content/70",children:[a.jsx("span",{className:"font-semibold",children:n.name})," has reached level"," ",a.jsx("span",{className:"font-semibold",children:e.newLevel}),"!"]})}),a.jsx("div",{className:"card mb-6",children:a.jsxs("div",{className:"card-body p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h3",{className:"card-title text-lg text-base-content",children:n.name}),a.jsx("div",{className:"badge badge-neutral badge-outline capitalize",children:n.unitType})]}),a.jsxs("div",{className:"stats stats-horizontal shadow",children:[a.jsxs("div",{className:"stat",children:[a.jsx("div",{className:"stat-title text-xs",children:"Current Level"}),a.jsx("div",{className:"stat-value text-lg text-neutral",children:n.level})]}),a.jsxs("div",{className:"stat",children:[a.jsx("div",{className:"stat-title text-xs",children:"New Level"}),a.jsx("div",{className:"stat-value text-lg text-neutral",children:e.newLevel})]}),a.jsxs("div",{className:"stat",children:[a.jsx("div",{className:"stat-title text-xs",children:"Available Points"}),a.jsx("div",{className:"stat-value text-lg text-neutral",children:e.availablePoints})]})]})]})}),e.availableAttacks.length>0&&a.jsxs("div",{className:"mb-6",children:[a.jsx("h3",{className:"text-xl font-semibold mb-4 text-center",children:"New Attacks Available"}),a.jsx("div",{className:"card mb-4",children:a.jsxs("div",{className:"card-body p-4",children:[a.jsxs("p",{className:"text-center text-neutral mb-3",children:[e.availableAttacks.length," new attack",e.availableAttacks.length>1?"s":""," can be learned!"]}),a.jsx("div",{className:"flex justify-center",children:a.jsx("button",{className:"btn btn-secondary btn-sm",onClick:o,children:"Choose Attack"})})]})})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("h3",{className:"text-xl font-semibold mb-4 text-center",children:"Stat Improvements"}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"card inset-shadow-sm bg-black/5",children:a.jsx("div",{className:"card-body p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-3 h-3 bg-neutral rounded-full"}),a.jsx("span",{className:"font-semibold text-lg",children:"Health"})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"text-sm text-base-content/70 mb-1",children:"Current → New"}),a.jsxs("div",{className:"text-lg font-mono",children:[a.jsx("span",{className:"text-base-content/50",children:n.maxHealth}),a.jsx("span",{className:"text-base-content/50 mx-2",children:"→"}),a.jsx("span",{className:"text-base-content font-bold",children:n.maxHealth+e.statAllocation.health})]})]})]})})}),a.jsx("div",{className:"card inset-shadow-sm bg-black/5",children:a.jsx("div",{className:"card-body p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-3 h-3 bg-neutral rounded-full"}),a.jsx("span",{className:"font-semibold text-lg",children:"Attack"})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"text-sm text-base-content/70 mb-1",children:"Current → New"}),a.jsxs("div",{className:"text-lg font-mono",children:[a.jsx("span",{className:"text-base-content/50",children:n.attack}),a.jsx("span",{className:"text-base-content/50 mx-2",children:"→"}),a.jsx("span",{className:"text-base-content font-bold",children:n.attack+e.statAllocation.attack})]})]})]})})}),a.jsx("div",{className:"card inset-shadow-sm bg-black/5",children:a.jsx("div",{className:"card-body p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-3 h-3 bg-neutral rounded-full"}),a.jsx("span",{className:"font-semibold text-lg",children:"Defense"})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"text-sm text-base-content/70 mb-1",children:"Current → New"}),a.jsxs("div",{className:"text-lg font-mono",children:[a.jsx("span",{className:"text-base-content/50",children:n.defense}),a.jsx("span",{className:"text-base-content/50 mx-2",children:"→"}),a.jsx("span",{className:"text-base-content font-bold",children:n.defense+e.statAllocation.defense})]})]})]})})})]})]}),a.jsx("div",{className:"flex justify-center",children:a.jsx("button",{className:"btn btn-neutral btn-lg btn-outline",onClick:r,children:"Confirm"})})]})}),s&&a.jsx(Kk,{levelUpUnit:e,onClose:l})]})},Jk=()=>{const{startOverworld:e}=qe(),{winner:t}=z(),n=Nw(),s=$n(1),i=$n(2);if(!t)throw new Error("No winner found");const r=(h,y,x)=>{switch(h){case le.TRAINER_DEFEATED:return`${x}'s trainer was defeated in battle`;case le.ALL_UNITS_DEFEATED:return`${x}'s army was completely destroyed`;case le.SURRENDER:return`${x} surrendered the battle`;default:return"The battle has ended"}},o=s.filter(h=>h.health>0).length,l=i.filter(h=>h.health>0).length,c=s.length+i.length,d=o+l,m=()=>{e()},u=()=>{if(t.condition===le.DRAW)return a.jsxs("div",{className:"mt-6",children:[a.jsx("h2",{className:"text-3xl font-bold mb-2",children:"It's a Draw!"}),a.jsx("p",{className:"text-lg text-base-content/70",children:"Both armies were destroyed simultaneously"})]});const h=t.playerId===1?"Player 1":"Player 2",y=t.playerId===1?"Player 2":"Player 1";return a.jsxs("div",{className:"mt-6",children:[a.jsxs("h2",{className:"text-3xl font-bold mb-2",children:[h," Wins!"]}),a.jsx("p",{className:"text-lg text-base-content/70",children:r(t.condition,h,y)})]})};return a.jsxs("div",{className:"flex h-screen min-h-screen bg-cover bg-center bg-no-repeat bg-fixed bg-black justify-center items-center",style:{backgroundImage:`url(${Na})`},children:[a.jsx("div",{className:"card card-bg-paper shadow-xl max-w-2xl w-full",children:a.jsxs("div",{className:"card-body p-8",children:[a.jsxs("div",{className:"mb-8 text-center",children:[a.jsx("h1",{className:"text-4xl font-bold mb-4",children:"Battle Complete!"}),a.jsx("div",{className:"divider"}),u()]}),a.jsx("div",{className:"card mb-8 text-center",children:a.jsx("div",{className:"card-body",children:a.jsxs("div",{className:"stats stats-vertical lg:stats-horizontal shadow",children:[a.jsxs("div",{className:"stat",children:[a.jsx("div",{className:"stat-title",children:"Total Units"}),a.jsx("div",{className:"stat-value text-neutral",children:c})]}),a.jsxs("div",{className:"stat",children:[a.jsx("div",{className:"stat-title",children:"Survivors"}),a.jsx("div",{className:"stat-value text-neutral",children:d})]}),a.jsxs("div",{className:"stat",children:[a.jsx("div",{className:"stat-title",children:"Player 1 Survivors"}),a.jsx("div",{className:"stat-value text-neutral",children:o})]}),a.jsxs("div",{className:"stat",children:[a.jsx("div",{className:"stat-title",children:"Player 2 Survivors"}),a.jsx("div",{className:"stat-value text-neutral",children:l})]})]})})}),a.jsx(Yk,{}),a.jsx(Vk,{}),a.jsx("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:a.jsx("button",{className:"btn btn-neutral btn-outline btn-lg",onClick:m,children:"Continue to Overworld"})})]})}),n&&a.jsx(zk,{levelUpUnit:n})]})},Qk=()=>{const{startOverworld:e}=qe(),{seenUnitTypes:t}=Te(),n=Pk(),[s,i]=p.useState("all"),[r,o]=p.useState("all"),[l,c]=p.useState("all"),[d,m]=p.useState(""),u=p.useMemo(()=>{const w=[],g=new Map;return Object.entries(t).forEach(([j,N])=>{N.forEach(T=>{g.has(T)||g.set(T,new Set),g.get(T).add(j)})}),g.forEach((j,N)=>{w.push({unitType:N,locationsSeen:Array.from(j)})}),w},[t]),h=p.useMemo(()=>u.filter(w=>{const g=H(w.unitType);return!(s!=="all"&&g.family!==s||r!=="all"&&g.affinity!==r||l!=="all"&&!w.locationsSeen.includes(l)||d&&!g.name.toLowerCase().includes(d.toLowerCase()))}),[u,s,r,l,d]),y=w=>{if(w==="no-location")return"Acquired";const g=n.locations.find(j=>j.id===w);return g?g.name:w},x=p.useMemo(()=>{const w=new Set;return u.forEach(g=>{w.add(H(g.unitType).family)}),Array.from(w).sort()},[u]),f=p.useMemo(()=>{const w=new Set;return u.forEach(g=>{w.add(H(g.unitType).affinity)}),Array.from(w).sort()},[u]),v=p.useMemo(()=>{const w=new Set;return u.forEach(g=>{g.locationsSeen.forEach(j=>{w.add(j)})}),Array.from(w).sort()},[u]);return a.jsxs("div",{className:"flex h-full min-h-screen bg-cover bg-center bg-no-repeat bg-fixed bg-black",style:{backgroundImage:`url(${Wn})`},children:[a.jsxs("div",{className:"w-80 p-4 space-y-6",children:[a.jsx("div",{className:"card card-bg-paper shadow-xl",children:a.jsxs("div",{className:"card-body",children:[a.jsx("h2",{className:"card-title text-2xl font-bold",children:"Bestiary"}),a.jsxs("p",{className:"text-sm text-base-content/70",children:["Discovered Wildlight: ",u.length]})]})}),a.jsx("div",{className:"card card-bg-paper shadow-xl",children:a.jsx("div",{className:"card-body space-y-2",children:a.jsx("button",{className:"btn btn-block btn-neutral btn-outline",onClick:()=>e(),children:"Return to Overworld"})})})]}),a.jsxs("div",{className:"flex-1 p-4",children:[a.jsxs("div",{className:"mb-6 space-y-4",children:[a.jsx("div",{className:"card card-bg-paper shadow-xl",children:a.jsxs("div",{className:"card-body",children:[a.jsx("h3",{className:"font-semibold mb-2",children:"Search"}),a.jsx("input",{type:"text",placeholder:"Search by name...",className:"input input-bordered w-full bg-transparent border-black",value:d,onChange:w=>m(w.target.value)})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx("div",{className:"card card-bg-paper shadow-xl",children:a.jsxs("div",{className:"card-body",children:[a.jsx("h3",{className:"font-semibold mb-2",children:"Family"}),a.jsxs("select",{className:"select select-bordered w-full bg-transparent border-black",value:s,onChange:w=>i(w.target.value),children:[a.jsx("option",{value:"all",children:"All Families"}),x.map(w=>a.jsx("option",{value:w,children:w.charAt(0).toUpperCase()+w.slice(1)},w))]})]})}),a.jsx("div",{className:"card card-bg-paper shadow-xl",children:a.jsxs("div",{className:"card-body",children:[a.jsx("h3",{className:"font-semibold mb-2",children:"Affinity"}),a.jsxs("select",{className:"select select-bordered w-full bg-transparent border-black",value:r,onChange:w=>o(w.target.value),children:[a.jsx("option",{value:"all",children:"All Affinities"}),f.map(w=>a.jsx("option",{value:w,children:w.charAt(0).toUpperCase()+w.slice(1)},w))]})]})}),a.jsx("div",{className:"card card-bg-paper shadow-xl",children:a.jsxs("div",{className:"card-body",children:[a.jsx("h3",{className:"font-semibold mb-2",children:"Location Seen"}),a.jsxs("select",{className:"select select-bordered w-full bg-transparent border-black",value:l,onChange:w=>c(w.target.value),children:[a.jsx("option",{value:"all",children:"All Locations"}),v.map(w=>a.jsx("option",{value:w,children:y(w)},w))]})]})})]})]}),a.jsx("div",{className:"overflow-y-auto",children:h.length===0?a.jsx("div",{className:"card card-bg-paper shadow-xl flex items-center justify-center h-64",children:a.jsxs("div",{className:"card-body text-center",children:[a.jsx("div",{className:"text-6xl mb-4",children:"📖"}),a.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No Wildlight Found"}),a.jsx("p",{className:"text-base-content/70",children:u.length===0?"Explore the world to discover Wildlight!":"Try adjusting your filters to see more results."})]})}):a.jsx("div",{className:"space-y-4",children:h.map(w=>{const g=H(w.unitType);return a.jsx("div",{className:"card card-bg-paper shadow-xl",children:a.jsx("div",{className:"card-body",children:a.jsxs("div",{className:"flex items-start gap-4",children:[a.jsx("figure",{className:"flex-shrink-0",children:a.jsx("img",{src:g.bestiaryImage,alt:g.name,className:"size-50 object-cover rounded-lg",onError:j=>{j.currentTarget.style.display="none"}})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsx("h3",{className:"card-title text-xl",children:g.name}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("span",{className:"badge badge-outline",children:g.family.charAt(0).toUpperCase()+g.family.slice(1)}),a.jsx("span",{className:"badge badge-outline",children:g.affinity.charAt(0).toUpperCase()+g.affinity.slice(1)})]})]}),a.jsxs("div",{className:"text-sm text-base-content/70 mb-3",children:[a.jsxs("div",{className:"flex flex-wrap gap-1 mb-1",children:[g.movement.canWalk&&a.jsx("span",{className:"badge badge-ghost badge-sm",children:"Walk"}),g.movement.canSwim&&a.jsx("span",{className:"badge badge-ghost badge-sm",children:"Swim"}),g.movement.canClimb&&a.jsx("span",{className:"badge badge-ghost badge-sm",children:"Climb"}),g.movement.canFly&&a.jsx("span",{className:"badge badge-ghost badge-sm",children:"Fly"})]}),a.jsxs("div",{children:["Range: ",g.movement.range]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-sm mb-1",children:"Seen in:"}),a.jsx("div",{className:"flex flex-wrap gap-1",children:w.locationsSeen.map(j=>a.jsx("span",{className:"badge badge-primary badge-sm",children:y(j)},j))})]})]})]})})},w.unitType)})})})]})]})},Gn=Symbol.for("yaml.alias"),_n=Symbol.for("yaml.document"),Ae=Symbol.for("yaml.map"),$a=Symbol.for("yaml.pair"),ln=Symbol.for("yaml.scalar"),dt=Symbol.for("yaml.seq"),he=Symbol.for("yaml.node.type"),ze=e=>!!e&&typeof e=="object"&&e[he]===Gn,It=e=>!!e&&typeof e=="object"&&e[he]===_n,Tt=e=>!!e&&typeof e=="object"&&e[he]===Ae,Z=e=>!!e&&typeof e=="object"&&e[he]===$a,Y=e=>!!e&&typeof e=="object"&&e[he]===ln,Ct=e=>!!e&&typeof e=="object"&&e[he]===dt;function Q(e){if(e&&typeof e=="object")switch(e[he]){case Ae:case dt:return!0}return!1}function X(e){if(e&&typeof e=="object")switch(e[he]){case Gn:case Ae:case ln:case dt:return!0}return!1}const _a=e=>(Y(e)||Q(e))&&!!e.anchor,Re=Symbol("break visit"),Xk=Symbol("skip children"),xt=Symbol("remove node");function ut(e,t){const n=Zk(t);It(e)?Ze(null,e.contents,n,Object.freeze([e]))===xt&&(e.contents=null):Ze(null,e,n,Object.freeze([]))}ut.BREAK=Re;ut.SKIP=Xk;ut.REMOVE=xt;function Ze(e,t,n,s){const i=ej(e,t,n,s);if(X(i)||Z(i))return tj(e,s,i),Ze(e,i,n,s);if(typeof i!="symbol"){if(Q(t)){s=Object.freeze(s.concat(t));for(let r=0;r<t.items.length;++r){const o=Ze(r,t.items[r],n,s);if(typeof o=="number")r=o-1;else{if(o===Re)return Re;o===xt&&(t.items.splice(r,1),r-=1)}}}else if(Z(t)){s=Object.freeze(s.concat(t));const r=Ze("key",t.key,n,s);if(r===Re)return Re;r===xt&&(t.key=null);const o=Ze("value",t.value,n,s);if(o===Re)return Re;o===xt&&(t.value=null)}}return i}function Zk(e){return typeof e=="object"&&(e.Collection||e.Node||e.Value)?Object.assign({Alias:e.Node,Map:e.Node,Scalar:e.Node,Seq:e.Node},e.Value&&{Map:e.Value,Scalar:e.Value,Seq:e.Value},e.Collection&&{Map:e.Collection,Seq:e.Collection},e):e}function ej(e,t,n,s){if(typeof n=="function")return n(e,t,s);if(Tt(t))return n.Map?.(e,t,s);if(Ct(t))return n.Seq?.(e,t,s);if(Z(t))return n.Pair?.(e,t,s);if(Y(t))return n.Scalar?.(e,t,s);if(ze(t))return n.Alias?.(e,t,s)}function tj(e,t,n){const s=t[t.length-1];if(Q(s))s.items[e]=n;else if(Z(s))e==="key"?s.key=n:s.value=n;else if(It(s))s.contents=n;else{const i=ze(s)?"alias":"scalar";throw new Error(`Cannot replace node with ${i} parent`)}}const nj={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},sj=e=>e.replace(/[!,[\]{}]/g,t=>nj[t]);class re{constructor(t,n){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},re.defaultYaml,t),this.tags=Object.assign({},re.defaultTags,n)}clone(){const t=new re(this.yaml,this.tags);return t.docStart=this.docStart,t}atDocument(){const t=new re(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:re.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},re.defaultTags);break}return t}add(t,n){this.atNextDocument&&(this.yaml={explicit:re.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},re.defaultTags),this.atNextDocument=!1);const s=t.trim().split(/[ \t]+/),i=s.shift();switch(i){case"%TAG":{if(s.length!==2&&(n(0,"%TAG directive should contain exactly two parts"),s.length<2))return!1;const[r,o]=s;return this.tags[r]=o,!0}case"%YAML":{if(this.yaml.explicit=!0,s.length!==1)return n(0,"%YAML directive should contain exactly one part"),!1;const[r]=s;if(r==="1.1"||r==="1.2")return this.yaml.version=r,!0;{const o=/^\d+\.\d+$/.test(r);return n(6,`Unsupported YAML version ${r}`,o),!1}}default:return n(0,`Unknown directive ${i}`,!0),!1}}tagName(t,n){if(t==="!")return"!";if(t[0]!=="!")return n(`Not a valid tag: ${t}`),null;if(t[1]==="<"){const o=t.slice(2,-1);return o==="!"||o==="!!"?(n(`Verbatim tags aren't resolved, so ${t} is invalid.`),null):(t[t.length-1]!==">"&&n("Verbatim tags must end with a >"),o)}const[,s,i]=t.match(/^(.*!)([^!]*)$/s);i||n(`The ${t} tag has no suffix`);const r=this.tags[s];if(r)try{return r+decodeURIComponent(i)}catch(o){return n(String(o)),null}return s==="!"?t:(n(`Could not resolve tag: ${t}`),null)}tagString(t){for(const[n,s]of Object.entries(this.tags))if(t.startsWith(s))return n+sj(t.substring(s.length));return t[0]==="!"?t:`!<${t}>`}toString(t){const n=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],s=Object.entries(this.tags);let i;if(t&&s.length>0&&X(t.contents)){const r={};ut(t.contents,(o,l)=>{X(l)&&l.tag&&(r[l.tag]=!0)}),i=Object.keys(r)}else i=[];for(const[r,o]of s)r==="!!"&&o==="tag:yaml.org,2002:"||(!t||i.some(l=>l.startsWith(o)))&&n.push(`%TAG ${r} ${o}`);return n.join(`
`)}}re.defaultYaml={explicit:!1,version:"1.2"};re.defaultTags={"!!":"tag:yaml.org,2002:"};function Ia(e){if(/[\x00-\x19\s,[\]{}]/.test(e)){const n=`Anchor must not contain whitespace or control characters: ${JSON.stringify(e)}`;throw new Error(n)}return!0}function Ta(e){const t=new Set;return ut(e,{Value(n,s){s.anchor&&t.add(s.anchor)}}),t}function Ca(e,t){for(let n=1;;++n){const s=`${e}${n}`;if(!t.has(s))return s}}function aj(e,t){const n=[],s=new Map;let i=null;return{onAnchor:r=>{n.push(r),i??(i=Ta(e));const o=Ca(t,i);return i.add(o),o},setAnchors:()=>{for(const r of n){const o=s.get(r);if(typeof o=="object"&&o.anchor&&(Y(o.node)||Q(o.node)))o.node.anchor=o.anchor;else{const l=new Error("Failed to resolve repeated object (this should not happen)");throw l.source=r,l}}},sourceObjects:s}}function et(e,t,n,s){if(s&&typeof s=="object")if(Array.isArray(s))for(let i=0,r=s.length;i<r;++i){const o=s[i],l=et(e,s,String(i),o);l===void 0?delete s[i]:l!==o&&(s[i]=l)}else if(s instanceof Map)for(const i of Array.from(s.keys())){const r=s.get(i),o=et(e,s,i,r);o===void 0?s.delete(i):o!==r&&s.set(i,o)}else if(s instanceof Set)for(const i of Array.from(s)){const r=et(e,s,i,i);r===void 0?s.delete(i):r!==i&&(s.delete(i),s.add(r))}else for(const[i,r]of Object.entries(s)){const o=et(e,s,i,r);o===void 0?delete s[i]:o!==r&&(s[i]=o)}return e.call(t,n,s)}function ue(e,t,n){if(Array.isArray(e))return e.map((s,i)=>ue(s,String(i),n));if(e&&typeof e.toJSON=="function"){if(!n||!_a(e))return e.toJSON(t,n);const s={aliasCount:0,count:1,res:void 0};n.anchors.set(e,s),n.onCreate=r=>{s.res=r,delete n.onCreate};const i=e.toJSON(t,n);return n.onCreate&&n.onCreate(i),i}return typeof e=="bigint"&&!n?.keep?Number(e):e}class Hn{constructor(t){Object.defineProperty(this,he,{value:t})}clone(){const t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(t.range=this.range.slice()),t}toJS(t,{mapAsMap:n,maxAliasCount:s,onAnchor:i,reviver:r}={}){if(!It(t))throw new TypeError("A document argument is required");const o={anchors:new Map,doc:t,keep:!0,mapAsMap:n===!0,mapKeyWarned:!1,maxAliasCount:typeof s=="number"?s:100},l=ue(this,"",o);if(typeof i=="function")for(const{count:c,res:d}of o.anchors.values())i(d,c);return typeof r=="function"?et(r,{"":l},"",l):l}}class Ea extends Hn{constructor(t){super(Gn),this.source=t,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(t,n){let s;n?.aliasResolveCache?s=n.aliasResolveCache:(s=[],ut(t,{Node:(r,o)=>{(ze(o)||_a(o))&&s.push(o)}}),n&&(n.aliasResolveCache=s));let i;for(const r of s){if(r===this)break;r.anchor===this.source&&(i=r)}return i}toJSON(t,n){if(!n)return{source:this.source};const{anchors:s,doc:i,maxAliasCount:r}=n,o=this.resolve(i,n);if(!o){const c=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(c)}let l=s.get(o);if(l||(ue(o,null,n),l=s.get(o)),!l||l.res===void 0){const c="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(c)}if(r>=0&&(l.count+=1,l.aliasCount===0&&(l.aliasCount=Dt(i,o,s)),l.count*l.aliasCount>r)){const c="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(c)}return l.res}toString(t,n,s){const i=`*${this.source}`;if(t){if(Ia(this.source),t.options.verifyAliasOrder&&!t.anchors.has(this.source)){const r=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(r)}if(t.implicitKey)return`${i} `}return i}}function Dt(e,t,n){if(ze(t)){const s=t.resolve(e),i=n&&s&&n.get(s);return i?i.count*i.aliasCount:0}else if(Q(t)){let s=0;for(const i of t.items){const r=Dt(e,i,n);r>s&&(s=r)}return s}else if(Z(t)){const s=Dt(e,t.key,n),i=Dt(e,t.value,n);return Math.max(s,i)}return 1}const Sa=e=>!e||typeof e!="function"&&typeof e!="object";class O extends Hn{constructor(t){super(ln),this.value=t}toJSON(t,n){return n?.keep?this.value:ue(this.value,t,n)}toString(){return String(this.value)}}O.BLOCK_FOLDED="BLOCK_FOLDED";O.BLOCK_LITERAL="BLOCK_LITERAL";O.PLAIN="PLAIN";O.QUOTE_DOUBLE="QUOTE_DOUBLE";O.QUOTE_SINGLE="QUOTE_SINGLE";const ij="tag:yaml.org,2002:";function rj(e,t,n){if(t){const s=n.filter(r=>r.tag===t),i=s.find(r=>!r.format)??s[0];if(!i)throw new Error(`Tag ${t} not found`);return i}return n.find(s=>s.identify?.(e)&&!s.format)}function jt(e,t,n){if(It(e)&&(e=e.contents),X(e))return e;if(Z(e)){const u=n.schema[Ae].createNode?.(n.schema,null,n);return u.items.push(e),u}(e instanceof String||e instanceof Number||e instanceof Boolean||typeof BigInt<"u"&&e instanceof BigInt)&&(e=e.valueOf());const{aliasDuplicateObjects:s,onAnchor:i,onTagObj:r,schema:o,sourceObjects:l}=n;let c;if(s&&e&&typeof e=="object"){if(c=l.get(e),c)return c.anchor??(c.anchor=i(e)),new Ea(c.anchor);c={anchor:null,node:null},l.set(e,c)}t?.startsWith("!!")&&(t=ij+t.slice(2));let d=rj(e,t,o.tags);if(!d){if(e&&typeof e.toJSON=="function"&&(e=e.toJSON()),!e||typeof e!="object"){const u=new O(e);return c&&(c.node=u),u}d=e instanceof Map?o[Ae]:Symbol.iterator in Object(e)?o[dt]:o[Ae]}r&&(r(d),delete n.onTagObj);const m=d?.createNode?d.createNode(n.schema,e,n):typeof d?.nodeClass?.from=="function"?d.nodeClass.from(n.schema,e,n):new O(e);return t?m.tag=t:d.default||(m.tag=d.tag),c&&(c.node=m),m}function Ht(e,t,n){let s=n;for(let i=t.length-1;i>=0;--i){const r=t[i];if(typeof r=="number"&&Number.isInteger(r)&&r>=0){const o=[];o[r]=s,s=o}else s=new Map([[r,s]])}return jt(s,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:e,sourceObjects:new Map})}const bt=e=>e==null||typeof e=="object"&&!!e[Symbol.iterator]().next().done;class Aa extends Hn{constructor(t,n){super(t),Object.defineProperty(this,"schema",{value:n,configurable:!0,enumerable:!1,writable:!0})}clone(t){const n=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return t&&(n.schema=t),n.items=n.items.map(s=>X(s)||Z(s)?s.clone(t):s),this.range&&(n.range=this.range.slice()),n}addIn(t,n){if(bt(t))this.add(n);else{const[s,...i]=t,r=this.get(s,!0);if(Q(r))r.addIn(i,n);else if(r===void 0&&this.schema)this.set(s,Ht(this.schema,i,n));else throw new Error(`Expected YAML collection at ${s}. Remaining path: ${i}`)}}deleteIn(t){const[n,...s]=t;if(s.length===0)return this.delete(n);const i=this.get(n,!0);if(Q(i))return i.deleteIn(s);throw new Error(`Expected YAML collection at ${n}. Remaining path: ${s}`)}getIn(t,n){const[s,...i]=t,r=this.get(s,!0);return i.length===0?!n&&Y(r)?r.value:r:Q(r)?r.getIn(i,n):void 0}hasAllNullValues(t){return this.items.every(n=>{if(!Z(n))return!1;const s=n.value;return s==null||t&&Y(s)&&s.value==null&&!s.commentBefore&&!s.comment&&!s.tag})}hasIn(t){const[n,...s]=t;if(s.length===0)return this.has(n);const i=this.get(n,!0);return Q(i)?i.hasIn(s):!1}setIn(t,n){const[s,...i]=t;if(i.length===0)this.set(s,n);else{const r=this.get(s,!0);if(Q(r))r.setIn(i,n);else if(r===void 0&&this.schema)this.set(s,Ht(this.schema,i,n));else throw new Error(`Expected YAML collection at ${s}. Remaining path: ${i}`)}}}const oj=e=>e.replace(/^(?!$)(?: $)?/gm,"#");function je(e,t){return/^\n+$/.test(e)?e.substring(1):t?e.replace(/^(?! *$)/gm,t):e}const Fe=(e,t,n)=>e.endsWith(`
`)?je(n,t):n.includes(`
`)?`
`+je(n,t):(e.endsWith(" ")?"":" ")+n,La="flow",In="block",Bt="quoted";function cn(e,t,n="flow",{indentAtStart:s,lineWidth:i=80,minContentWidth:r=20,onFold:o,onOverflow:l}={}){if(!i||i<0)return e;i<r&&(r=0);const c=Math.max(1+r,1+i-t.length);if(e.length<=c)return e;const d=[],m={};let u=i-t.length;typeof s=="number"&&(s>i-Math.max(2,r)?d.push(0):u=i-s);let h,y,x=!1,f=-1,v=-1,w=-1;n===In&&(f=_s(e,f,t.length),f!==-1&&(u=f+c));for(let j;j=e[f+=1];){if(n===Bt&&j==="\\"){switch(v=f,e[f+1]){case"x":f+=3;break;case"u":f+=5;break;case"U":f+=9;break;default:f+=1}w=f}if(j===`
`)n===In&&(f=_s(e,f,t.length)),u=f+t.length+c,h=void 0;else{if(j===" "&&y&&y!==" "&&y!==`
`&&y!=="	"){const N=e[f+1];N&&N!==" "&&N!==`
`&&N!=="	"&&(h=f)}if(f>=u)if(h)d.push(h),u=h+c,h=void 0;else if(n===Bt){for(;y===" "||y==="	";)y=j,j=e[f+=1],x=!0;const N=f>w+1?f-2:v-1;if(m[N])return e;d.push(N),m[N]=!0,u=N+c,h=void 0}else x=!0}y=j}if(x&&l&&l(),d.length===0)return e;o&&o();let g=e.slice(0,d[0]);for(let j=0;j<d.length;++j){const N=d[j],T=d[j+1]||e.length;N===0?g=`
${t}${e.slice(0,T)}`:(n===Bt&&m[N]&&(g+=`${e[N]}\\`),g+=`
${t}${e.slice(N+1,T)}`)}return g}function _s(e,t,n){let s=t,i=t+1,r=e[i];for(;r===" "||r==="	";)if(t<i+n)r=e[++t];else{do r=e[++t];while(r&&r!==`
`);s=t,i=t+1,r=e[i]}return s}const dn=(e,t)=>({indentAtStart:t?e.indent.length:e.indentAtStart,lineWidth:e.options.lineWidth,minContentWidth:e.options.minContentWidth}),un=e=>/^(%|---|\.\.\.)/m.test(e);function lj(e,t,n){if(!t||t<0)return!1;const s=t-n,i=e.length;if(i<=s)return!1;for(let r=0,o=0;r<i;++r)if(e[r]===`
`){if(r-o>s)return!0;if(o=r+1,i-o<=s)return!1}return!0}function vt(e,t){const n=JSON.stringify(e);if(t.options.doubleQuotedAsJSON)return n;const{implicitKey:s}=t,i=t.options.doubleQuotedMinMultiLineLength,r=t.indent||(un(e)?"  ":"");let o="",l=0;for(let c=0,d=n[c];d;d=n[++c])if(d===" "&&n[c+1]==="\\"&&n[c+2]==="n"&&(o+=n.slice(l,c)+"\\ ",c+=1,l=c,d="\\"),d==="\\")switch(n[c+1]){case"u":{o+=n.slice(l,c);const m=n.substr(c+2,4);switch(m){case"0000":o+="\\0";break;case"0007":o+="\\a";break;case"000b":o+="\\v";break;case"001b":o+="\\e";break;case"0085":o+="\\N";break;case"00a0":o+="\\_";break;case"2028":o+="\\L";break;case"2029":o+="\\P";break;default:m.substr(0,2)==="00"?o+="\\x"+m.substr(2):o+=n.substr(c,6)}c+=5,l=c+1}break;case"n":if(s||n[c+2]==='"'||n.length<i)c+=1;else{for(o+=n.slice(l,c)+`

`;n[c+2]==="\\"&&n[c+3]==="n"&&n[c+4]!=='"';)o+=`
`,c+=2;o+=r,n[c+2]===" "&&(o+="\\"),c+=1,l=c+1}break;default:c+=1}return o=l?o+n.slice(l):n,s?o:cn(o,r,Bt,dn(t,!1))}function Tn(e,t){if(t.options.singleQuote===!1||t.implicitKey&&e.includes(`
`)||/[ \t]\n|\n[ \t]/.test(e))return vt(e,t);const n=t.indent||(un(e)?"  ":""),s="'"+e.replace(/'/g,"''").replace(/\n+/g,`$&
${n}`)+"'";return t.implicitKey?s:cn(s,n,La,dn(t,!1))}function tt(e,t){const{singleQuote:n}=t.options;let s;if(n===!1)s=vt;else{const i=e.includes('"'),r=e.includes("'");i&&!r?s=Tn:r&&!i?s=vt:s=n?Tn:vt}return s(e,t)}let Cn;try{Cn=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch{Cn=/\n+(?!\n|$)/g}function Wt({comment:e,type:t,value:n},s,i,r){const{blockQuote:o,commentString:l,lineWidth:c}=s.options;if(!o||/\n[\t ]+$/.test(n))return tt(n,s);const d=s.indent||(s.forceBlockIndent||un(n)?"  ":""),m=o==="literal"?!0:o==="folded"||t===O.BLOCK_FOLDED?!1:t===O.BLOCK_LITERAL?!0:!lj(n,c,d.length);if(!n)return m?`|
`:`>
`;let u,h;for(h=n.length;h>0;--h){const T=n[h-1];if(T!==`
`&&T!=="	"&&T!==" ")break}let y=n.substring(h);const x=y.indexOf(`
`);x===-1?u="-":n===y||x!==y.length-1?(u="+",r&&r()):u="",y&&(n=n.slice(0,-y.length),y[y.length-1]===`
`&&(y=y.slice(0,-1)),y=y.replace(Cn,`$&${d}`));let f=!1,v,w=-1;for(v=0;v<n.length;++v){const T=n[v];if(T===" ")f=!0;else if(T===`
`)w=v;else break}let g=n.substring(0,w<v?w+1:v);g&&(n=n.substring(g.length),g=g.replace(/\n+/g,`$&${d}`));let N=(f?d?"2":"1":"")+u;if(e&&(N+=" "+l(e.replace(/ ?[\r\n]+/g," ")),i&&i()),!m){const T=n.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${d}`);let $=!1;const P=dn(s,!0);o!=="folded"&&t!==O.BLOCK_FOLDED&&(P.onOverflow=()=>{$=!0});const b=cn(`${g}${T}${y}`,d,In,P);if(!$)return`>${N}
${d}${b}`}return n=n.replace(/\n+/g,`$&${d}`),`|${N}
${d}${g}${n}${y}`}function cj(e,t,n,s){const{type:i,value:r}=e,{actualString:o,implicitKey:l,indent:c,indentStep:d,inFlow:m}=t;if(l&&r.includes(`
`)||m&&/[[\]{},]/.test(r))return tt(r,t);if(/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(r))return l||m||!r.includes(`
`)?tt(r,t):Wt(e,t,n,s);if(!l&&!m&&i!==O.PLAIN&&r.includes(`
`))return Wt(e,t,n,s);if(un(r)){if(c==="")return t.forceBlockIndent=!0,Wt(e,t,n,s);if(l&&c===d)return tt(r,t)}const u=r.replace(/\n+/g,`$&
${c}`);if(o){const h=f=>f.default&&f.tag!=="tag:yaml.org,2002:str"&&f.test?.test(u),{compat:y,tags:x}=t.doc.schema;if(x.some(h)||y?.some(h))return tt(r,t)}return l?u:cn(u,c,La,dn(t,!1))}function Vn(e,t,n,s){const{implicitKey:i,inFlow:r}=t,o=typeof e.value=="string"?e:Object.assign({},e,{value:String(e.value)});let{type:l}=e;l!==O.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(o.value)&&(l=O.QUOTE_DOUBLE);const c=m=>{switch(m){case O.BLOCK_FOLDED:case O.BLOCK_LITERAL:return i||r?tt(o.value,t):Wt(o,t,n,s);case O.QUOTE_DOUBLE:return vt(o.value,t);case O.QUOTE_SINGLE:return Tn(o.value,t);case O.PLAIN:return cj(o,t,n,s);default:return null}};let d=c(l);if(d===null){const{defaultKeyType:m,defaultStringType:u}=t.options,h=i&&m||u;if(d=c(h),d===null)throw new Error(`Unsupported default string type ${h}`)}return d}function Ua(e,t){const n=Object.assign({blockQuote:!0,commentString:oj,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},e.schema.toStringOptions,t);let s;switch(n.collectionStyle){case"block":s=!1;break;case"flow":s=!0;break;default:s=null}return{anchors:new Set,doc:e,flowCollectionPadding:n.flowCollectionPadding?" ":"",indent:"",indentStep:typeof n.indent=="number"?" ".repeat(n.indent):"  ",inFlow:s,options:n}}function dj(e,t){if(t.tag){const i=e.filter(r=>r.tag===t.tag);if(i.length>0)return i.find(r=>r.format===t.format)??i[0]}let n,s;if(Y(t)){s=t.value;let i=e.filter(r=>r.identify?.(s));if(i.length>1){const r=i.filter(o=>o.test);r.length>0&&(i=r)}n=i.find(r=>r.format===t.format)??i.find(r=>!r.format)}else s=t,n=e.find(i=>i.nodeClass&&s instanceof i.nodeClass);if(!n){const i=s?.constructor?.name??(s===null?"null":typeof s);throw new Error(`Tag not resolved for ${i} value`)}return n}function uj(e,t,{anchors:n,doc:s}){if(!s.directives)return"";const i=[],r=(Y(e)||Q(e))&&e.anchor;r&&Ia(r)&&(n.add(r),i.push(`&${r}`));const o=e.tag??(t.default?null:t.tag);return o&&i.push(s.directives.tagString(o)),i.join(" ")}function rt(e,t,n,s){if(Z(e))return e.toString(t,n,s);if(ze(e)){if(t.doc.directives)return e.toString(t);if(t.resolvedAliases?.has(e))throw new TypeError("Cannot stringify circular structure without alias nodes");t.resolvedAliases?t.resolvedAliases.add(e):t.resolvedAliases=new Set([e]),e=e.resolve(t.doc)}let i;const r=X(e)?e:t.doc.createNode(e,{onTagObj:c=>i=c});i??(i=dj(t.doc.schema.tags,r));const o=uj(r,i,t);o.length>0&&(t.indentAtStart=(t.indentAtStart??0)+o.length+1);const l=typeof i.stringify=="function"?i.stringify(r,t,n,s):Y(r)?Vn(r,t,n,s):r.toString(t,n,s);return o?Y(r)||l[0]==="{"||l[0]==="["?`${o} ${l}`:`${o}
${t.indent}${l}`:l}function mj({key:e,value:t},n,s,i){const{allNullValues:r,doc:o,indent:l,indentStep:c,options:{commentString:d,indentSeq:m,simpleKeys:u}}=n;let h=X(e)&&e.comment||null;if(u){if(h)throw new Error("With simple keys, key nodes cannot have comments");if(Q(e)||!X(e)&&typeof e=="object"){const P="With simple keys, collection cannot be used as a key value";throw new Error(P)}}let y=!u&&(!e||h&&t==null&&!n.inFlow||Q(e)||(Y(e)?e.type===O.BLOCK_FOLDED||e.type===O.BLOCK_LITERAL:typeof e=="object"));n=Object.assign({},n,{allNullValues:!1,implicitKey:!y&&(u||!r),indent:l+c});let x=!1,f=!1,v=rt(e,n,()=>x=!0,()=>f=!0);if(!y&&!n.inFlow&&v.length>1024){if(u)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");y=!0}if(n.inFlow){if(r||t==null)return x&&s&&s(),v===""?"?":y?`? ${v}`:v}else if(r&&!u||t==null&&y)return v=`? ${v}`,h&&!x?v+=Fe(v,n.indent,d(h)):f&&i&&i(),v;x&&(h=null),y?(h&&(v+=Fe(v,n.indent,d(h))),v=`? ${v}
${l}:`):(v=`${v}:`,h&&(v+=Fe(v,n.indent,d(h))));let w,g,j;X(t)?(w=!!t.spaceBefore,g=t.commentBefore,j=t.comment):(w=!1,g=null,j=null,t&&typeof t=="object"&&(t=o.createNode(t))),n.implicitKey=!1,!y&&!h&&Y(t)&&(n.indentAtStart=v.length+1),f=!1,!m&&c.length>=2&&!n.inFlow&&!y&&Ct(t)&&!t.flow&&!t.tag&&!t.anchor&&(n.indent=n.indent.substring(2));let N=!1;const T=rt(t,n,()=>N=!0,()=>f=!0);let $=" ";if(h||w||g){if($=w?`
`:"",g){const P=d(g);$+=`
${je(P,n.indent)}`}T===""&&!n.inFlow?$===`
`&&($=`

`):$+=`
${n.indent}`}else if(!y&&Q(t)){const P=T[0],b=T.indexOf(`
`),_=b!==-1,D=n.inFlow??t.flow??t.items.length===0;if(_||!D){let E=!1;if(_&&(P==="&"||P==="!")){let B=T.indexOf(" ");P==="&"&&B!==-1&&B<b&&T[B+1]==="!"&&(B=T.indexOf(" ",B+1)),(B===-1||b<B)&&(E=!0)}E||($=`
${n.indent}`)}}else(T===""||T[0]===`
`)&&($="");return v+=$+T,n.inFlow?N&&s&&s():j&&!N?v+=Fe(v,n.indent,d(j)):f&&i&&i(),v}function hj(e,t){(e==="debug"||e==="warn")&&console.warn(t)}const qt="<<",Ne={identify:e=>e===qt||typeof e=="symbol"&&e.description===qt,default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:()=>Object.assign(new O(Symbol(qt)),{addToJSMap:qa}),stringify:()=>qt},fj=(e,t)=>(Ne.identify(t)||Y(t)&&(!t.type||t.type===O.PLAIN)&&Ne.identify(t.value))&&e?.doc.schema.tags.some(n=>n.tag===Ne.tag&&n.default);function qa(e,t,n){if(n=e&&ze(n)?n.resolve(e.doc):n,Ct(n))for(const s of n.items)vn(e,t,s);else if(Array.isArray(n))for(const s of n)vn(e,t,s);else vn(e,t,n)}function vn(e,t,n){const s=e&&ze(n)?n.resolve(e.doc):n;if(!Tt(s))throw new Error("Merge sources must be maps or map aliases");const i=s.toJSON(null,e,Map);for(const[r,o]of i)t instanceof Map?t.has(r)||t.set(r,o):t instanceof Set?t.add(r):Object.prototype.hasOwnProperty.call(t,r)||Object.defineProperty(t,r,{value:o,writable:!0,enumerable:!0,configurable:!0});return t}function Pa(e,t,{key:n,value:s}){if(X(n)&&n.addToJSMap)n.addToJSMap(e,t,s);else if(fj(e,n))qa(e,t,s);else{const i=ue(n,"",e);if(t instanceof Map)t.set(i,ue(s,i,e));else if(t instanceof Set)t.add(i);else{const r=pj(n,i,e),o=ue(s,r,e);r in t?Object.defineProperty(t,r,{value:o,writable:!0,enumerable:!0,configurable:!0}):t[r]=o}}return t}function pj(e,t,n){if(t===null)return"";if(typeof t!="object")return String(t);if(X(e)&&n?.doc){const s=Ua(n.doc,{});s.anchors=new Set;for(const r of n.anchors.keys())s.anchors.add(r.anchor);s.inFlow=!0,s.inStringifyKey=!0;const i=e.toString(s);if(!n.mapKeyWarned){let r=JSON.stringify(i);r.length>40&&(r=r.substring(0,36)+'..."'),hj(n.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${r}. Set mapAsMap: true to use object keys.`),n.mapKeyWarned=!0}return i}return JSON.stringify(t)}function Yn(e,t,n){const s=jt(e,void 0,n),i=jt(t,void 0,n);return new me(s,i)}class me{constructor(t,n=null){Object.defineProperty(this,he,{value:$a}),this.key=t,this.value=n}clone(t){let{key:n,value:s}=this;return X(n)&&(n=n.clone(t)),X(s)&&(s=s.clone(t)),new me(n,s)}toJSON(t,n){const s=n?.mapAsMap?new Map:{};return Pa(n,s,this)}toString(t,n,s){return t?.doc?mj(this,t,n,s):JSON.stringify(this)}}function Ma(e,t,n){return(t.inFlow??e.flow?yj:gj)(e,t,n)}function gj({comment:e,items:t},n,{blockItemPrefix:s,flowChars:i,itemIndent:r,onChompKeep:o,onComment:l}){const{indent:c,options:{commentString:d}}=n,m=Object.assign({},n,{indent:r,type:null});let u=!1;const h=[];for(let x=0;x<t.length;++x){const f=t[x];let v=null;if(X(f))!u&&f.spaceBefore&&h.push(""),Vt(n,h,f.commentBefore,u),f.comment&&(v=f.comment);else if(Z(f)){const g=X(f.key)?f.key:null;g&&(!u&&g.spaceBefore&&h.push(""),Vt(n,h,g.commentBefore,u))}u=!1;let w=rt(f,m,()=>v=null,()=>u=!0);v&&(w+=Fe(w,r,d(v))),u&&v&&(u=!1),h.push(s+w)}let y;if(h.length===0)y=i.start+i.end;else{y=h[0];for(let x=1;x<h.length;++x){const f=h[x];y+=f?`
${c}${f}`:`
`}}return e?(y+=`
`+je(d(e),c),l&&l()):u&&o&&o(),y}function yj({items:e},t,{flowChars:n,itemIndent:s}){const{indent:i,indentStep:r,flowCollectionPadding:o,options:{commentString:l}}=t;s+=r;const c=Object.assign({},t,{indent:s,inFlow:!0,type:null});let d=!1,m=0;const u=[];for(let x=0;x<e.length;++x){const f=e[x];let v=null;if(X(f))f.spaceBefore&&u.push(""),Vt(t,u,f.commentBefore,!1),f.comment&&(v=f.comment);else if(Z(f)){const g=X(f.key)?f.key:null;g&&(g.spaceBefore&&u.push(""),Vt(t,u,g.commentBefore,!1),g.comment&&(d=!0));const j=X(f.value)?f.value:null;j?(j.comment&&(v=j.comment),j.commentBefore&&(d=!0)):f.value==null&&g?.comment&&(v=g.comment)}v&&(d=!0);let w=rt(f,c,()=>v=null);x<e.length-1&&(w+=","),v&&(w+=Fe(w,s,l(v))),!d&&(u.length>m||w.includes(`
`))&&(d=!0),u.push(w),m=u.length}const{start:h,end:y}=n;if(u.length===0)return h+y;if(!d){const x=u.reduce((f,v)=>f+v.length+2,2);d=t.options.lineWidth>0&&x>t.options.lineWidth}if(d){let x=h;for(const f of u)x+=f?`
${r}${i}${f}`:`
`;return`${x}
${i}${y}`}else return`${h}${o}${u.join(" ")}${o}${y}`}function Vt({indent:e,options:{commentString:t}},n,s,i){if(s&&i&&(s=s.replace(/^\n+/,"")),s){const r=je(t(s),e);n.push(r.trimStart())}}function De(e,t){const n=Y(t)?t.value:t;for(const s of e)if(Z(s)&&(s.key===t||s.key===n||Y(s.key)&&s.key.value===n))return s}class Ee extends Aa{static get tagName(){return"tag:yaml.org,2002:map"}constructor(t){super(Ae,t),this.items=[]}static from(t,n,s){const{keepUndefined:i,replacer:r}=s,o=new this(t),l=(c,d)=>{if(typeof r=="function")d=r.call(n,c,d);else if(Array.isArray(r)&&!r.includes(c))return;(d!==void 0||i)&&o.items.push(Yn(c,d,s))};if(n instanceof Map)for(const[c,d]of n)l(c,d);else if(n&&typeof n=="object")for(const c of Object.keys(n))l(c,n[c]);return typeof t.sortMapEntries=="function"&&o.items.sort(t.sortMapEntries),o}add(t,n){let s;Z(t)?s=t:!t||typeof t!="object"||!("key"in t)?s=new me(t,t?.value):s=new me(t.key,t.value);const i=De(this.items,s.key),r=this.schema?.sortMapEntries;if(i){if(!n)throw new Error(`Key ${s.key} already set`);Y(i.value)&&Sa(s.value)?i.value.value=s.value:i.value=s.value}else if(r){const o=this.items.findIndex(l=>r(s,l)<0);o===-1?this.items.push(s):this.items.splice(o,0,s)}else this.items.push(s)}delete(t){const n=De(this.items,t);return n?this.items.splice(this.items.indexOf(n),1).length>0:!1}get(t,n){const i=De(this.items,t)?.value;return(!n&&Y(i)?i.value:i)??void 0}has(t){return!!De(this.items,t)}set(t,n){this.add(new me(t,n),!0)}toJSON(t,n,s){const i=s?new s:n?.mapAsMap?new Map:{};n?.onCreate&&n.onCreate(i);for(const r of this.items)Pa(n,i,r);return i}toString(t,n,s){if(!t)return JSON.stringify(this);for(const i of this.items)if(!Z(i))throw new Error(`Map items must all be pairs; found ${JSON.stringify(i)} instead`);return!t.allNullValues&&this.hasAllNullValues(!1)&&(t=Object.assign({},t,{allNullValues:!0})),Ma(this,t,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:t.indent||"",onChompKeep:s,onComment:n})}}const mt={collection:"map",default:!0,nodeClass:Ee,tag:"tag:yaml.org,2002:map",resolve(e,t){return Tt(e)||t("Expected a mapping for this tag"),e},createNode:(e,t,n)=>Ee.from(e,t,n)};class Yt extends Aa{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(t){super(dt,t),this.items=[]}add(t){this.items.push(t)}delete(t){const n=Pt(t);return typeof n!="number"?!1:this.items.splice(n,1).length>0}get(t,n){const s=Pt(t);if(typeof s!="number")return;const i=this.items[s];return!n&&Y(i)?i.value:i}has(t){const n=Pt(t);return typeof n=="number"&&n<this.items.length}set(t,n){const s=Pt(t);if(typeof s!="number")throw new Error(`Expected a valid index, not ${t}.`);const i=this.items[s];Y(i)&&Sa(n)?i.value=n:this.items[s]=n}toJSON(t,n){const s=[];n?.onCreate&&n.onCreate(s);let i=0;for(const r of this.items)s.push(ue(r,String(i++),n));return s}toString(t,n,s){return t?Ma(this,t,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(t.indent||"")+"  ",onChompKeep:s,onComment:n}):JSON.stringify(this)}static from(t,n,s){const{replacer:i}=s,r=new this(t);if(n&&Symbol.iterator in Object(n)){let o=0;for(let l of n){if(typeof i=="function"){const c=n instanceof Set?l:String(o++);l=i.call(n,c,l)}r.items.push(jt(l,void 0,s))}}return r}}function Pt(e){let t=Y(e)?e.value:e;return t&&typeof t=="string"&&(t=Number(t)),typeof t=="number"&&Number.isInteger(t)&&t>=0?t:null}const ht={collection:"seq",default:!0,nodeClass:Yt,tag:"tag:yaml.org,2002:seq",resolve(e,t){return Ct(e)||t("Expected a sequence for this tag"),e},createNode:(e,t,n)=>Yt.from(e,t,n)},mn={identify:e=>typeof e=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:e=>e,stringify(e,t,n,s){return t=Object.assign({actualString:!0},t),Vn(e,t,n,s)}},hn={identify:e=>e==null,createNode:()=>new O(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new O(null),stringify:({source:e},t)=>typeof e=="string"&&hn.test.test(e)?e:t.options.nullStr},Kn={identify:e=>typeof e=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:e=>new O(e[0]==="t"||e[0]==="T"),stringify({source:e,value:t},n){if(e&&Kn.test.test(e)){const s=e[0]==="t"||e[0]==="T";if(t===s)return e}return t?n.options.trueStr:n.options.falseStr}};function ve({format:e,minFractionDigits:t,tag:n,value:s}){if(typeof s=="bigint")return String(s);const i=typeof s=="number"?s:Number(s);if(!isFinite(i))return isNaN(i)?".nan":i<0?"-.inf":".inf";let r=JSON.stringify(s);if(!e&&t&&(!n||n==="tag:yaml.org,2002:float")&&/^\d/.test(r)){let o=r.indexOf(".");o<0&&(o=r.length,r+=".");let l=t-(r.length-o-1);for(;l-- >0;)r+="0"}return r}const Oa={identify:e=>typeof e=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:e=>e.slice(-3).toLowerCase()==="nan"?NaN:e[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:ve},Ra={identify:e=>typeof e=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:e=>parseFloat(e),stringify(e){const t=Number(e.value);return isFinite(t)?t.toExponential():ve(e)}},Fa={identify:e=>typeof e=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(e){const t=new O(parseFloat(e)),n=e.indexOf(".");return n!==-1&&e[e.length-1]==="0"&&(t.minFractionDigits=e.length-n-1),t},stringify:ve},fn=e=>typeof e=="bigint"||Number.isInteger(e),zn=(e,t,n,{intAsBigInt:s})=>s?BigInt(e):parseInt(e.substring(t),n);function Da(e,t,n){const{value:s}=e;return fn(s)&&s>=0?n+s.toString(t):ve(e)}const Ba={identify:e=>fn(e)&&e>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(e,t,n)=>zn(e,2,8,n),stringify:e=>Da(e,8,"0o")},Wa={identify:fn,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(e,t,n)=>zn(e,0,10,n),stringify:ve},Ga={identify:e=>fn(e)&&e>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(e,t,n)=>zn(e,2,16,n),stringify:e=>Da(e,16,"0x")},bj=[mt,ht,mn,hn,Kn,Ba,Wa,Ga,Oa,Ra,Fa];function Is(e){return typeof e=="bigint"||Number.isInteger(e)}const Mt=({value:e})=>JSON.stringify(e),xj=[{identify:e=>typeof e=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:e=>e,stringify:Mt},{identify:e=>e==null,createNode:()=>new O(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:Mt},{identify:e=>typeof e=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true$|^false$/,resolve:e=>e==="true",stringify:Mt},{identify:Is,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(e,t,{intAsBigInt:n})=>n?BigInt(e):parseInt(e,10),stringify:({value:e})=>Is(e)?e.toString():JSON.stringify(e)},{identify:e=>typeof e=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:e=>parseFloat(e),stringify:Mt}],vj={default:!0,tag:"",test:/^/,resolve(e,t){return t(`Unresolved plain scalar ${JSON.stringify(e)}`),e}},wj=[mt,ht].concat(xj,vj),Jn={identify:e=>e instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(e,t){if(typeof atob=="function"){const n=atob(e.replace(/[\n\r]/g,"")),s=new Uint8Array(n.length);for(let i=0;i<n.length;++i)s[i]=n.charCodeAt(i);return s}else return t("This environment does not support reading binary tags; either Buffer or atob is required"),e},stringify({comment:e,type:t,value:n},s,i,r){if(!n)return"";const o=n;let l;if(typeof btoa=="function"){let c="";for(let d=0;d<o.length;++d)c+=String.fromCharCode(o[d]);l=btoa(c)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(t??(t=O.BLOCK_LITERAL),t!==O.QUOTE_DOUBLE){const c=Math.max(s.options.lineWidth-s.indent.length,s.options.minContentWidth),d=Math.ceil(l.length/c),m=new Array(d);for(let u=0,h=0;u<d;++u,h+=c)m[u]=l.substr(h,c);l=m.join(t===O.BLOCK_LITERAL?`
`:" ")}return Vn({comment:e,type:t,value:l},s,i,r)}};function Ha(e,t){if(Ct(e))for(let n=0;n<e.items.length;++n){let s=e.items[n];if(!Z(s)){if(Tt(s)){s.items.length>1&&t("Each pair must have its own sequence indicator");const i=s.items[0]||new me(new O(null));if(s.commentBefore&&(i.key.commentBefore=i.key.commentBefore?`${s.commentBefore}
${i.key.commentBefore}`:s.commentBefore),s.comment){const r=i.value??i.key;r.comment=r.comment?`${s.comment}
${r.comment}`:s.comment}s=i}e.items[n]=Z(s)?s:new me(s)}}else t("Expected a sequence for this tag");return e}function Va(e,t,n){const{replacer:s}=n,i=new Yt(e);i.tag="tag:yaml.org,2002:pairs";let r=0;if(t&&Symbol.iterator in Object(t))for(let o of t){typeof s=="function"&&(o=s.call(t,String(r++),o));let l,c;if(Array.isArray(o))if(o.length===2)l=o[0],c=o[1];else throw new TypeError(`Expected [key, value] tuple: ${o}`);else if(o&&o instanceof Object){const d=Object.keys(o);if(d.length===1)l=d[0],c=o[l];else throw new TypeError(`Expected tuple with one key, not ${d.length} keys`)}else l=o;i.items.push(Yn(l,c,n))}return i}const Qn={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:Ha,createNode:Va};class nt extends Yt{constructor(){super(),this.add=Ee.prototype.add.bind(this),this.delete=Ee.prototype.delete.bind(this),this.get=Ee.prototype.get.bind(this),this.has=Ee.prototype.has.bind(this),this.set=Ee.prototype.set.bind(this),this.tag=nt.tag}toJSON(t,n){if(!n)return super.toJSON(t);const s=new Map;n?.onCreate&&n.onCreate(s);for(const i of this.items){let r,o;if(Z(i)?(r=ue(i.key,"",n),o=ue(i.value,r,n)):r=ue(i,"",n),s.has(r))throw new Error("Ordered maps must not include duplicate keys");s.set(r,o)}return s}static from(t,n,s){const i=Va(t,n,s),r=new this;return r.items=i.items,r}}nt.tag="tag:yaml.org,2002:omap";const Xn={collection:"seq",identify:e=>e instanceof Map,nodeClass:nt,default:!1,tag:"tag:yaml.org,2002:omap",resolve(e,t){const n=Ha(e,t),s=[];for(const{key:i}of n.items)Y(i)&&(s.includes(i.value)?t(`Ordered maps must not include duplicate keys: ${i.value}`):s.push(i.value));return Object.assign(new nt,n)},createNode:(e,t,n)=>nt.from(e,t,n)};function Ya({value:e,source:t},n){return t&&(e?Ka:za).test.test(t)?t:e?n.options.trueStr:n.options.falseStr}const Ka={identify:e=>e===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new O(!0),stringify:Ya},za={identify:e=>e===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new O(!1),stringify:Ya},kj={identify:e=>typeof e=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:e=>e.slice(-3).toLowerCase()==="nan"?NaN:e[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:ve},jj={identify:e=>typeof e=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:e=>parseFloat(e.replace(/_/g,"")),stringify(e){const t=Number(e.value);return isFinite(t)?t.toExponential():ve(e)}},Nj={identify:e=>typeof e=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(e){const t=new O(parseFloat(e.replace(/_/g,""))),n=e.indexOf(".");if(n!==-1){const s=e.substring(n+1).replace(/_/g,"");s[s.length-1]==="0"&&(t.minFractionDigits=s.length)}return t},stringify:ve},Et=e=>typeof e=="bigint"||Number.isInteger(e);function pn(e,t,n,{intAsBigInt:s}){const i=e[0];if((i==="-"||i==="+")&&(t+=1),e=e.substring(t).replace(/_/g,""),s){switch(n){case 2:e=`0b${e}`;break;case 8:e=`0o${e}`;break;case 16:e=`0x${e}`;break}const o=BigInt(e);return i==="-"?BigInt(-1)*o:o}const r=parseInt(e,n);return i==="-"?-1*r:r}function Zn(e,t,n){const{value:s}=e;if(Et(s)){const i=s.toString(t);return s<0?"-"+n+i.substr(1):n+i}return ve(e)}const $j={identify:Et,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(e,t,n)=>pn(e,2,2,n),stringify:e=>Zn(e,2,"0b")},_j={identify:Et,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(e,t,n)=>pn(e,1,8,n),stringify:e=>Zn(e,8,"0")},Ij={identify:Et,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(e,t,n)=>pn(e,0,10,n),stringify:ve},Tj={identify:Et,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(e,t,n)=>pn(e,2,16,n),stringify:e=>Zn(e,16,"0x")};class st extends Ee{constructor(t){super(t),this.tag=st.tag}add(t){let n;Z(t)?n=t:t&&typeof t=="object"&&"key"in t&&"value"in t&&t.value===null?n=new me(t.key,null):n=new me(t,null),De(this.items,n.key)||this.items.push(n)}get(t,n){const s=De(this.items,t);return!n&&Z(s)?Y(s.key)?s.key.value:s.key:s}set(t,n){if(typeof n!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof n}`);const s=De(this.items,t);s&&!n?this.items.splice(this.items.indexOf(s),1):!s&&n&&this.items.push(new me(t))}toJSON(t,n){return super.toJSON(t,n,Set)}toString(t,n,s){if(!t)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},t,{allNullValues:!0}),n,s);throw new Error("Set items must all have null values")}static from(t,n,s){const{replacer:i}=s,r=new this(t);if(n&&Symbol.iterator in Object(n))for(let o of n)typeof i=="function"&&(o=i.call(n,o,o)),r.items.push(Yn(o,null,s));return r}}st.tag="tag:yaml.org,2002:set";const es={collection:"map",identify:e=>e instanceof Set,nodeClass:st,default:!1,tag:"tag:yaml.org,2002:set",createNode:(e,t,n)=>st.from(e,t,n),resolve(e,t){if(Tt(e)){if(e.hasAllNullValues(!0))return Object.assign(new st,e);t("Set items must all have null values")}else t("Expected a mapping for this tag");return e}};function ts(e,t){const n=e[0],s=n==="-"||n==="+"?e.substring(1):e,i=o=>t?BigInt(o):Number(o),r=s.replace(/_/g,"").split(":").reduce((o,l)=>o*i(60)+i(l),i(0));return n==="-"?i(-1)*r:r}function Ja(e){let{value:t}=e,n=o=>o;if(typeof t=="bigint")n=o=>BigInt(o);else if(isNaN(t)||!isFinite(t))return ve(e);let s="";t<0&&(s="-",t*=n(-1));const i=n(60),r=[t%i];return t<60?r.unshift(0):(t=(t-r[0])/i,r.unshift(t%i),t>=60&&(t=(t-r[0])/i,r.unshift(t))),s+r.map(o=>String(o).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}const Qa={identify:e=>typeof e=="bigint"||Number.isInteger(e),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(e,t,{intAsBigInt:n})=>ts(e,n),stringify:Ja},Xa={identify:e=>typeof e=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:e=>ts(e,!1),stringify:Ja},gn={identify:e=>e instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(e){const t=e.match(gn.test);if(!t)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,n,s,i,r,o,l]=t.map(Number),c=t[7]?Number((t[7]+"00").substr(1,3)):0;let d=Date.UTC(n,s-1,i,r||0,o||0,l||0,c);const m=t[8];if(m&&m!=="Z"){let u=ts(m,!1);Math.abs(u)<30&&(u*=60),d-=6e4*u}return new Date(d)},stringify:({value:e})=>e?.toISOString().replace(/(T00:00:00)?\.000Z$/,"")??""},Ts=[mt,ht,mn,hn,Ka,za,$j,_j,Ij,Tj,kj,jj,Nj,Jn,Ne,Xn,Qn,es,Qa,Xa,gn],Cs=new Map([["core",bj],["failsafe",[mt,ht,mn]],["json",wj],["yaml11",Ts],["yaml-1.1",Ts]]),Es={binary:Jn,bool:Kn,float:Fa,floatExp:Ra,floatNaN:Oa,floatTime:Xa,int:Wa,intHex:Ga,intOct:Ba,intTime:Qa,map:mt,merge:Ne,null:hn,omap:Xn,pairs:Qn,seq:ht,set:es,timestamp:gn},Cj={"tag:yaml.org,2002:binary":Jn,"tag:yaml.org,2002:merge":Ne,"tag:yaml.org,2002:omap":Xn,"tag:yaml.org,2002:pairs":Qn,"tag:yaml.org,2002:set":es,"tag:yaml.org,2002:timestamp":gn};function wn(e,t,n){const s=Cs.get(t);if(s&&!e)return n&&!s.includes(Ne)?s.concat(Ne):s.slice();let i=s;if(!i)if(Array.isArray(e))i=[];else{const r=Array.from(Cs.keys()).filter(o=>o!=="yaml11").map(o=>JSON.stringify(o)).join(", ");throw new Error(`Unknown schema "${t}"; use one of ${r} or define customTags array`)}if(Array.isArray(e))for(const r of e)i=i.concat(r);else typeof e=="function"&&(i=e(i.slice()));return n&&(i=i.concat(Ne)),i.reduce((r,o)=>{const l=typeof o=="string"?Es[o]:o;if(!l){const c=JSON.stringify(o),d=Object.keys(Es).map(m=>JSON.stringify(m)).join(", ");throw new Error(`Unknown custom tag ${c}; use one of ${d}`)}return r.includes(l)||r.push(l),r},[])}const Ej=(e,t)=>e.key<t.key?-1:e.key>t.key?1:0;class ns{constructor({compat:t,customTags:n,merge:s,resolveKnownTags:i,schema:r,sortMapEntries:o,toStringDefaults:l}){this.compat=Array.isArray(t)?wn(t,"compat"):t?wn(null,t):null,this.name=typeof r=="string"&&r||"core",this.knownTags=i?Cj:{},this.tags=wn(n,this.name,s),this.toStringOptions=l??null,Object.defineProperty(this,Ae,{value:mt}),Object.defineProperty(this,ln,{value:mn}),Object.defineProperty(this,dt,{value:ht}),this.sortMapEntries=typeof o=="function"?o:o===!0?Ej:null}clone(){const t=Object.create(ns.prototype,Object.getOwnPropertyDescriptors(this));return t.tags=this.tags.slice(),t}}function Sj(e,t){const n=[];let s=t.directives===!0;if(t.directives!==!1&&e.directives){const c=e.directives.toString(e);c?(n.push(c),s=!0):e.directives.docStart&&(s=!0)}s&&n.push("---");const i=Ua(e,t),{commentString:r}=i.options;if(e.commentBefore){n.length!==1&&n.unshift("");const c=r(e.commentBefore);n.unshift(je(c,""))}let o=!1,l=null;if(e.contents){if(X(e.contents)){if(e.contents.spaceBefore&&s&&n.push(""),e.contents.commentBefore){const m=r(e.contents.commentBefore);n.push(je(m,""))}i.forceBlockIndent=!!e.comment,l=e.contents.comment}const c=l?void 0:()=>o=!0;let d=rt(e.contents,i,()=>l=null,c);l&&(d+=Fe(d,"",r(l))),(d[0]==="|"||d[0]===">")&&n[n.length-1]==="---"?n[n.length-1]=`--- ${d}`:n.push(d)}else n.push(rt(e.contents,i));if(e.directives?.docEnd)if(e.comment){const c=r(e.comment);c.includes(`
`)?(n.push("..."),n.push(je(c,""))):n.push(`... ${c}`)}else n.push("...");else{let c=e.comment;c&&o&&(c=c.replace(/^\n+/,"")),c&&((!o||l)&&n[n.length-1]!==""&&n.push(""),n.push(je(r(c),"")))}return n.join(`
`)+`
`}class ss{constructor(t,n,s){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,he,{value:_n});let i=null;typeof n=="function"||Array.isArray(n)?i=n:s===void 0&&n&&(s=n,n=void 0);const r=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},s);this.options=r;let{version:o}=r;s?._directives?(this.directives=s._directives.atDocument(),this.directives.yaml.explicit&&(o=this.directives.yaml.version)):this.directives=new re({version:o}),this.setSchema(o,s),this.contents=t===void 0?null:this.createNode(t,i,s)}clone(){const t=Object.create(ss.prototype,{[he]:{value:_n}});return t.commentBefore=this.commentBefore,t.comment=this.comment,t.errors=this.errors.slice(),t.warnings=this.warnings.slice(),t.options=Object.assign({},this.options),this.directives&&(t.directives=this.directives.clone()),t.schema=this.schema.clone(),t.contents=X(this.contents)?this.contents.clone(t.schema):this.contents,this.range&&(t.range=this.range.slice()),t}add(t){Je(this.contents)&&this.contents.add(t)}addIn(t,n){Je(this.contents)&&this.contents.addIn(t,n)}createAlias(t,n){if(!t.anchor){const s=Ta(this);t.anchor=!n||s.has(n)?Ca(n||"a",s):n}return new Ea(t.anchor)}createNode(t,n,s){let i;if(typeof n=="function")t=n.call({"":t},"",t),i=n;else if(Array.isArray(n)){const v=g=>typeof g=="number"||g instanceof String||g instanceof Number,w=n.filter(v).map(String);w.length>0&&(n=n.concat(w)),i=n}else s===void 0&&n&&(s=n,n=void 0);const{aliasDuplicateObjects:r,anchorPrefix:o,flow:l,keepUndefined:c,onTagObj:d,tag:m}=s??{},{onAnchor:u,setAnchors:h,sourceObjects:y}=aj(this,o||"a"),x={aliasDuplicateObjects:r??!0,keepUndefined:c??!1,onAnchor:u,onTagObj:d,replacer:i,schema:this.schema,sourceObjects:y},f=jt(t,m,x);return l&&Q(f)&&(f.flow=!0),h(),f}createPair(t,n,s={}){const i=this.createNode(t,null,s),r=this.createNode(n,null,s);return new me(i,r)}delete(t){return Je(this.contents)?this.contents.delete(t):!1}deleteIn(t){return bt(t)?this.contents==null?!1:(this.contents=null,!0):Je(this.contents)?this.contents.deleteIn(t):!1}get(t,n){return Q(this.contents)?this.contents.get(t,n):void 0}getIn(t,n){return bt(t)?!n&&Y(this.contents)?this.contents.value:this.contents:Q(this.contents)?this.contents.getIn(t,n):void 0}has(t){return Q(this.contents)?this.contents.has(t):!1}hasIn(t){return bt(t)?this.contents!==void 0:Q(this.contents)?this.contents.hasIn(t):!1}set(t,n){this.contents==null?this.contents=Ht(this.schema,[t],n):Je(this.contents)&&this.contents.set(t,n)}setIn(t,n){bt(t)?this.contents=n:this.contents==null?this.contents=Ht(this.schema,Array.from(t),n):Je(this.contents)&&this.contents.setIn(t,n)}setSchema(t,n={}){typeof t=="number"&&(t=String(t));let s;switch(t){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new re({version:"1.1"}),s={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=t:this.directives=new re({version:t}),s={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,s=null;break;default:{const i=JSON.stringify(t);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${i}`)}}if(n.schema instanceof Object)this.schema=n.schema;else if(s)this.schema=new ns(Object.assign(s,n));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:t,jsonArg:n,mapAsMap:s,maxAliasCount:i,onAnchor:r,reviver:o}={}){const l={anchors:new Map,doc:this,keep:!t,mapAsMap:s===!0,mapKeyWarned:!1,maxAliasCount:typeof i=="number"?i:100},c=ue(this.contents,n??"",l);if(typeof r=="function")for(const{count:d,res:m}of l.anchors.values())r(m,d);return typeof o=="function"?et(o,{"":c},"",c):c}toJSON(t,n){return this.toJS({json:!0,jsonArg:t,mapAsMap:!1,onAnchor:n})}toString(t={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in t&&(!Number.isInteger(t.indent)||Number(t.indent)<=0)){const n=JSON.stringify(t.indent);throw new Error(`"indent" option must be a positive integer, not ${n}`)}return Sj(this,t)}}function Je(e){if(Q(e))return!0;throw new Error("Expected a YAML collection as document contents")}new Set("0123456789ABCDEFabcdef");new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()");new Set(",[]{}");new Set(` ,[]{}
\r	`);function Aj(e,t,n){let s=null;if(Array.isArray(t)&&(s=t),e===void 0){const{keepUndefined:i}={};if(!i)return}return It(e)&&!s?e.toString(n):new ss(e,s,n).toString(n)}var Lj=wi();const Ss=zt(Lj),As=172,Ls=100,Us=(e,t,n="TB")=>{const s=n==="LR",i=new Ss.graphlib.Graph().setDefaultEdgeLabel(()=>({}));return i.setGraph({rankdir:n,acyclicer:"greedy",ranker:"longest-path",nodesep:40,ranksep:60}),e.forEach(o=>{i.setNode(o.id,{width:As,height:Ls})}),t.forEach(o=>{i.setEdge(o.source,o.target)}),Ss.layout(i),{nodes:e.map(o=>{const l=i.node(o.id);return{...o,targetPosition:s?St.Left:St.Top,sourcePosition:s?St.Right:St.Bottom,position:{x:l.x-As/2,y:l.y-Ls/2}}}),edges:t}},qs=(e,t,n=!1)=>{const s=new Map,i=new Map;return Object.entries(e.nodes).forEach(([r,o],l)=>{const c=t===r,d=r==="start",m=o.end;s.set(r,{id:r,type:"default",position:n?{x:l%3*300,y:Math.floor(l/3)*200}:{x:0,y:0},data:{label:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:`font-bold ${d?"text-green-600":m?"text-red-600":"text-blue-600"}`,children:r}),a.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[o.sequence.length," dialog",o.sequence.length!==1?"s":""]}),a.jsxs("div",{className:"text-xs text-gray-600",children:[o.choices?.length," choice",o.choices?.length!==1?"s":""]})]})},style:{background:"transparent",color:"white",border:c?"2px solid #1d4ed8":"1px solid #374151",borderRadius:"8px",minWidth:"120px",minHeight:"80px"}}),o.choices?.forEach(u=>{const h=`${r}-${u.goto}`;i.set(h,{id:h,source:r,target:u.goto,label:u.type==="fixed"?u.text:u.prompt,style:{stroke:"#6b7280",strokeWidth:2},labelStyle:{fontSize:"10px",fill:"#374151"},labelBgStyle:{fill:"white",fillOpacity:.8}})})}),{nodes:Array.from(s.values()),edges:Array.from(i.values())}},Uj=({conversation:e,selectedNodeId:t,onNodeSelect:n})=>{const[s,i,r]=ki([]),[o,l,c]=ji([]),{fitView:d}=Ni(),{nodes:m,edges:u}=p.useMemo(()=>{if(!e)return{nodes:[],edges:[]};const{nodes:x,edges:f}=qs(e,t,!0),{nodes:v,edges:w}=Us(x,f);return{nodes:v,edges:w}},[e,t]);Ps.useEffect(()=>{i(m),l(u)},[m,u,i,l]);const h=p.useCallback((x,f)=>{n(f.id)},[n]),y=p.useCallback(x=>{if(!e)return;const{nodes:f,edges:v}=qs(e,t,!1),{nodes:w,edges:g}=Us(f,v,x);i([...w]),l([...g]),setTimeout(()=>{d()},100)},[e,t,i,l,d]);return e?a.jsxs("div",{className:"h-full",children:[a.jsxs("div",{className:"p-4 border-b border-base-300 bg-base-50",children:[a.jsx("h2",{className:"text-lg font-semibold",children:"Conversation Flow"}),a.jsxs("p",{className:"text-sm text-base-content/70",children:[e.meta.name," - ",Object.keys(e.nodes).length," nodes"]})]}),a.jsx("div",{className:"h-[calc(100%-80px)]",children:a.jsxs($i,{nodes:s,edges:o,onNodesChange:r,onEdgesChange:c,onNodeClick:h,fitView:!0,attributionPosition:"bottom-left",children:[a.jsx(_i,{}),a.jsx(Ii,{}),a.jsx(Ti,{position:"top-right",children:a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{className:"btn btn-sm btn-outline",onClick:()=>y("TB"),title:"Vertical Layout",children:"↕️ Vertical"}),a.jsx("button",{className:"btn btn-sm btn-outline",onClick:()=>y("LR"),title:"Horizontal Layout",children:"↔️ Horizontal"})]})}),a.jsx(Ci,{nodeColor:"transparent",nodeStrokeColor:"#000",nodeStrokeWidth:3,nodeBorderRadius:2,maskColor:"rgba(0, 0, 0, 0.1)"})]},e.meta.conversation_id)})]}):a.jsx("div",{className:"h-full flex items-center justify-center bg-base-50",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-6xl mb-4",children:"💬"}),a.jsx("h3",{className:"text-lg font-semibold text-base-content/70",children:"Select a conversation to view its flow"}),a.jsx("p",{className:"text-sm text-base-content/50 mt-2",children:"Choose a conversation from the list to see its node structure and connections"})]})})},qj=({conversations:e,selectedConversationId:t,onConversationSelect:n})=>{const s=e.reduce((r,o)=>{const l=o.meta.location;return r[l]||(r[l]=[]),r[l].push(o),r},{}),i=Object.keys(s).sort();return a.jsxs("div",{className:"h-full flex flex-col",children:[a.jsxs("div",{className:"p-4 border-b border-base-300",children:[a.jsx("h2",{className:"text-lg font-semibold",children:"Conversations"}),a.jsxs("p",{className:"text-sm text-base-content/70",children:[e.length," conversation",e.length!==1?"s":""," found"]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto",children:a.jsx("div",{className:"join join-vertical bg-base-100",children:i.map((r,o)=>{const l=s[r];return a.jsxs("div",{className:"collapse collapse-arrow join-item border-base-300 border-b rounded-none",children:[a.jsx("input",{type:"checkbox",name:"location-accordion",defaultChecked:!1}),a.jsxs("div",{className:"collapse-title font-semibold",children:[r," (",l.length,")"]}),a.jsx("div",{className:"collapse-content",children:a.jsx("div",{className:"space-y-2",children:l.map(c=>a.jsx("div",{className:`card cursor-pointer transition-all duration-200 ${t===c.meta.conversation_id?"bg-primary text-primary-content shadow-lg":"bg-base-100 hover:bg-base-200"}`,onClick:()=>n(c.meta.conversation_id),children:a.jsxs("div",{className:"card-body p-3",children:[a.jsx("h3",{className:"card-title text-sm font-medium",children:c.meta.name}),a.jsx("p",{className:"text-xs opacity-70 line-clamp-2",children:c.meta.description}),a.jsxs("div",{className:"flex justify-between items-center mt-2",children:[a.jsxs("span",{className:"text-xs opacity-60",children:[Object.keys(c.nodes).length," nodes"]}),c.meta.conditions.length>0&&a.jsxs("span",{className:"text-xs opacity-60",children:[c.meta.conditions.length," condition",c.meta.conditions.length!==1?"s":""]})]})]})},c.meta.conversation_id))})})]},r)})})})]})},Pj=(e,t)=>{const n=t.split(`
`);for(let s=0;s<n.length;s++){const i=n[s];if(i.trim()===`${e}:`||i.trim()===`"${e}":`)return s+1}return 1},Mj=({content:e,onChange:t,conversation:n,selectedNodeId:s,onFocusChange:i})=>{const r=p.useRef(null);return p.useEffect(()=>{if(s&&r.current?.view&&e){const o=Pj(s,e),l=r.current.view,c=l.state.doc.line(o-1).from;l.focus(),setTimeout(()=>{const d=as.scrollIntoView(c,{y:"start",yMargin:25});l.dispatch({effects:d})},100)}},[s,e]),n?a.jsxs("div",{className:"h-full flex flex-col",children:[a.jsxs("div",{className:"p-4 border-b border-base-300 bg-base-50",children:[a.jsx("h2",{className:"text-lg font-semibold",children:"YAML Editor"}),a.jsxs("p",{className:"text-sm text-base-content/70",children:[n.meta.name," -"," ",s?`Node: ${s}`:"Full conversation"]})]}),a.jsx("div",{className:"flex-1 h-full overflow-y-auto",children:a.jsx(oi,{ref:r,value:e,onChange:t,onFocus:()=>i?.(!0),onBlur:()=>i?.(!1),extensions:[li(),as.lineWrapping],height:"auto",basicSetup:{lineNumbers:!0,foldGutter:!0,dropCursor:!1,autocompletion:!0,indentOnInput:!0,bracketMatching:!0,closeBrackets:!0,searchKeymap:!0},theme:"light"})})]}):a.jsx("div",{className:"h-full flex items-center justify-center bg-base-50",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-6xl mb-4",children:"📝"}),a.jsx("h3",{className:"text-lg font-semibold text-base-content/70",children:"YAML Editor"}),a.jsx("p",{className:"text-sm text-base-content/50 mt-2",children:"Select a conversation to edit its YAML configuration"})]})})},Oj=()=>{const{returnToMenu:e}=qe(),[t,n]=p.useState(null),[s,i]=p.useState(null),[r,o]=p.useState(""),[l,c]=p.useState(!1),d=p.useMemo(()=>Js(),[]),m=t&&d.find(v=>v.meta.conversation_id===t)||null,u=p.useCallback(v=>v?Aj(v):"",[]),h=v=>{n(v),i(null)},y=v=>{i(v)},x=v=>{o(v)},f=v=>{c(v)};return p.useEffect(()=>{if(m){const v=u(m);o(v)}else o("")},[m,u]),a.jsxs("div",{className:"h-screen flex flex-col bg-base-100",children:[a.jsxs("div",{className:"navbar bg-base-200 shadow-lg",children:[a.jsx("div",{className:"flex-1",children:a.jsx("h1",{className:"text-xl font-bold",children:"Conversation Editor"})}),a.jsx("div",{className:"flex-none",children:a.jsx("button",{className:"btn btn-primary",onClick:e,children:"Back to Main Menu"})})]}),a.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[a.jsx("div",{className:"w-80 border-r border-base-300 bg-base-50",children:a.jsx(qj,{conversations:d,selectedConversationId:t,onConversationSelect:h})}),a.jsx("div",{className:`${l?"flex-1":"flex-2"} border-r border-base-300 transition-width duration-300`,children:a.jsx(Ei,{children:a.jsx(Uj,{conversation:m,selectedNodeId:s,onNodeSelect:y},t)})}),a.jsx("div",{className:`${l?"flex-2":"flex-1"}`,children:a.jsx(Mj,{content:r,onChange:x,conversation:m,selectedNodeId:s,onFocusChange:f},t)})]})]})},Rj=""+new URL("main-menu-BUZRMri6.png",import.meta.url).href,Fj=""+new URL("logo-CpZ216rz.png",import.meta.url).href,Dj=()=>{const{startOverworld:e,startConversationEditor:t}=qe(),{hasStarted:n}=Te(),{saveGame:s,loadGame:i,startGame:r}=_t(),o=p.useRef(null),l=()=>{try{return new URLSearchParams(window.location.search).has("admin")}catch{return!1}},c=()=>{r()},d=()=>{e()},m=()=>{s()},u=()=>{o.current?.click()},h=y=>{const x=y.target.files?.[0];x&&(async()=>{try{await i(x),y.target.value=""}catch(f){console.error("Failed to load game:",f)}})()};return a.jsx("div",{className:"min-h-screen bg-cover bg-center bg-no-repeat",style:{backgroundImage:`url(${Rj})`},children:a.jsx("div",{className:"hero min-h-screen bg-black/10 flex items-center justify-center",children:a.jsx("div",{className:"hero-content text-center",children:a.jsxs("div",{className:"max-w-md",children:[a.jsx("h1",{className:"text-5xl font-bold mb-20",children:a.jsx("img",{src:Fj,alt:"Wildlight Tactics",className:"w-full h-full"})}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("button",{className:"btn btn-accent btn-lg w-full shadow-lg",onClick:c,children:"New Game"}),a.jsx("div",{className:"divider"}),n&&a.jsx("button",{className:"btn btn-accent btn-lg w-full shadow-lg",onClick:d,children:"Resume Game"}),n&&a.jsx("button",{className:"btn btn-accent btn-lg w-full shadow-lg",onClick:m,children:"Save Game"}),a.jsx("button",{className:"btn btn-accent btn-lg w-full shadow-lg",onClick:u,children:"Load Game"}),l()&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"divider"}),a.jsxs("button",{className:"btn btn-warning btn-lg w-full shadow-lg",onClick:t,children:[a.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),"Conversation Editor"]})]}),a.jsx("input",{ref:o,type:"file",accept:".json",onChange:h,className:"hidden"})]})]})})})})},Bj=({item:e})=>a.jsxs("div",{className:`chat ${e.type==="player"?"chat-end":"chat-start"}`,children:[a.jsx("div",{className:"chat-header",children:e.speaker}),a.jsxs("div",{className:`chat-bubble ${e.type==="player"?"chat-bubble-primary":""}`,children:[e.text&&a.jsx("div",{children:e.text}),e.image&&a.jsx("div",{className:e.text?"mt-2":"",children:a.jsx("img",{src:e.image,alt:"",className:"max-w-full h-auto rounded-lg"})})]})]}),Za=({conversationHistory:e,availableOptions:t,onPlayerDialog:n,canEndConversation:s,onEndConversation:i})=>{const r=p.useRef(null),[o,l]=p.useState("");p.useEffect(()=>{r.current?.scrollTo({top:r.current?.scrollHeight,behavior:"smooth"})},[e]);const c=(u,h)=>{u.preventDefault(),o.trim()&&(n(h,o.trim()),l(""))},d=u=>{n(u)},m=u=>{l(u.target.value)};return a.jsx("div",{className:"flex-1 p-8 bg-base-200 flex flex-col overflow-y-auto",ref:r,children:a.jsxs("div",{className:"max-w-md mx-auto w-full",children:[a.jsx("div",{className:"space-y-4 mb-6",children:e.map((u,h)=>a.jsx(Bj,{item:u},h))}),t&&t.length>0&&a.jsx("div",{className:"space-y-2",children:t.map((u,h)=>u.type==="fixed"?a.jsx("button",{onClick:()=>d(u),className:"btn btn-primary w-full text-left justify-start",children:u.text},h):a.jsx("form",{onSubmit:y=>c(y,u),className:"my-6",children:a.jsxs("div",{className:"flex w-full gap-2",children:[a.jsx("input",{type:"text",placeholder:u.prompt,className:"input input-bordered w-full",maxLength:255,required:!0,autoFocus:!0,value:o,onChange:m}),a.jsx("button",{type:"submit",className:"btn btn-primary",children:"Send"})]})},h))}),s&&a.jsx("div",{className:"mt-4",children:a.jsx("button",{onClick:i,className:"btn btn-outline w-full",children:"End Conversation"})})]})})},ei=()=>{const{currentConversationId:e,playerName:t}=Te(),{endNPCDialog:n,startNPCDialog:s}=qe(),{executeConversationAction:i}=_t(),r=kw(),o=e?xn(e).meta:null,[l,c]=p.useState({}),[d,m]=p.useState([]),[u,h]=p.useState([]),[y,x]=p.useState(!1);return p.useEffect(()=>{if(!e)return;const g=xn(e),{sequence:j,choices:N,end:T}=g.nodes.start,$=j.map(P=>({type:"npc",speaker:P.speaker,text:P.text,image:P.image}));c(g.variables),m($),h(N),x(T)},[e]),{availableConversations:r,conversationHistory:d,availableOptions:u,handlePlayerDialog:(g,j)=>{if(!e)return;const N=xn(e),T={...l},{sequence:$,choices:P,end:b}=N.nodes[g.goto],_=g.type==="input"?j:g.text;g.type==="input"&&(T[g.var]=j,c(T));const D=$.map(E=>({type:"npc",speaker:E.speaker,text:E.text,image:E.image}));m([...d,{type:"player",speaker:t||"You",text:_},...D]),h(P),x(b),g.actions?.forEach(E=>{i(E,T)})},handleEndConversation:()=>{m([]),h([]),x(!1),n()},handleStartConversation:g=>{s(g)},canEndConversation:y,conversationMeta:o}},Wj=()=>{const{handlePlayerDialog:e,handleEndConversation:t,conversationHistory:n,availableOptions:s,canEndConversation:i,conversationMeta:r}=ei();if(!r)throw new Error("Conversation meta not found");return a.jsx("div",{className:"fixed inset-0 bg-base-100 flex items-center justify-center p-4 bg-cover bg-center bg-no-repeat",style:{backgroundImage:`url(${r.backgroundImage})`},children:a.jsxs("div",{className:"flex rounded-lg shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden glass",children:[a.jsx("div",{className:"flex-1 bg-white/40 p-8 flex flex-col items-center justify-center",children:a.jsxs("div",{className:"text-center space-y-4",children:[a.jsx("h2",{className:"text-4xl font-bold text-base-content",children:r.name}),a.jsx("div",{className:"avatar",children:a.jsx("div",{className:"rounded-lg",children:a.jsx("img",{src:r.image,alt:r.name,className:"w-full h-full object-cover rounded-lg"})})})]})}),a.jsx(Za,{conversationHistory:n,availableOptions:s,onPlayerDialog:e,onEndConversation:t,canEndConversation:i})]})})},Gj=()=>{const{handlePlayerDialog:e,handleEndConversation:t,conversationHistory:n,availableOptions:s,canEndConversation:i,conversationMeta:r}=ei();if(!r)throw new Error("Conversation meta not found");return a.jsx("div",{className:"fixed inset-0 bg-base-100 flex items-center justify-center p-4 bg-cover bg-center bg-no-repeat",style:{backgroundImage:`url(${r.backgroundImage})`},children:a.jsxs("div",{className:"flex rounded-lg shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden glass",children:[a.jsxs("div",{className:"flex-1 bg-white/40 p-8 overflow-y-auto",children:[a.jsx("h2",{className:"text-4xl font-bold mb-8 text-center",children:"Welcome to the World of Wildlight!"}),a.jsxs("div",{className:"max-w-prose mx-auto space-y-6 text-md leading-relaxed",children:[a.jsx("p",{className:"text-base-content/80",children:"In this reborn world where nature and technology dance together, a new age has dawned. From the ruins of the old world grew gleaming bio-cities that thrive alongside crystal rivers and living architecture, a world where green towers pulse with life and energy flows clean and eternal."}),a.jsxs("p",{className:"text-base-content/80",children:["Here dwell the magnificent ",a.jsx("strong",{children:"Wildlight"}),", extraordinary creatures born when ancient nanobots fused with ordinary animals, evolving over generations into beings of incredible power. These microscopic guardians flow through their bodies like liquid starlight, granting devastating abilities while ensuring no lasting harm can befall them."]}),a.jsx("p",{className:"text-base-content/80",children:"In great bio-arenas, humans and Wildlight engage in spectacular battles, the ultimate sport that celebrates the bond between trainer and creature. Each thunderous clash showcases raw elemental power, but the nanobots protect these majestic beings, making every fight a celebration of what we've built together."}),a.jsx("p",{className:"text-base-content/80",children:a.jsx("em",{children:"Will you step forward to become a Wildlight trainer? Will you forge bonds with these incredible creatures and rise through the ranks of this most noble sport?"})}),a.jsx("p",{className:"text-base-content/80",children:a.jsx("strong",{children:"The arena awaits, trainer. Your legend begins now."})})]})]}),a.jsx(Za,{conversationHistory:n,availableOptions:s,onPlayerDialog:e,onEndConversation:t,canEndConversation:i})]})})},Hj=()=>{const{currentNarrative:e}=Te();switch(e){case wt.NPC_DIALOG:return a.jsx(Wj,{});case wt.WELCOME_DIALOG:return a.jsx(Gj,{});case null:return null;default:{const t=e;throw new Error(`Unknown narrative: ${t}`)}}},Vj=({action:e,locationId:t})=>{const{startNPCDialog:n}=qe(),{completeActivity:s}=ja(),{startTrainerBattle:i,startWildlightSearchBattle:r}=_t(),o=()=>{switch(e.type){case"npc":{const l=e.data;n(l.conversationId),s(t,"npc",l.id);break}case"shop":{const l=e.data;console.log("Opening shop:",l),s(t,"shop",l.id);break}case"trainer":{const l=e.data;i(l,t),s(t,"trainer",l.id);break}case"wildlight":{r(t),s(t,"wildlight","search");break}default:console.warn("Unknown action type:",e.type)}};return a.jsx("div",{className:"card bg-base-200 shadow-md hover:shadow-lg transition-shadow cursor-pointer",children:a.jsxs("div",{className:"card-body p-4 text-center",children:[a.jsx("div",{className:"text-4xl mb-2",children:e.icon}),a.jsx("h4",{className:"card-title text-sm mb-1",children:e.title}),a.jsx("p",{className:"text-xs text-base-content/70 mb-3",children:e.description}),a.jsxs("button",{className:"btn btn-primary btn-sm w-full",onClick:o,children:[e.type==="npc"&&"Talk",e.type==="shop"&&"Shop",e.type==="trainer"&&"Battle",e.type==="wildlight"&&"Search"]})]})})},Yj=({location:e})=>{const t=[];return e.npcs.length>0&&e.npcs.forEach(n=>{n.isUnlocked&&t.push({id:`npc-${n.id}`,type:"npc",title:`Talk to ${n.name}`,description:n.description,icon:"🗣️",data:n})}),e.shopConfig&&e.shopConfig.isUnlocked&&t.push({id:`shop-${e.shopConfig.id}`,type:"shop",title:`Visit ${e.shopConfig.name}`,description:e.shopConfig.description,icon:"🛒",data:e.shopConfig}),e.trainers.length>0&&e.trainers.forEach(n=>{n.isUnlocked&&t.push({id:`trainer-${n.id}`,type:"trainer",title:`Battle ${n.name}`,description:n.description,icon:"⚔️",data:n})}),t.push({id:"wildlight-search",type:"wildlight",title:"Search for Wildlight",description:"Explore the area and encounter wild creatures",icon:"🔍",data:e.wildlightSearchConfig}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:t.map(n=>a.jsx(Vj,{action:n,locationId:e.id},n.id))})},Kj=({location:e})=>a.jsxs("div",{className:"card card-bg-paper shadow-xl",children:[a.jsxs("figure",{className:"h-64 relative",children:[a.jsx("img",{src:e.backgroundImage,alt:e.name,className:"w-full h-full object-cover"}),a.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center",children:a.jsxs("div",{className:"text-center text-white",children:[a.jsx("h2",{className:"text-4xl font-bold mb-2",children:e.name}),a.jsx("p",{className:"text-xl",children:e.description})]})})]}),a.jsxs("div",{className:"card-body",children:[a.jsx("div",{className:"flex items-center justify-between mb-4",children:a.jsxs("div",{children:[a.jsx("h3",{className:"card-title",children:"Location"}),a.jsx("p",{className:"text-base-content/70",children:"What would you like to do here?"})]})}),a.jsx(Yj,{location:e})]})]}),zj=({locations:e,selectedLocationId:t,onLocationSelect:n})=>{const s=i=>{const r=i.target.value;n(r)};return a.jsx("div",{className:"card card-bg-paper shadow-xl",children:a.jsx("div",{className:"card-body",children:a.jsxs("div",{className:"flex flex-row form-control w-full max-w-xs",children:[a.jsx("label",{className:"label",children:a.jsx("span",{className:"label-text text-xl text-neutral",children:"Where would you like to go?"})}),a.jsx("select",{className:"flex-1 select select-ghost bg-transparent min-w-96",value:t,onChange:s,children:e.map(i=>a.jsx("option",{value:i.id,className:"text-base-content",children:i.name},i.id))})]})})})},Jj=()=>{const{returnToMenu:e,startArmyManagement:t,startBestiary:n}=qe(),{moveToLocation:s}=ja(),i=wa(),r=Mk(),[o,l]=p.useState(null),c=m=>{l(m),s(m)},d=o&&r.find(m=>m.id===o)||i;return a.jsxs("div",{className:"flex h-full min-h-screen bg-cover bg-center bg-no-repeat bg-fixed bg-black",style:{backgroundImage:`url(${Wn})`},children:[a.jsxs("div",{className:"w-80 p-4 space-y-6",children:[a.jsx("div",{className:"card card-bg-paper shadow-xl",children:a.jsxs("div",{className:"card-body",children:[a.jsx("h2",{className:"card-title text-2xl font-bold",children:"Overworld Map"}),a.jsxs("p",{className:"text-sm text-base-content/70",children:["Available Locations: ",r.length]}),a.jsxs("p",{className:"text-sm text-base-content/70",children:["Current: ",i.name]})]})}),a.jsx("div",{className:"card card-bg-paper shadow-xl",children:a.jsxs("div",{className:"card-body space-y-2",children:[a.jsx("button",{className:"btn btn-block btn-neutral btn-outline",onClick:()=>e(),children:"Return to Menu"}),a.jsx("button",{className:"btn btn-block btn-neutral btn-outline",onClick:()=>n(),children:"Bestiary"}),a.jsx("button",{className:"btn btn-block btn-neutral btn-outline",onClick:()=>t(),children:"Manage Army"})]})})]}),a.jsxs("div",{className:"flex-1 p-4 space-y-6",children:[a.jsx(zj,{locations:r,selectedLocationId:o||i.id,onLocationSelect:c}),a.jsx(Kj,{location:d})]})]})};function Qj(){const{status:e}=Te();return p.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[e]),a.jsxs("div",{className:"App",children:[e===K.MENU&&a.jsx(Dj,{}),e===K.NARRATIVE&&a.jsx(Hj,{}),e===K.OVERWORLD&&a.jsx(Jj,{}),e===K.ARMY_MANAGEMENT&&a.jsx(Dw,{}),e===K.PLAYING&&a.jsx(Hk,{}),e===K.BATTLE_END&&a.jsx(Jk,{}),e===K.BESTIARY&&a.jsx(Qk,{}),e===K.CONVERSATION_EDITOR&&a.jsx(Oj,{})]})}Ai.createRoot(document.getElementById("root")).render(a.jsx(p.StrictMode,{children:a.jsx(bi,{store:kt,children:a.jsx(Ms,{loading:null,persistor:eh,children:a.jsx(Qj,{})})})}));
